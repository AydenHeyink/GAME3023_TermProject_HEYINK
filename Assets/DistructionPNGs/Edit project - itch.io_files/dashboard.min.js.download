(()=>{var xr,V=xr=window.$,E=window.I,z=window._,vt,yt,He,Q=function(n,e){return function(){return n.apply(e,arguments)}},Ee=function(n,e){for(var r in e)Nr.call(e,r)&&(n[r]=e[r]);function t(){this.constructor=n}return t.prototype=e.prototype,n.prototype=new t,n.__super__=e.prototype,n},Nr={}.hasOwnProperty;vt="%Y-%m-%d",yt="%Y-%m-%d %H:00:00",He=function(n,e){var r,t,s,i,a,o,l;return i=n.offset(),o=i.left,l=i.top,r=e.offsetParent(),r.is("html")||(a=r.offset(),t=a.left,s=a.top,o-=t,l-=s),[Math.floor(o),Math.floor(l)]};var Te=E.Grapher||(E.Grapher=function(){n.format_number=E.format_integer,n.prototype.chart_svg_class="chart",n.prototype.margin_left=40,n.prototype.margin_bottom=30,n.prototype.margin_right=30,n.prototype.margin_top=20,n.prototype.dot_hitbox_w=30,n.prototype.dot_hitbox_h=120,n.prototype.axis_spacing=8,n.prototype.axis_graph_padding=10,n.prototype.popup_template=`<div class="graph_popup">
  <div class="popup_date">{{ date }}</div>
  <div class="popup_label">{{ label }}</div>
</div>`,n.prototype.default_opts={label:"Count",y_axis_padding:1.3,min_y:10,x_ticks:10,fit_dots:!1,skip_zero_dots:!1};function n(e,r,t){var s,i,a,o;if(this.data=r,this.increment_date=Q(this.increment_date,this),this.list_range=Q(this.list_range,this),this.format_y_axis=Q(this.format_y_axis,this),this.get_y_scaled=Q(this.get_y_scaled,this),this.get_x_scaled=Q(this.get_x_scaled,this),this.get_y=Q(this.get_y,this),this.get_x=Q(this.get_x,this),this.popup_date=Q(this.popup_date,this),this.axis_offsets=Q(this.axis_offsets,this),this.data||(this.data=t.graph_counts),!this.data)throw"No data for graph";this.el=$(e),this.opts=$.extend({},this.default_opts,t),this.margin_left=(s=this.opts.margin_left)!=null?s:this.margin_left,this.margin_bottom=(i=this.opts.margin_bottom)!=null?i:this.margin_bottom,this.margin_top=(a=this.opts.margin_top)!=null?a:this.margin_top,this.margin_right=(o=this.opts.margin_right)!=null?o:this.margin_right,this.draw(),this.setup_popups()}return n.prototype.popup_position=function(e){return He(e.prev("circle"),this.el)},n.prototype.get_template=function(e){var r;return e==null&&(e="poup_template"),this._templates||(this._templates={}),(r=this._templates)[e]||(r[e]=z.template(this[e])),this._templates[e]},n.prototype.setup_popups=function(){var e,r,t,s;return e=null,t=function(i){if(i)return i.stop(!0,!0).remove()},s=z.debounce(function(i){return function(a,o){var l,c,d,b,h,y,g,w;if(o=$(o),!!o.data("popup"))switch(a){case"show":return h=i.get_template(o.data("popup_template")||"popup_template"),d=o.data("popup_el"),e!=null&&e.is(d)?void 0:(t(e),d||(d=$(h(o.data("popup"))),o.data("popup_el",d)),e=d,e.appendTo(i.el).hide().fadeIn("fast"),b=i.popup_position(o),g=b[0],w=b[1],c=5,y=e.outerWidth(),l=e.outerHeight(),e.css({left:g-y-c+"px",top:w-l-c+"px"}),typeof i.on_show_popup=="function"?i.on_show_popup(e,o):void 0);case"hide":return t(e),typeof i.on_hide_popup=="function"&&i.on_hide_popup(e,o),e=null}}}(this),30),r=this.svg.node(),r.addEventListener("mouseover",function(i){return function(a){var o;if((o=a.target.getAttribute("class"))!=null&&o.match(/\bhitbox\b/))return s("show",a.target)}}(this)),r.addEventListener("mouseout",function(i){return function(a){var o;if((o=a.target.getAttribute("class"))!=null&&o.match(/\bhitbox\b/))return s("hide",a.target)}}(this))},n.prototype.draw=function(){var e,r,t,s,i,a,o,l,c,d,b;return c=(t=this.opts.width)!=null?t:this.el.width(),l=(s=this.opts.height)!=null?s:this.el.height(),this.w=c/((i=this.opts.scale)!=null?i:1),this.h=l/((a=this.opts.scale)!=null?a:1),this.time_format=this.get_interval_formatter(),e=this.chart_svg_class,this.opts.class&&(e+=" "+this.opts.class),this.svg=d3.select(this.el[0]).append("svg").attr("class",e).attr("width",(o=this.opts.width)!=null?o:"100%").attr("height",l).attr("viewBox","0 0 "+this.w+" "+this.h),r=this.format_data(),d=this._x_scale=this.x_scale(r),b=this._y_scale=this.y_scale(r),this.draw_guides(d,b),this.draw_area(r),this.draw_axis(d,b),this.draw_dots(r),this.draw_label()},n.prototype.guide_x_range=function(e,r){return e.range()},n.prototype.draw_guides=function(e,r){var t,s,i,a;if(a=this.svg.append("g").attr("class","y_guides"),i=this.guide_x_range(e,r),t=i[0],s=i[1],a.selectAll("line").data(r.ticks(this.y_ticks())).enter().append("line").attr("x1",t).attr("y1",r).attr("x2",s).attr("y2",r),e.ticks)return this.svg.append("g").attr("class","x_guides").selectAll("line").data(e.ticks(this.x_ticks())).enter().append("line").attr("x1",e).attr("y1",r.range()[0]).attr("x2",e).attr("y2",r.range()[1])},n.prototype.axis_offsets=function(){return[0,0]},n.prototype.draw_axis=function(e,r){var t,s,i,a,o,l;return l=d3.svg.axis().scale(r).orient("left").tickFormat(this.format_y_axis).ticks(this.y_ticks()),t=e.domain()[0],a=this.axis_offsets(),s=a[0],i=a[1],this.svg.append("g").attr("transform","translate("+(this._x_scale(t)+s-this.axis_spacing)+", 0)").attr("class","y_axis axis").call(l),o=d3.svg.axis().scale(e).orient("bottom").ticks(this.x_ticks()),this.svg.append("g").attr("transform","translate(0, "+(r.range()[0]+i+this.axis_spacing)+")").attr("class","x_axis axis").call(o)},n.prototype.draw_area=function(e){var r,t;return t=this.opts.line_style||"area",r=function(){switch(t){case"area":return d3.svg.area().x(this.get_x_scaled).y1(this.get_y_scaled).y0(this.h-this.margin_bottom);case"line":return d3.svg.line().x(this.get_x_scaled).y(this.get_y_scaled);default:throw"Unknown line style: "+t}}.call(this),this.svg.append("g").attr("class","graph").append("path").attr("class",t).attr("d",r(e))},n.prototype.draw_label=function(){var e;return e=this.svg.append("g").attr("class","label").attr("transform","translate("+this.margin_left+", 10)"),e.append("circle").attr("cx",0).attr("cy",-5).attr("r",4),e.append("text").text(this.opts.label).attr("x",10)},n.prototype.draw_dots=function(e,r){var t,s,i,a;if(r==null&&(r={}),this.opts.show_dots!==!1&&(e=this.filter_dots_data(e),!(this.list_range().length>((a=this.opts.max_dots)!=null?a:60))))return i=this.svg.append("g").attr("class","popups").selectAll("g").data(e).enter().append("g").attr("class","popup_trigger"),s=this.dot_hitbox_w,t=this.dot_hitbox_h,i.append("circle").attr("class","dot_outline").attr("cx",this.get_x_scaled).attr("cy",this.get_y_scaled).attr("r",6),i.append("circle").attr("class","dot").attr("cx",this.get_x_scaled).attr("cy",this.get_y_scaled).attr("r",4),i.append("rect").attr("class",function(o){return function(l){var c,d;return d="column_dot hitbox",typeof(c=o.opts).column_url=="function"&&c.column_url(l)&&(d+=" link"),d}}(this)).attr("transform","translate(-"+s/2+", -"+t/2+")").attr("x",this.get_x_scaled).attr("y",this.get_y_scaled).attr("width",s).attr("height",t).attr("data-popup",function(o){return function(l){return JSON.stringify({date:o.popup_date.apply(o,arguments),label:o.popup_label.apply(o,arguments)})}}(this))},n.prototype.filter_dots_data=function(e){var r,t,s,i,a,o,l;return this.opts.skip_zero_dots&&(e=function(){var c,d,b;for(b=[],c=0,d=e.length;c<d;c++)t=e[c],t.count!==0&&b.push(t);return b}()),this.opts.fit_dots&&(a=this.w-this.margin_left-this.margin_right-this.axis_graph_padding,r=Math.floor(a/this.dot_hitbox_w),e.length>r)?(s=Math.floor((a-this.dot_hitbox_w*2)/this.dot_hitbox_w),l=Math.floor((e.length-2)/s),o=function(){var c,d,b,h;for(h=[],i=c=1,d=e.length-2,b=l;b>0?c<=d:c>=d;i=c+=b)h.push(e[i]);return h}(),o.push(e[e.length-1]),o.unshift(e[1]),o):e},n.prototype.popup_label=function(e){var r;return r=this.opts.rate?E.number_format(this.get_y(e),4)+"%":E.number_format(this.get_y(e)),this.opts.label+": "+r},n.prototype.popup_date=function(e){return e.date},n.prototype.get_x=function(e){return this.time_format.parse(e.date)},n.prototype.get_y=function(e){return this.opts.rate?e.count*100:e.count},n.prototype.get_x_scaled=function(){return this._x_scale(this.get_x.apply(this,arguments))},n.prototype.get_y_scaled=function(){return this._y_scale(this.get_y.apply(this,arguments))},n.prototype.format_y_axis=function(e){return this.opts.rate?e<10&&e!==0?E.number_format(e,1)+"%":E.number_format(e)+"%":E.Grapher.format_number(e)},n.prototype.x_ticks=function(){return this.opts.x_ticks},n.prototype.y_ticks=function(){return this.opts.rate?5:Math.min(5,this.opts.min_y)},n.prototype.get_interval_formatter=function(){switch(this.opts.interval){case"hour":return d3.time.format(yt);default:return d3.time.format(vt)}},n.prototype.get_range=function(){var e,r,t,s,i,a,o;if(e=this.get_interval_formatter(),this.opts.interval!=="data"){if(this.opts.range_left){if(i=[e.parse(this.opts.range_left),e.parse(this.opts.range_right)],this.opts.interval==="weekly"&&this.data[0]){for(r=i[0],t=e.parse(this.data[0].date);t>r;)t=d3.time.day.offset(t,-7);return[t,i[1]]}return i}if(this.opts.num_days)return o=d3.time.day(new Date),s=this.opts.day_offset||0,r=d3.time.day.offset(o,-(this.opts.num_days+s-1)),a=d3.time.day.offset(o,-s),[r,a]}if(this.data.length<2)throw"Data is too small to get range";return[e.parse(this.data[0].date),e.parse(this.data[this.data.length-1].date)]},n.prototype.map_range=function(e){var r,t,s,i,a,o,l,c,d;if(this.opts.interval==="data")return t=this.get_interval_formatter(),a=function(){var b,h,y,g;for(y=this.data,g=[],b=0,h=y.length;b<h;b++)r=y[b].date,d=e(t.parse(r)),d&&g.push(d);return g}.call(this),a;for(i=this.get_range(),s=i[0],l=i[1],c=s,o=[];c<=l;)d=e(c),c=this.increment_date(c),d&&o.push(d);return o},n.prototype.list_range=function(){var e;return e=[],this.map_range(function(r){return e.push(r)}),e},n.prototype.increment_date=function(e){switch(this.opts.interval){case"monthly":case"month":return d3.time.month.offset(e,1);case"weekly":case"week":return d3.time.day.offset(e,7);case"hour":return d3.time.hour.offset(e,1);default:return d3.time.day.offset(e,1)}},n.prototype.format_data=function(){var e,r,t,s,i,a;for(i=this.get_interval_formatter(),e={},s=this.data,r=0,t=s.length;r<t;r++)a=s[r],e[a.date]=a;return this.map_range(function(o){return function(l){var c;return c=i(l),e[c]||{count:0,date:c}}}(this))},n.prototype.x_scale=function(e){var r,t,s;return t=this.get_range(),r=t[0],s=t[1],d3.time.scale().domain([r,s]).rangeRound([this.margin_left+this.axis_graph_padding,this.w-this.margin_right])},n.prototype.y_scale=function(e){var r,t,s,i,a;return t=d3.max(e,this.get_y)||0,a=this.opts.y_axis_padding||1.3,i=[this.h-this.margin_bottom,this.margin_top],r=this.opts.rate?Math.min(100,Math.max(.5,Math.floor(t*10*a)/10)):Math.max(this.opts.min_y,Math.floor((t+1)*a)),s=d3.scale.linear().domain([0,r]),this.opts.rate?s.range(i):s.rangeRound(i)},n}()),Sr=E.MoneyGrapher||(E.MoneyGrapher=function(n){Ee(e,n);function e(){return this.format_y_axis=Q(this.format_y_axis,this),e.__super__.constructor.apply(this,arguments)}return e.prototype.format_y_axis=function(r){var t;return t=this.opts.currency==="JPY"?r:r/100,t>9&&Math.floor(t),(E.currency_symbols[this.opts.currency]||"$")+E.Grapher.format_number(t)},e.prototype.popup_label=function(r){return this.opts.label+": "+E.format_money(r.sum,this.opts.currency)},e}(E.Grapher)),Je=E.CumulativeGraph||(E.CumulativeGraph=function(n){Ee(e,n);function e(){return this.get_range=Q(this.get_range,this),this.get_y=Q(this.get_y,this),e.__super__.constructor.apply(this,arguments)}return e.prototype.default_opts={label:"Amount",min_y:100,x_ticks:8,fit_dots:!0,min_range:7,currency:"USD",y_axis_padding:1.3},e.prototype.get_y=function(r){return r.sum},e.prototype.get_range=function(){var r,t,s,i;return t=this.get_interval_formatter(),r=this.data[0],s=this.data[this.data.length-1],r=t.parse(r.date),s=t.parse(s.date),i=d3.time.day.offset(s,-this.opts.min_range),i<r&&(r=i),[r,s]},e.prototype.format_data=function(){var r,t,s,i,a,o;for(r={},a=this.data,t=0,i=a.length;t<i;t++)o=a[t],r[o.date]=o;return s=0,this.map_range(function(l){return function(c){var d,b;return d=l.time_format(c),s=((b=r[d])!=null?b.sum:void 0)||s,{sum:s,date:d}}}(this))},e}(E.MoneyGrapher)),jn=E.BarGrapher||(E.BarGrapher=function(n){Ee(e,n);function e(){return this.get_x=Q(this.get_x,this),e.__super__.constructor.apply(this,arguments)}return e.prototype.chart_svg_class="chart bar_chart",e.prototype.dot_hitbox_w=20,e.prototype.dot_hitbox_h=20,e.prototype.bar_spacing=5,e.prototype.is_ordinal=function(){return this.opts.interval==="ordinal"},e.prototype.x_field=function(){return this.is_ordinal()?"label":"date"},e.prototype.popup_date=function(r){return r[this.x_field()]},e.prototype.get_x=function(r){return this.is_ordinal()?r[this.x_field()]:e.__super__.get_x.call(this,r)},e.prototype.format_data=function(){return this.is_ordinal()?this.data:e.__super__.format_data.call(this)},e.prototype.axis_offsets=function(){return[-Math.floor(this.bar_width()/2),0]},e.prototype.map_range=function(r){var t,s,i,a,o;if(this.is_ordinal()){for(i=this.data,a=[],t=0,s=i.length;t<s;t++)o=i[t],a.push(r(o[this.x_field()]));return a}else return e.__super__.map_range.call(this,r)},e.prototype.get_range=function(){return this.is_ordinal()?[this.data[0][this.x_field()],this.data[this.data.length-1][this.x_field()]]:e.__super__.get_range.call(this)},e.prototype.bar_width=function(){var r,t;switch(this.opts.interval||"daily"){case"weekly":r=this.get_range()[0],t=d3.time.day.offset(r,7);break;case"daily":r=this.get_range()[0],t=d3.time.day.offset(r,1);break;case"data":r=this.time_format.parse(this.data[0][this.x_field()]),t=this.time_format.parse(this.data[1][this.x_field()]);break;case"ordinal":r=this.data[0][this.x_field()],t=this.data[1][this.x_field()]}return this._x_scale(t)-this._x_scale(r)},e.prototype.guide_x_range=function(r,t){var s,i,a,o,l;return this.is_ordinal()?(o=r.range(),s=o[0],i=o[o.length-1]):(l=r.range(),s=l[0],i=l[1]),a=this.bar_width(),[s-a/2,i+a/2]},e.prototype.x_scale=function(r){var t,s,i,a,o,l,c,d,b,h,y,g,w,u;if(d=this.margin_left+this.axis_graph_padding,g=this.w-this.margin_right,this.is_ordinal()){for(c=[],y=this.data,l=0,h=y.length;l<h;l++)u=y[l],c.push(u[this.x_field()]);return d3.scale.ordinal().domain(c).rangePoints([d,g])}else return i=this.list_range(),b=i[0],w=i[i.length-1],t=g-d,o=d3.time.scale().domain([b,w]),s=t/i.length,a=s/2,o.rangeRound([d+a,g-a])},e.prototype.draw_area=function(r){var t,s,i,a;return this.opts.line_style==="line"?e.__super__.draw_area.call(this,r):(t=this.bar_width(),a=function(o){return function(l){var c;return c=o.get_x_scaled(l),c-(t-o.bar_spacing)/2}}(this),s=this.svg.append("g").attr("class","bars").selectAll("rect").data(r).enter().append("rect").attr("x",a).attr("y",this.get_y_scaled).attr("width",t-this.bar_spacing).attr("height",function(o){return function(l){return o._y_scale(0)-o.get_y_scaled(l)}}(this)),this.opts.colors&&(i=d3.scale.ordinal().range(this.opts.colors),i=i.domain(this._x_scale.domain()),s=s.attr("fill",function(o){return function(l){return i(l[o.x_field()])}}(this))),s)},e}(E.Grapher)),Pe=E.StackedBarGrapher||(E.StackedBarGrapher=function(n){Ee(e,n),e.prototype.chart_svg_class="chart bar_chart stacked_bar_chart",e.prototype.bar_popup_template=`<div class="graph_popup">
  <div class="popup_date">{{ date }}</div>
  <div class="popup_group">{{ group }}</div>
  <div class="popup_label">{{ label }}</div>
</div>`;function e(){this.on_hide_popup=Q(this.on_hide_popup,this),this.on_show_popup=Q(this.on_show_popup,this),this.popup_group=Q(this.popup_group,this),e.__super__.constructor.apply(this,arguments),this.opts.group_url&&$(this.svg.node()).on("click","[data-game_id]",function(r){return function(t){var s,i;if(s=$(t.target).data("game_id"),i=r.opts.group_url({game_id:s}),!!i)return window.location=i}}(this)),this.opts.column_url&&$(this.svg.node()).on("click",".column_dot[data-popup]",function(r){return function(t){var s,i;if(s=$(t.target).data("popup"),i=r.opts.column_url(s),!!i)return window.location=i}}(this))}return e.prototype.secondary_field=function(){return this.opts.secondary_field||"game_id"},e.prototype.get_y=function(r){return r.max},e.prototype.x_ticks=function(){return this.opts.interval==="weekly"&&this.list_range().length<15?d3.time.monday:e.__super__.x_ticks.call(this)},e.prototype.popup_group=function(r){return r[this.secondary_field()]},e.prototype.bar_popup_label=function(r){var t;return t=E.number_format(r.max-r.min),this.opts.label+": "+t},e.prototype.format_data=function(){var r,t,s,i,a;for(r={},i=this.data,t=0,s=i.length;t<s;t++)a=i[t],r[a.date]=a;return this.map_range(function(o){return function(l){var c,d,b,h,y,g,w,u;if(d=o.time_format(l),w=r[d],!w)return{date:d,min:0,max:0,stacks:[]};if(g=0,y=function(){var f,k,p,x;for(p=w.counts,x=[],b=f=0,k=p.length;f<k;b=++f)c=p[b],h=g,g+=c.count,u={cap:g===w.count,date:w.date,min:h,max:g},u[this.secondary_field()]=c[this.secondary_field()],x.push(u);return x}.call(o),w.count>0)return{date:w.date,min:0,max:w.count,stacks:y}}}(this))},e.prototype.popup_position=function(r){return He(r,this.el)},e.prototype.on_show_popup=function(r,t){var s,i,a;if(a=t.data(this.secondary_field()),!a){this.on_hide_popup();return}return this.el.addClass("highlighting_bar"),i=this.el.find(".game_bar"),s=i.filter("[data-"+this.secondary_field()+"='"+a+"']"),i.css({opacity:.1}),s.css({opacity:""})},e.prototype.on_hide_popup=function(r,t){return this.el.removeClass("highlighting_bar").find(".game_bar").css({opacity:""})},e.prototype.draw_area=function(r){var t,s,i,a,o,l,c,d,b,h,y;for(i=this.bar_width(),a=d3.scale.ordinal().range(this.opts.colors||["#F3596A","#D34D75","#AE4879","#864477","#5E406D","#39385E"]),r=r.filter(function(g){return g.min!==g.max}),h={},c=0,d=r.length;c<d;c++)l=r[c],h[l[this.secondary_field()]]=!0;return h=function(){var g;g=[];for(o in h)g.push(+o);return g}(),a=a.domain(h),y=this.svg.append("g").attr("class","bars").selectAll("g").data(r).enter().append("g"),b=function(g){return function(w,u){return u==null&&(u=0),w.attr("x",function(f){var k;return k=g.get_x_scaled(f),-u+Math.floor(k-(i-5)/2)}).attr("y",function(f){return g._y_scale(f.max)-u}).attr("width",i-5+u*2).attr("height",function(f){return 2*u+Math.max(1,g._y_scale(f.min)-g._y_scale(f.max))})}}(this),t=y.attr("class","bar_stack"),b(t.append("rect").attr("class","total_border"),1),b(t.append("rect").attr("class","total_bar")),s=y.append("g").attr("class","game_counts").selectAll("rect").data(function(g){return g.stacks}).enter(),b(s.append("rect").attr("class",function(g){return function(w){var u,f;return f="game_bar hitbox",typeof(u=g.opts).group_url=="function"&&u.group_url(w)&&(f+=" link"),f}}(this)).attr("data-"+this.secondary_field(),function(g){return function(w){return w[g.secondary_field()]}}(this)).attr("fill",function(g){return function(w){return a(w[g.secondary_field()])}}(this)).attr("data-popup_template","bar_popup_template").attr("data-popup",function(g){return function(w){return JSON.stringify({date:g.popup_date.apply(g,arguments),label:g.bar_popup_label.apply(g,arguments),group:(g.opts.popup_group||g.popup_group).apply(null,arguments)})}}(this))),b(s.append("rect").attr("class","bar_border")).attr("height",function(g){return g.cap?0:1})},e}(E.BarGrapher)),Ir=function(){function n(e,r){var t,s,i,a;for(this.el=V(e),i=this.el.find(".remote_table"),t=0,s=i.length;t<s;t++)a=i[t],V(a).remote_table();this.el.format_timestamps("fromNow"),r.cumulative_earnings&&new Je("#cumulative_earnings_graph",r.cumulative_earnings,{currency:r.currency})}return n}();window.init_BundleAnalytics=function(n,e){new Ir(n,e)};var P=window.React,X=window.ReactDOM,F=window.ReactDOMFactories,Rr=window.ReactTransitionGroup,j=window.PropTypes,G=window.classNames,M=window.R;P||E.libs.react.done(function(){return P=window.React,X=window.ReactDOM,F=window.ReactDOMFactories,Rr=window.ReactTransitionGroup,j=window.PropTypes,G=window.classNames,M=window.R});var we=null;E.libs.react.done(function(){var n,e;return n=F,e=n.img,we=M.component("LazyImage",{pure:!0,propTypes:{src:j.string,src_set:j.string,width:j.number,height:j.number},getInitialState:function(){return{visible:!1}},componentDidMount:function(){var r;return r=this.image_ref.current,this.unbind_lazy_images=$(r).lazy_images({elements:[r],show_images:function(t){return function(){var s;return t.setState({visible:!0}),typeof(s=t.props).on_reveal=="function"?s.on_reveal():void 0}}(this)})},componentWillUnmount:function(){return typeof this.unbind_lazy_images=="function"?this.unbind_lazy_images():void 0},render:function(){var r,t;return e({ref:this.image_ref||(this.image_ref=P.createRef()),className:G(this.props.class,this.props.className,{lazy_loaded:this.state.loaded,lazy_visible:this.state.visible}),alt:this.props.alt,width:this.state.loaded?this.props.width:(r=this.props.initial_width)!=null?r:this.props.width,height:this.state.loaded?this.props.height:(t=this.props.initial_height)!=null?t:this.props.height,src:this.state.visible?this.props.src:void 0,srcSet:this.state.visible?this.props.src_set:void 0,onLoad:this.state.visible&&!this.state.loaded?function(s){return function(){var i;return s.setState({loaded:!0}),typeof(i=s.props).on_load=="function"?i.on_load():void 0}}(this):void 0})}})}),window.init_LazyImage=function(n,e){M.render(n,()=>we(e))};var We=[].slice,de=E.ConversionTracker||(E.ConversionTracker=function(){function n(){}return n.types={impression:1,click:2,purchase:3,download:4,join:5},n.buffer=[],n.find_click=function(e){var r,t,s,i,a,o;for(o=new RegExp(":"+e+"$"),r=this.get_cookie(),s=0,a=r.length;s<a;s++)if(i=r[s],t=z.isArray(i)?i[0]:i,t.match(o))return i},n.strip_click=function(e){var r,t,s,i,a,o;return a=new RegExp(":"+e+"$"),r=this.get_cookie(),o=0,i=function(){var l,c,d;for(d=[],l=0,c=r.length;l<c;l++){if(s=r[l],t=z.isArray(s)?s[0]:s,t.match(a)){o+=1;continue}d.push(s)}return d}(),i.length===r.length?0:(this.write_cookie(i),o)},n.after_click_action=function(e,r){var t,s,i,a;if(t=this.find_click(r),!!t)return a=null,i=z.isArray(t)?(a=t[1],t[0]):t,s=i.replace(/^\d+/,this.types[e]),this.strip_click(r),this.push(s,a),!0},n.download=function(e){return this.after_click_action("download",e)},n.purchase=function(e){return this.after_click_action("purchase",e)},n.join=function(e){return this.after_click_action("join",e)},n.click=function(e){var r,t,s,i,a,o;s=this.types.click+":"+e,i=(o=this.get_active_splits())?[s,o]:s,this.push(s);try{for(t=function(){var l,c,d,b;for(d=this.get_cookie(),b=[],l=0,c=d.length;l<c;l++)r=d[l],a=z.isArray(r)?r[0]:r,a!==s&&b.push(r);return b}.call(this),t.push(i);t.length>100;)t.shift();return this.write_cookie(t),!0}catch(l){}},n.write_cookie=function(e){return E.set_cookie("itchio_ca",JSON.stringify(e),{expires:1})},n.get_cookie=function(){var e;if(e=window.Cookies.get("itchio_ca"),e)try{return JSON.parse(e)||[]}catch(r){try{return JSON.parse(decodeURIComponent(e))||[]}catch(t){return[]}}else return[]},n.flush_later=function(){return this.flush_later=z.throttle(this.flush_now,2e3,{leading:!1}),$(window).on("beforeunload",function(e){return function(){e.flush_now()}}(this)),this.flush_later()},n.encode_buffer=function(e){var r,t,s,i,a,o,l,c,d,b,h,y,g,w,u;for(e==null&&(e=We.call(this.buffer)),e.sort(),h=[],l=null,o=null,a=null,s=0,c=e.length;s<c;s++)t=e[s],g=t.match(/^(\d+):(\d+):(\d+):(\d+)$/),r=g[0],u=g[1],w=g[2],b=g[3],d=g[4],u&&(u!==l&&(h.push("t"+u),l=u),w!==o&&(h.push("s"+w),o=w),b!==a&&(h.push("o"+b),a=b),i=(+d).toString(36),y=String.fromCharCode("A".charCodeAt(0)+i.length),h.push(""+y+i));return h.join("")},n.get_active_splits=function(){return E.active_splits},n.flush_url=function(e){var r,t,s;return s=this.encode_buffer(),r=[{name:"x",value:s}],(t=e||this.get_active_splits())&&r.push({name:"s",value:t.join(",")}),E.root_url("ca.gif")+"?"+$.param(r)},n.flush_now_beacon=function(e){var r;if(navigator.sendBeacon==null)return this.flush_now(e);if(this.buffer.length)if(E.in_dev&&console.debug.apply(console,["ca(beacon)"].concat(We.call(z.compact([this.buffer,e])))),r=this.flush_url(e),navigator.sendBeacon(r))this.buffer=[];else return this.flush_now();return $.when()},n.flush_now=function(e){var r;return this.buffer.length?(E.in_dev&&console.debug.apply(console,["ca"].concat(We.call(z.compact([this.buffer,e])))),r=this.flush_url(e),this.buffer=[],$.Deferred(function(t){return function(s){var i,a;return a=new Image,a.src=r,i=function(){return s.resolve()},a.onerror=i,a.onload=i}}(this))):$.when()},n.push=function(e,r){var t;return this.buffer=function(){var s,i,a,o;for(a=this.buffer,o=[],s=0,i=a.length;s<i;s++)t=a[s],t!==e&&o.push(t);return o}.call(this),this.buffer.push(e),this.buffer.length>50||r?this.flush_now(r):this.flush_later()},n}()),wt=E.ReferrerTracker||(E.ReferrerTracker=function(){function n(){}return n.MAX_ITEMS=20,n.get_cookie=function(){return window.Cookies.getJSON("itchio_refs")||[]},n.write_cookie=function(e){return E.set_cookie("itchio_refs",e,{expires:14})},n.has_ref=function(e,r){var t,s,i,a,o,l;for(r=+r,o=n.get_cookie(),i=0,a=o.length;i<a;i++)if(l=o[i],s=l[0],t=l[1],s===e&&t===r)return!0;return!1},n.push=function(e,r,t){var s,i;if(t&&t.length>0){for(r=+r,i=function(){var a,o,l,c;for(l=this.get_cookie(),c=[],a=0,o=l.length;a<o;a++)s=l[a],!(s[0]===e&&s[1]===r)&&c.push(s);return c}.call(n),E.in_dev&&console.log("pushing referrer",[e,r,t]),i.unshift([e,r,t]);i.length>n.MAX_ITEMS;)i.pop();return n.write_cookie(i)}},n}()),kt=null;E.libs.react.done(function(){var n,e,r,t,s;return e=F,r=e.a,s=e.p,t=e.button,n={},kt=M.component("ConversionLink",{pure:!0,propTypes:{source:j.number,object_type:j.number,object_id:j.number,href:j.string,target:j.string,class:j.any,impression:j.bool,on_click:j.func,on_impression:j.func},getInitialState:function(){return{seen:!1}},get_suffix:function(){return this.props.source+":"+this.props.object_type+":"+this.props.object_id},on_click:function(i){var a,o,l,c;if(i.type==="click"&&(a=this.link_ref.current,l=i.metaKey||i.ctrlKey||i.shiftKey||this.props.target==="_blank",s=this.handle_click(),!l&&s.state()!=="resolved"))return i.preventDefault(),c=new Date,o=function(d){return function(){if(o)return o=null,window.location=d.props.href}}(this),setTimeout(function(d){return function(){return typeof o=="function"?o():void 0}}(this),200),s.done(o)},on_mouse_up:function(i){if(i.button===1)return this.handle_click()},handle_click:function(){var i,a;return this.props.object_type&&this.props.source&&this.props.object_id?this.state.clicked?this.state.clicked:(a=de.types.click+":"+this.get_suffix(),n[a]?$.when():(n[a]=!0,de.click(this.get_suffix()),s=de.flush_now_beacon(),this.props.track_referrer&&wt.push.apply(wt,this.props.track_referrer),this.setState({clicked:s}),typeof(i=this.props).on_click=="function"&&i.on_click(),s)):$.when()},componentDidMount:function(){var i;if(this.props.object_type&&this.props.source&&this.props.object_id&&this.props.impression!==!1&&!n[de.types.impression+":"+this.get_suffix()])return i=this.link_ref.current,this.unbind_visibility=$(i).lazy_images({elements:[i],show_images:function(a){return function(){var o,l;return l=de.types.impression+":"+a.get_suffix(),n[l]||(de.push(l),n[l]=!0),a.setState({seen:!0}),typeof(o=a.props).on_impression=="function"&&o.on_impression(),typeof a.unbind_visibility=="function"&&a.unbind_visibility(),a.unbind_visibility=null}}(this)})},componentWillUnmount:function(){return typeof this.unbind_visibility=="function"?this.unbind_visibility():void 0},render:function(){var i;return r({ref:this.link_ref||(this.link_ref=P.createRef()),href:this.props.href,className:this.props.class||this.props.className,onClick:this.on_click,onMouseUp:this.on_mouse_up,target:this.props.target,tabIndex:(i=this.props.tabindex)!=null?i:this.props.tabIndex,"aria-hidden":this.props["aria-hidden"]},this.props.children)}})}),window.init_ConversionLink=function(n,e){M.render(n,()=>kt(e))};var Cr=function(){function n(e){var r,t,s,i;for(this.el=$(e),t=this.el.find(".date_countdown"),s=0,i=t.length;s<i;s++)r=t[s],new I.TimestampCountdown(r,$(r).text());_.defer(function(a){return function(){return a.el.lazy_images()}}(this))}return n}();window.init_JamGrid=function(n,e){new Cr(n)},I.Dashboard=function(){function n(e,r){var t,s,i,a,o,l,c,d,b;for(b=r.views,t=r.downloads,o=r.graph_left,l=r.graph_right,i=r.games,a={},c=0,d=i.length;c<d;c++)s=i[c],a[s.id]=s;this.el=$(e),new I.FilterPickers(e,{label_padding:8}),I.tracked_links(this.el,"my_games","click"),b&&$("#views_graph").length&&new Pe("#views_graph",b,{label:"Views",x_ticks:7,popup_group:function(h){var y;return((y=a[h.game_id])!=null?y.title:void 0)||""},group_url:function(h){var y;return(y=a[h.game_id])!=null?y.url:void 0},range_left:o,range_right:l}),t&&$("#downloads_graph").length&&new Pe("#downloads_graph",t,{label:"Downloads",min_y:3,x_ticks:7,popup_group:function(h){var y;return((y=a[h.game_id])!=null?y.title:void 0)||""},group_url:function(h){var y;return(y=a[h.game_id])!=null?y.url:void 0},range_left:o,range_right:l}),this.el.format_timestamps("fromNow")}return n}(),window.init_Dashboard=function(n,e){new I.Dashboard(n,e)};var Dr=function(n,e){for(var r in e)jr.call(e,r)&&(n[r]=e[r]);function t(){this.constructor=n}return t.prototype=e.prototype,n.prototype=new t,n.__super__=e.prototype,n},jr={}.hasOwnProperty;I.GameInteract=function(){function n(e,r){this.opts=r,I.event2(this.opts.page_name),this.el=$(e),I.setup_selectize(this.el),this.el.find(".sort_by_picker").on("change",function(t){return window.location="?sort_by="+$(t.target).val()})}return n}(),I.DashboardGameRatings=function(n){Dr(e,n);function e(){e.__super__.constructor.apply(this,arguments),this.el.dispatch("click",{report_rating_btn:function(r){return function(t){var s;if(s=t.data("lightbox_url"))return I.Lightbox.open_remote_react(s,function(i){return R.Dashboard.GameRatingsReportLightbox(i)})}}(this)}),this.el.on("change",".rating_toggle_input",function(r){return function(t){var s,i,a;return i=$(t.currentTarget),a=i.closest(".toggle_ratings"),a.is(".loading")?!1:(a.addClass("loading"),s=I.with_csrf(i.closest("form").serializeArray()),i.prop("disabled",!0),$.ajax({url:"",type:"POST",data:I.with_csrf(s),success:function(o){return window.location.reload()}}))}}(this))}return e}(I.GameInteract),window.init_DashboardGameCollections=function(n,e){new I.GameInteract(n,e)},window.init_DashboardGameEditEmail=function(n,e){new I.GameInteract(n,e)},window.init_DashboardGameEmail=function(n,e){new I.GameInteract(n,e)};var Ke=null;E.libs.react.done(function(){var n,e,r,t,s,i,a,o,l,c;return e=F,a=e.img,l=e.label,t=e.button,r=e.a,c=e.pre,o=e.input,i=e.div,n=M.package("Forms"),s=0,n("ImagePreview",{pure:!0,getInitialState:function(){return{loaded:!1}},render:function(){return a({className:G(this.enclosing_class_name(),this.props.className,{image_loading:!this.state.loaded}),src:this.props.src,onLoad:function(d){return function(){var b;return d.setState({loaded:!0}),typeof(b=d.props).on_load=="function"?b.on_load():void 0}}(this)})}}),n("VideoPreview",{pure:!0,render:function(){return P.createElement("video",{width:200,loop:!0,muted:!0,autoPlay:!0,src:this.props.src})}}),Ke=n("ImageUploader",{pure:!0,propTypes:{upload_url:j.string.isRequired,name:j.string.isRequired,thumb_size:j.string,label:j.string,upload:j.object,show_replace:j.bool},getDefaultProps:function(){return{remove_button_classes:["button","outline","small"],replace_button_classes:["button","outline","small"],upload_button_classes:"button"}},getInitialState:function(){return{active_uploads:[],uploads:this.props.upload?[this.props.upload]:this.props.uploads}},push_errors:function(d){var b,h,y,g;return typeof d=="string"&&(d=[d]),h=function(){var w,u,f;for(f=[],w=0,u=d.length;w<u;w++)if(b=d[w],typeof b=="string")f.push(b);else if(Array.isArray(b))g=b[0],y=b[1],y?f.push(y.name+" - "+g):f.push(g);else continue;return f}(),this.setState(function(w){return{errors:(w.errors||[]).concat(h)}})},get_progress:function(){return Math.min.apply(Math,this.state.active_uploads.map(function(d){return function(b){return b.progress}}(this)))},pick_image:function(d){return this.setState({errors:[]}),E.upload_image({url:this.props.upload_url,accept:this.props.accept,thumb_size:this.props.thumb_size,multiple:this.props.multiple,max_size:this.props.max_size,test_file:function(b){return function(h,y){return $.when(E.test_image_dimensions(h),E.test_image_format(h)).done(function(){return y.resolve()}).fail(function(g){return y.reject(g)})}}(this),on_start_upload:function(b){return function(h,y,g){var w;return w={file:h,upload:y,xhr:g,progress:0},b.setState(function(u){return{active_uploads:u.active_uploads.concat([w]),uploading:!0}}),g.progress(function(u,f,k){var p;return p=Object.assign({},w,{progress:f/k}),b.setState(function(x){return{active_uploads:x.active_uploads.map(function(v){return function(m){return m===w?p:m}}(this))}}),w=p}).done(function(u){var f;if(u.errors){b.push_errors(u.errors);return}if(y=u.upload,typeof d=="function"&&d(),y)return typeof(f=b.props).on_upload=="function"&&f.on_upload(y),b.setState(function(k){return{uploads:(k.uploads||[]).concat([y])}})}).always(function(){return b.setState(function(u){var f;return f=u.active_uploads.filter(function(k){return function(p){return p!==w}}(this)),{uploading:!!f.length,active_uploads:f}})})}}(this)}).fail(function(b){return function(h){return b.push_errors(h)}}(this))},remove_image:function(d){var b,h;if(h=this.state.uploads[d],this.setState(function(y){var g;return{uploads:function(){var w,u,f,k;for(f=this.state.uploads,k=[],w=0,u=f.length;w<u;w++)g=f[w],g!==h&&k.push(g);return k}.call(this)}}),!this.props.multiple)return typeof(b=this.props).on_upload=="function"?b.on_upload(null):void 0},render_existing_upload:function(d,b){var h;return h=this.props.multiple?this.props.name+"["+(b+1)+"]":this.props.name,i({className:"existing_upload",key:d.id},o({type:"hidden",name:h,value:d.id}),d.thumb_url?i({className:"preview_image"},d.thumb_url.match(/\.mp4$/)?n.VideoPreview({src:d.thumb_url}):n.ImagePreview({src:d.thumb_url})):void 0,this.props.children,i({className:"existing_upload_tools"},this.props.show_replace?t({className:G("replace_image_btn",this.props.replace_button_classes),type:"button",onClick:function(y){return function(g){return g.preventDefault(),y.pick_image(function(){return y.remove_image(b)})}}(this)},"Replace image"):void 0,t({className:G("remove_image_btn",this.props.remove_button_classes),type:"button",onClick:function(y){return function(g){return g.preventDefault(),y.remove_image(b)}}(this)},"Remove image")))},render:function(){var d,b,h,y,g,w;return this.autogen_id="image-uploader-"+s++,d=!!((b=this.state.uploads)!=null&&b.length),this.enclose({className:G(this.props.className,{no_upload:!d,have_upload:!!d})},this.props.label?l({className:"label",htmlFor:this.autogen_id},this.props.label):void 0,(h=this.state.errors)!=null&&h.length?M.Forms.FormErrors({errors:this.state.errors,title:"Upload failed"}):void 0,this.props.multiple||(y=this.state.uploads)!=null&&y.length?void 0:o({type:"hidden",name:this.props.name,value:""}),this.state.uploading?i({className:"upload_progress"},this.state.active_uploads.length?"Uploading "+((this.get_progress()||0)*100).toFixed(2)+"%":"Uploading..."):void 0,this.props.multiple||!((g=this.state.uploads)!=null&&g.length)?t({id:this.autogen_id,disabled:!!this.state.uploading,className:G(this.props.upload_button_classes,{small:this.props.compact,disabled:!!this.state.uploading}),type:"button",onClick:function(u){return function(f){return f.preventDefault(),u.pick_image()}}(this)},this.props.upload_label||(this.props.multiple?"Upload images":"Upload image")):void 0,(w=this.state.uploads)!=null&&w.length?i({className:"existing_uploads",children:this.state.uploads.map(this.render_existing_upload)}):void 0)}})}),window.init_ImageUploader=function(n,e){M.render(n,()=>Ke(e))},window.init_DashboardGamePromoImages=function(n,e){},window.init_DashboardGameRatings=function(n,e){new I.DashboardGameRatings(n,e)},window.init_DashboardThirdPartyAnalytics=function(n,e){new I.GameInteract(n,e)};var ke,xe=ke=window.dayjs;window._dayjs_setup||(ke.extend(window.dayjs_plugin_duration),ke.extend(window.dayjs_plugin_calendar),ke.extend(window.dayjs_plugin_advancedFormat),ke.extend(window.dayjs_plugin_relativeTime),window._dayjs_setup=!0);var Ye,Er=[].slice;Ye=function(n){var e;return(e=typeof n=="string"&&n.match(/(^\d{4}\-\d{1,2}\-\d{1,2}) (\d{1,2}:\d{1,2}:\d{1,2})$/))?e[1]+"T"+e[2]+"Z":n};var Tr=function(n){return xe(Ye(n)).toDate()},Ne=function(){var n,e,r,t;switch(t=arguments[0],e=arguments[1],n=3<=arguments.length?Er.call(arguments,2):[],e==null&&(e="fromNow"),t=Ye(t),e){case"fromNow":return xe(t).fromNow();case"calendar":return xe(t).calendar(null,{sameElse:"MMMM Do YYYY"});case"format":return(r=xe(t)).format.apply(r,n);default:throw new Error("unknown method for format_timestamp: "+e)}},Se,Xe,Pr,xt;Se="yy-mm-dd",Xe="HH:mm:ss",xt=function(n){var e,r;return r=V.datepicker.formatTime(Xe,{hour:n.getHours(),minute:n.getMinutes(),second:n.getSeconds()}),e=V.datepicker.formatDate(Se,new Date(n)),e+" "+r},Pr=function(n){return V.datepicker.formatDate(Se,new Date(n))};var Ie=function(n,e){var r,t,s,i,a;for(r=0,t=n.length;r<t;r++)s=n[r],i=V(s),(a=i.attr("value"))&&i.val(xt(Tr(a)));return n.datetimepicker(V.extend({timeFormat:Xe,dateFormat:Se,beforeShow:function(){z.defer(function(){return V("#ui-datepicker-div").css("z-index",100)})}},e))},Qe=function(n,e){return n.datepicker(V.extend({dateFormat:Se,beforeShow:function(){z.defer(function(){return V("#ui-datepicker-div").css("z-index",100)})}},e))},Me=null;E.libs.react.done(function(){var n,e,r,t,s;return e=F,t=e.label,s=e.span,r=e.input,n=M.package("Dashboard"),Me=n("RangePicker",{pure:!0,current_preset:function(){var i,a,o,l;if(this.props.preset_ranges){for(l=this.props.preset_ranges,i=0,a=l.length;i<a;i++)if(o=l[i],this.props.range_left===o.left&&this.props.range_right===o.right)return o}},set_range:function(i){var a,o,l,c,d,b,h,y;return c=(d=i.left)!=null?d:this.props.range_left,y=(b=i.right)!=null?b:this.props.range_right,l=d3.time.format("%Y-%m-%d"),c=l.parse(c),y=l.parse(y),c>y&&(h=[y,c],c=h[0],y=h[1]),o=1e3*60*60*24,y-c<o*7&&(i.left!=null?y=d3.time.day.offset(c,7):c=d3.time.day.offset(y,-7)),y-c>o*365&&(i.left!=null?y=d3.time.day.offset(c,365):c=d3.time.day.offset(y,-365)),typeof(a=this.props).on_update_range=="function"?a.on_update_range({range_left:l(c),range_right:l(y)}):void 0},render:function(){var i,a,o;return i=this.current_preset(),a=this.props.preset_ranges?this.props.preset_ranges.map(function(l){return function(c){return{name:c.label,value:c.label}}}(this)):void 0,a&&!i&&a.unshift({name:"Custom",value:"custom"}),this.enclose({className:this.props.className},M.Forms.SimpleSelect({disabled:this.props.loading,name:"group_by",value:this.props.group_by,onChange:function(l){return function(c){var d;return typeof(d=l.props).on_update_range=="function"?d.on_update_range({group_by:c}):void 0}}(this),options:[{name:"Daily",value:"daily"},{name:"Weekly",value:"weekly"}]}),t({},s({className:"label"},"From"),n.DatePicker({className:"date_input",name:"range_left",value:this.props.range_left,disabled:this.props.loading,max_date:this.props.max_date,onChange:function(l){return function(c){return l.set_range({left:c})}}(this)})),t({},s({className:"label"},"To"),n.DatePicker({className:"date_input",name:"range_right",disabled:this.props.loading,value:this.props.range_right,max_date:this.props.max_date,onChange:function(l){return function(c){return l.set_range({right:c})}}(this)})),a?M.Forms.SimpleSelect({disabled:this.props.loading,value:(o=i!=null?i.label:void 0)!=null?o:"custom",onChange:function(l){return function(c){var d,b,h,y,g;if(c!=="custom"){for(y=l.props.preset_ranges,g=[],d=0,b=y.length;d<b;d++)h=y[d],h.label===c?g.push(l.set_range({left:h.left,right:h.right})):g.push(void 0);return g}}}(this),options:a}):void 0)}}),n("DatePicker",{getInitialState:function(){return{value:this.props.value}},componentDidMount:function(){var i,a;return i=this.container(),Qe(i,{maxDate:(a=this.props.max_date)!=null?a:1,onSelect:function(o){return function(l){var c;return o.setState({value:l}),typeof(c=o.props).onChange=="function"?c.onChange(l):void 0}}(this)})},render:function(){var i;return r({type:"text",defaultValue:this.props.defaultValue,value:this.props.value,className:G(this.enclosing_class_name(),this.props.className,{disabled:this.props.disabled}),name:this.props.name,readOnly:"readonly",disabled:(i=this.props.disabled)!=null?i:!1})}})});var ne=null;E.libs.react.done(function(){var n,e,r;return e=F,r=e.label,n=M.package("Dashboard"),ne=n("Graph",{pure:!0,componentDidMount:function(){return this.render_graph()},render_graph:function(){var t,s,i,a;return t=this.container(),t.html(""),s={range_left:this.props.range_left,range_right:this.props.range_right,interval:this.props.interval,width:this.props.width,height:this.props.height,secondary_field:this.props.secondary_field,label:(i=this.props.label)!=null?i:"Value",x_ticks:7,min_y:(a=this.props.min_y)!=null?a:10,y_axis_padding:this.props.y_axis_padding,popup_group:this.props.popup_group,group_url:this.props.group_url},this.props.type==="stacked"?new Pe(t,this.props.data,s):new Te(t,this.props.data,s)},componentDidUpdate:function(t){return this.render_graph()},render:function(){return this.enclose({className:this.props.class,style:{height:this.props.height}})}})});var Nt=[].indexOf||function(n){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===n)return e;return-1},Ze=null;E.libs.react.done(function(){var n,e,r,t,s,i,a;return e=F,t=e.fragment,a=e.span,r=e.a,s=e.label,t=P.createElement.bind(null,P.Fragment),t.type=P.fragment,n=["https://t.co/","https://t.co/","t.co"],i={domain:function(o,l){var c;return c=o[l.field],t({},E.truncate(c,80),Nt.call(n,c)>=0?a({className:"sub"}," (Twitter)"):void 0)},referrer:function(o,l){var c;return c=o[l.field],t({},r({href:c,rel:"noopener noreferrer",target:"_blank"},E.truncate(c,80)),Nt.call(n,c)>=0?a({className:"sub"}," (Twitter)"):void 0)}},Ze=function(o){switch(o.mode){case"by_url":return M.Dashboard.NiceTable({key:"by_url",className:"referrers",columns:[{field:"referrer",label:"Referrer",type:"referrer"},{field:"count",label:"Visits",type:"number"}],field_renderers:i,rows:o.by_url||[]});case"by_domain":return M.Dashboard.NiceTable({key:"by_domain",className:"referrers",columns:[{field:"domain",label:"Domain",type:"domain"},{field:"count",label:"Visits",type:"number"}],field_renderers:i,rows:o.by_domain||[]})}}});var Le,St,fe=function(n,e){return function(){return n.apply(e,arguments)}},It=function(n,e){for(var r in e)Mr.call(e,r)&&(n[r]=e[r]);function t(){this.constructor=n}return t.prototype=e.prototype,n.prototype=new t,n.__super__=e.prototype,n},Mr={}.hasOwnProperty,he=function(n){var e,r;return r=function(t){return t.errors?$.Deferred().reject(t):t},e=function(t){return $.Deferred().reject({errors:["Server error ("+t.status+")","Please contact support if the error persists"]})},n.then(r,e)},Lr=function(n){return n.then(null,function(e){return function(r){var t;return t=typeof r=="string"?{errors:[r]}:Array.isArray(r)&&r.every(item(function(){return typeof item=="string"}))?{errors:r}:"readyState"in r&&"status"in r?Object.assign({errors:["Server error ("+r.status+")","Please contact support if the error persists"]},r.responseJSON):r,$.Deferred().reject(t)}}(this))};I.prepare_upload=function(n,e){return $.when(e).then(function(r){return he($.ajax({url:n+"/upload/prepare",type:"post",data:I.with_csrf(r),dataType:"json"}))})},St=function(n){var e,r,t,s,i;return e=new DataView(n,0,5),t=e.getUint8(0,!0),s=e.getUint8(1,!0),r=t.toString(16)+s.toString(16),i={8950:"image/png",4749:"image/gif","424d":"image/bmp",ffd8:"image/jpeg"},i[r]},Le="You selected an image type we don't recognize. It's possible it has the wrong file extension for the format it is saved as. Please use an image editing program to convert it to a PNG, JPEG, or GIF.",I.test_image_format=function(n){return $.Deferred(function(e){return function(r){var t;return window.FileReader?(t=new FileReader,t.readAsArrayBuffer(n),t.onerror=function(){return r.reject("Failed to read image from disk")},t.onload=function(){var s;return s=St(t.result),s==="image/bmp"?r.reject("You selected a BMP file that has a wrong extension. Please use an image editing program to convert it to a PNG, JPEG, or GIF."):s?r.resolve():r.reject(Le)}):r.resolve()}}(this))},I.image_dimensions=function(n){return $.Deferred(function(e){var r,t;return t=typeof URL!="undefined"&&URL!==null&&typeof URL.createObjectURL=="function"?URL.createObjectURL(n):void 0,t?(r=new Image,r.src=t,r.onload=function(){return e.resolve([r.width,r.height])},r.onerror=function(){return e.reject(Le)}):e.reject(Le)})},I.video_dimensions=function(n){return $.Deferred(function(e){var r,t;return t=document.createElement("video"),r=typeof URL!="undefined"&&URL!==null&&typeof URL.createObjectURL=="function"?URL.createObjectURL(n):void 0,r?(t.src=r,t.onloadedmetadata=function(){return e.resolve([t.videoWidth,t.videoHeight])},t.onerror=function(){return e.reject("Invalid video file")}):e.reject("Invalid video file")})},I.test_image_dimensions=function(n,e,r){return e==null&&(e=3840),r==null&&(r=2160),I.image_dimensions(n).then(function(t){return function(s){var i,a;return a=s[0],i=s[1],$.Deferred(function(o){return a>e||i>r?o.reject("Image is greater than the maximum dimensions of "+e+"x"+r+" (you selected a "+a+"x"+i+" image)"):o.resolve()})}}(this))};var $r=I.Upload=function(){n.prototype.kind="upload";function n(e,r){this.file=e,this.opts=r!=null?r:{},this.save_upload=fe(this.save_upload,this),this.decrement=fe(this.decrement,this),this.increment=fe(this.increment,this)}return n.prototype.upload_params=function(){return{kind:this.kind,filename:this.file.name}},n.prototype.progress=function(e,r){},n.prototype.save_params=function(){return{}},n.prototype.save_url=function(){return this.upload_data.success_url},n.prototype.start_upload=function(){if(this.upload_data){console.warn("Attempt to start_upload when upload has already been started");return}return this.prepare_upload().then(function(e){return function(){return e.start_xhr_upload()}}(this)).then(function(e){return function(){return e.save_upload()}}(this))},n.prototype.increment=function(){var e,r;if((e=this.constructor).active_uploads||(e.active_uploads=0),this.constructor.active_uploads++,this.constructor.active_uploads===1)return typeof(r=this.opts).start_uploading=="function"?r.start_uploading():void 0},n.prototype.decrement=function(){var e;if(this.constructor.active_uploads--,this.constructor.active_uploads===0)return typeof(e=this.opts).stop_uploading=="function"?e.stop_uploading():void 0},n.prototype.prepare_upload=function(){return $.when(this.opts.upload_prefix||this.upload_prefix).then(function(e){return function(r){return I.prepare_upload(r,e.upload_params()).done(function(t){e.upload_data=t})}}(this))},n.prototype.start_xhr_upload=function(){var e,r,t,s,i,a;if(!this.upload_data)throw"missing upload data";this.increment(),e=$.Deferred().always(function(o){return function(){return o.decrement()}}(this)),r=new FormData,s=this.upload_data.post_params;for(t in s)i=s[t],r.append(t,i);return r.append("file",this.file),a=new XMLHttpRequest,a.upload.addEventListener("progress",function(o){return function(l){if(l.lengthComputable)return o.progress(l.loaded,l.total)}}(this)),a.upload.addEventListener("error",function(o){return function(l){return I.event("upload","xhr error",o.kind)}}(this)),a.upload.addEventListener("abort",function(o){return function(l){return I.event("upload","xhr abort",o.kind)}}(this)),a.addEventListener("readystatechange",function(o){return function(l){var c;if(a.readyState===4){if(Math.floor(a.status/100)===2)return I.event("upload","save",o.kind),e.resolve();if(c="Failed upload.",a.responseXML)try{c=a.responseXML.querySelector("Error Message").innerHTML}catch(d){l=d}else c=a.responseText;return I.event("upload_error","server error "+a.status+": "+c,o.kind),e.reject({errors:[c]})}}}(this)),a.open("POST",this.upload_data.action),a.send(r),e},n.prototype.save_upload=function(){if(!this.upload_data){console.warn("attempted to call save_upload without upload_data");return}return he($.ajax({url:this.save_url(),data:I.with_csrf(this.save_params()),dataType:"json",type:"post"}))},n}(),Fr=I.ImageUpload=function(n){It(e,n);function e(){return e.__super__.constructor.apply(this,arguments)}return e.prototype.kind="image",e.prototype.upload_params=function(){return $.when(e.__super__.upload_params.call(this)).then(function(r){return function(t){return I.image_dimensions(r.file).then(function(s){var i,a;return a=s[0],i=s[1],Object.assign({width:a,height:i},t)},function(){return t})}}(this))},e}(I.Upload),En=function(n){It(e,n),e.prototype.stage_delay=500,e.prototype.mock_prepare_result={id:123},e.prototype.mock_save_result={success:!0};function e(){this.save_upload=fe(this.save_upload,this),this.start_xhr_upload=fe(this.start_xhr_upload,this),this.prepare_upload=fe(this.prepare_upload,this),e.__super__.constructor.apply(this,arguments),console.warn("MockUpload:new "+this.file.name)}return e.prototype.prepare_upload=function(){return console.warn("MockUpload: prepare_upload"),$.when(this.opts.upload_prefix()).then(function(r){return function(){return $.Deferred(function(t){return setTimeout(function(){return r.upload_data=r.mock_prepare_result,t.resolve(r.upload_data)},r.stage_delay)})}}(this))},e.prototype.start_xhr_upload=function(){var r,t,s,i,a,o;return console.warn("MockUpload: start_xhr_upload"),r=20,s=(i=this.file.size)!=null?i:1234,t=0,o=0,a=this.stage_delay/r*5,$.Deferred(function(l){return function(c){var d;return l.progress(0,s),d=function(){return setTimeout(function(){return o+=1,l.progress(Math.floor(o/r*s),s),o===r?c.resolve():d()},a)},d()}}(this))},e.prototype.save_upload=function(){return console.warn("MockUpload: save_upload"),$.Deferred(function(r){return function(t){return setTimeout(function(){return t.resolve(r.mock_save_result)},r.stage_delay)}}(this))},e}(I.Upload);I.pick_files=function(n){var e;return n==null&&(n={}),e=n.input?$(n.input):($("input.pick_files_input").remove(),$("<input type='file' class='pick_files_input' />").hide().insertAfter("body")),$.Deferred(function(r){return function(t){return n.multiple&&e.attr("multiple",!0),n.accept&&e.attr("accept",n.accept),e.on("change",function(s){var i,a,o,l,c,d,b;for(c=function(){var h,y,g,w;for(g=s.target.files,w=[],h=0,y=g.length;h<y;h++)o=g[h],w.push(o);return w}(),a=[],typeof n.on_pick_files=="function"&&n.on_pick_files(c),d=0,b=c.length;d<b;d++)l=c[d],n.max_size&&l.size>n.max_size&&a.push(["You selected an image greater than the max size "+I.format_bytes(n.max_size)+" (you selected a "+I.format_bytes(l.size)+" file)",l]);if(a.length){t.reject(a,c);return}return n.test_file?(i=c.map(function(h){return $.Deferred(function(y){return n.test_file(h,y),setTimeout(function(){if(t.state()==="pending")return y.reject("Timed out checking file, are you sure it was an image file?")},1e3)}).catch(function(y){throw[y,h]})}),$.when.apply($,i).done(function(h){return t.resolve(c)}).fail(function(h){return t.reject([h])})):t.resolve(c)}),e.click()}}(this))},I.xhr_upload=function(n,e){return $.Deferred(function(r){return function(t){var s,i,a,o,l;s=new FormData,a=e.post_params;for(i in a)o=a[i],s.append(i,o);return s.append("file",n),l=new XMLHttpRequest,l.upload.addEventListener("progress",function(c){if(c.lengthComputable)return t.notify("progress",c.loaded,c.total)}),l.upload.addEventListener("error",function(c){return t.reject("xhr error")}),l.upload.addEventListener("abort",function(c){return t.reject("xhr aborted")}),l.addEventListener("readystatechange",function(c){var d;if(l.readyState===4){if(Math.floor(l.status/100)===2)return t.resolve();if(d="Failed upload.",l.responseXML)try{d=l.responseXML.querySelector("Error Message").innerHTML}catch(b){c=b}else d=l.responseText;return t.reject(d)}}),l.open("POST",e.action),l.send(s)}}(this))},I.upload_image=function(n){return n==null&&(n={}),n.accept||(n.accept="image/png,image/jpeg,image/gif"),n.file_params=function(e){return e.type==="video/mp4"?I.video_dimensions(e).then(function(r){return function(t){var s,i;return i=t[0],s=t[1],{width:i,height:s}}}(this)):I.image_dimensions(e).then(function(r){return function(t){var s,i;return i=t[0],s=t[1],{width:i,height:s}}}(this))},I.upload_file(n)};var Rt=function(n,e){var r,t,s;return e==null&&(e={}),t=e.on_start_upload,s=e.test_file,r=e.file_params?e.file_params(n):{},$.when(r).then(function(i){return function(a){return $.ajax({url:e.url,type:"post",xhrFields:{withCredentials:!0},data:I.with_csrf(Object.assign({filename:n.name,thumb_size:e.thumb_size,action:"prepare"},a))}).then(function(o){var l;return l=I.xhr_upload(n,o).then(function(){return $.ajax({url:o.success_url,type:"post",xhrFields:{withCredentials:!0},data:I.with_csrf()})}),typeof t=="function"&&t(n,o,l),l})}}(this))};I.upload_file=function(n){var e,r,t,s,i;if(n==null&&(n={}),!n.url)throw new Error("missing url for upload image");return e=n.accept,r=n.max_size,t=n.multiple,s=n.on_pick_files,i=n.test_file,I.pick_files({accept:e,max_size:r,multiple:t,test_file:i,on_pick_files:s}).then(function(a){return function(o){var l,c;if(!t&&o.length>1)throw"Got multiple files for single upload";return c=function(){var d,b,h,y;for(h=o.slice(0,6),y=[],d=0,b=h.length;d<b;d++)l=h[d],y.push(Rt(l,n));return y}(),t?$.when.apply($,c):c[0]}}(this))},I.make_upload_button=function(n,e){var r,t;return r=null,t=n.data("max_size"),n.on("click",function(s){return function(i){var a;return r&&r.remove(),r=$("<input type='file' multiple />").hide().insertAfter(n),(a=n.data("accept"))&&r.attr("accept",a),r.on("change",function(){var o,l,c,d,b;for(d=r[0].files,b=[],l=0,c=d.length;l<c;l++){if(o=d[l],t!=null&&o.size>t){I.flash(o.name+" is greater than max size of "+I.format_bytes(t),"error");continue}b.push(typeof e=="function"?e(o):void 0)}return b}),r.insertAfter(n),r.click()}}(this))};var Ct=null;I.libs.react.done(function(){var n,e,r,t,s,i,a,o,l,c,d;return e=F,l=e.section,o=e.p,d=e.ul,r=e.button,t=e.div,i=e.input,c=e.select,s=e.h3,a=e.label,n=R.package("JamEdit"),n("ReferrerAnalytics",{getInitialState:function(){return{current_tab:this.props.by_url?"url":"domain",by_url:this.props.by_url,by_domain:this.props.by_domain}},set_tab:function(b){return this.setState({current_tab:b,errors:null,loading:!this.state["by_"+b]},function(h){return function(){var y,g;if(!h.state["by_"+b])return y=h[g="fetch_"+b]||(h[g]=he($.getJSON("",{data:"referrers",referrer_group_by:b}))),y.fail(function(w){if(h.state.current_tab===b)return h.setState({errors:w.errors,loading:!1})}),y.done(function(w){if(h.setState(w),h.state.current_tab===b)return h.setState({loading:!1,errors:null})})}}(this))},render:function(){var b,h;return(b=this.props.by_url)!=null&&b.length||(h=this.props.by_domain)!=null&&h.length?this.enclose({component:"section"},o({},"Incoming visits from other sites over the past "+this.props.days+" days"),d({className:"page_tabs"},r({type:"button",className:classNames("tab",{active:this.state.current_tab==="url"}),onClick:function(y){return function(g){return y.set_tab("url")}}(this)},"By URL"),r({type:"button",className:classNames("tab",{active:this.state.current_tab==="domain"}),onClick:function(y){return function(g){return y.set_tab("domain")}}(this)},"By website/domain")),this.state.errors?R.Forms.FormErrors({errors:this.state.errors,scroll_into_view:!0}):this.state.loading?t({className:"loader_spinner"}):Ze({mode:"by_"+this.state.current_tab,by_url:this.state.by_url,by_domain:this.state.by_domain})):null}}),Ct=n("Analytics",{getInitialState:function(){return{range_left:this.props.graphs.range_left,range_right:this.props.graphs.range_right,group_by:this.props.graphs.interval,views:this.props.graphs.views,max_date:this.props.today}},refresh_graphs:function(){var b,h,y,g,w,u,f;if(!this.state.loading){for(this.setState({loading:!0}),g={},w=this.container().find("input, select").serializeArray(),b=0,h=w.length;b<h;b++)u=w[b],y=u.name,f=u.value,g[y]=f;return $.getJSON("",g).then(function(k){return function(p){if(p.range_left)return k.setState(Object.assign(p,{loading:!1}))}}(this))}},on_update_range:function(b){return this.setState(b,function(h){return function(){return h.refresh_graphs()}}(this))},render:function(){return this.enclose({className:{loading:this.state.loading}},l({},s({},"Visitors"),o({},"Analytics only include traffic to your jam's main page. Traffic to sub-pages and submission pages is not included. Historical analytics are not available before December 7, 2023."),Me({loading:this.state.loading,range_left:this.state.range_left,range_right:this.state.range_right,group_by:this.state.group_by,preset_ranges:this.props.preset_ranges,max_date:this.props.max_date,on_update_range:this.on_update_range}),t({className:"graphs"},ne({class:"graph_container",label:"Views",data:this.state.views,interval:this.state.group_by,range_left:this.state.range_left,range_right:this.state.range_right}))),n.ReferrerAnalytics(this.props.referrers))}})}),window.init_DashboardJamAnalytics=function(n,e){M.render(n+" .analytics_drop",()=>Ct(e))},window.init_DashboardJamParticipants=function(n,e){new I.DashboardJamParticipants(n,e)},window.init_DashboardJamPromoImages=function(n,e){};var _e=null;E.libs.react.done(function(){var n,e;return n=F,e=n.img,_e=function(r){var t,s,i,a,o;return r==null&&(r={}),o=(s=r.width)!=null?s:24,t=(i=r.height)!=null?i:o,P.createElement("svg",{className:"svgicon icon_close",strokeLinecap:"round",stroke:"currentColor",role:"img",version:"1.1",viewBox:"0 0 24 24",strokeWidth:(a=r.stroke_width)!=null?a:"2",width:o,height:t,strokeLinejoin:"round","aria-hidden":!0,fill:"none"},P.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),P.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))},_e=P.createElement.bind(null,P.memo(_e))});var re=null,et=null,Y=null;I.libs.react.done(function(){var n,e,r,t,s,i,a,o;return n=F,e=n.a,s=n.div,r=n.button,a=n.label,i=n.h2,o=n.p,t=null,Y=function(l){return l.promise?(I.Lightbox.open_loading(),l.then(function(c){return function(d){return I.Lightbox.open(d)}}(this))):I.Lightbox.open(l)},re=M.component("Lightbox",{is_modal_dialog:function(){var l;return l=document.getElementById("lightbox_container"),l!=null?l.contains(this.container_ref.current):void 0},getInitialState:function(){return{}},componentDidMount:function(){if(this.is_modal_dialog())return t?console.warn("A dialog already has the focus trap"):(this.detect_focus=function(l){return function(c){var d;if(d=l.container_ref.current,d&&"contains"in d&&!(d===c.target||d.contains(c.target)))return d.focus()}}(this),$(document.body).on("focusin",this.detect_focus),t=this),this.setState({previously_focused:document.activeElement,is_modal_dialog:!0},function(){return _.defer(function(l){return function(){var c;return(c=l.container_ref.current)!=null?c.focus():void 0}}(this))})},componentWillUnmount:function(){var l;return this.detect_focus&&($(document.body).off("focusin",this.detect_focus),t=null,delete this.detect_focus),(l=this.state.previously_focused)!=null?l.focus():void 0},close:function(){return I.Lightbox.close()},render:function(){return s({className:classNames("lightbox",this.props.className),style:this.props.style,role:this.state.is_modal_dialog?"dialog":void 0,"aria-modal":this.state.is_modal_dialog?"true":void 0,tabIndex:this.state.is_modal_dialog?-1:void 0,ref:this.container_ref||(this.container_ref=React.createRef())},this.props.close!==!1?r({className:"close_button",type:"button","aria-label":"Close Dialog"},_e({width:18})):void 0,this.props.children)}}),et=M.component("ErrorLightbox",{propTypes:{title:j.string,errors:j.array.isRequired},render:function(){return re({className:classNames(this.enclosing_class_name(),"compact")},i({},this.props.title||this.tt("misc.lightboxes.error_title")),M.Forms.FormErrors({title:!1,errors:this.props.errors}),o({className:"buttons"},r({className:"button",type:"button",onClick:function(l){return function(){return I.Lightbox.close()}}(this)},"Close")))}})});var Dt=[].slice,le=null,tt=null,rt=null,Ar=null,qr=null,jt=null,Et=null;E.libs.react.done(function(){var n,e,r;return n=F,e=n.a,r=n.img,le=function(){var t,s,i;return i=arguments[0],s=2<=arguments.length?Dt.call(arguments,1):[],i==null&&(i={}),P.createElement.bind(null,P.memo(t=function(a){var o,l,c,d;return P.createElement.apply(P,["svg",{className:G("svgicon",a.className,i.className),role:"img",version:"1.1",viewBox:"0 0 24 24",width:(o=a.width)!=null?o:"24",height:(l=a.height)!=null?l:"24",fill:(c=(d=a.fill)!=null?d:i.fill)!=null?c:"none",stroke:"currentColor",strokeWidth:"2",strokeLinejoin:"round",strokeLinecap:"round","aria-hidden":!0}].concat(Dt.call(s)))}))},tt=le({className:"icon_tri_up",fill:"currentColor"},P.createElement("polygon",{points:"2 18 12 6 22 18"})),rt=le({className:"icon_tri_down",fill:"currentColor"},P.createElement("polygon",{points:"2 6 12 18 22 6"})),Ar=le({className:"icon_filter"},P.createElement("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})),qr=le({className:"icon_edit"},P.createElement("path",{d:"M20 14.66V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h5.34"}),P.createElement("polygon",{points:"18 2 22 6 12 16 8 16 8 12 18 2"})),jt=le({className:"icon_external_link"},P.createElement("path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}),P.createElement("polyline",{points:"15 3 21 3 21 9"}),P.createElement("line",{x1:"10",y1:"14",x2:"21",y2:"3"})),Et=le({className:"icon_help"},P.createElement("circle",{cx:"12",cy:"12",r:"10"}),P.createElement("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),P.createElement("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"}))});var Tt=null;I.libs.react.done(function(){var n,e,r,t,s,i,a,o,l,c,d,b,h,y,g,w,u,f,k,p,x,v;return t=F,k=t.span,h=t.h2,u=t.p,v=t.ul,g=t.li,p=t.strong,s=t.a,a=t.button,l=t.div,c=t.em,o=t.code,b=t.fragment,d=t.form,w=t.option,f=t.section,y=t.input,b=React.createElement.bind(null,React.Fragment),b.type=React.fragment,r=M.package("JamEdit"),i=F.abbr,x=PropTypes,n=function(m){var N;return N=m.date,i({className:"date_format",title:N},k({className:"icon icon-stopwatch","aria-hidden":"true"})," ",Ne(N))},n=React.createElement.bind(null,React.memo(n)),e=r("HelpLightbox",{render:function(){return M.Lightbox({ref:this.lightbox_ref||(this.lightbox_ref=React.createRef()),className:G(this.enclosing_class_name(),"compact")},h({},"Report Moderation"),u({},"Jam hosts can moderate jam submissions with the help of user reports. The following actions are available:"),v({},g({},p({},"Dismiss")," \u2014 ","The report is moved out of the pending list, no other action is taken. You can review dismissed reports at a later time if action needs to be taken."),g({},p({},"Disqualify")," \u2014 ","The submission remains part of the jam, but is disqualified. It will no longer display on main submissions list, and is no longer eligible for ratings and rankings. The submission page is still available by URL, and comments can still be left on the page. The submission can be re-qualified at a later time by a jam host."),g({},p({},"Ban Account")," \u2014 ","The submission is permanently removed from the jam. The submission page is deleted, including any comments. The account is banned from submitting any of their pages to the jam if the submission period is still active. If the account submitted any other entries to the jam, they are also removed. This operation can not be undone.")),u({},a({className:"button",type:"button",onClick:function(m){return function(){var N,S;return(N=m.lightbox_ref)!=null&&(S=N.current)!=null?S.close():void 0}}(this)},"Close")))}}),r("SubmissionReport",{pure:!0,getInitialState:function(){return{}},submit_action:function(m,N){if(m==null&&(m="dismiss_report"),N==null&&(N={}),!this.state.loading)return this.setState({loading:!0}),$.ajax({type:"POST",url:this.props.update_report_url,data:I.with_csrf(Object.assign({game_report_id:this.props.report.id,action:m},N)),dataType:"json",xhrFields:{withCredentials:!0}}).done(function(S){return function(C){var D,L;return C.errors?typeof(D=S.props).set_errors=="function"?D.set_errors(C.errors):void 0:typeof(L=S.props).update_report=="function"?L.update_report(S.props.report,C.report):void 0}}(this)).always(function(S){return function(){return S.setState({loading:!1})}}(this))},render:function(){var m,N,S,C,D,L,O,A,H;return A=this.props.report,m=(N=(S=A.jam_game)!=null?S.url:void 0)!=null?N:A.game.url,this.enclose({className:G({loading:(C=this.state)!=null?C.loading:void 0})},s({className:"game_cover_link",href:m},A.game.cover_url?we({width:105,height:83,src:A.game.cover_url,class:"game_cover",alt:A.game.title+" Cover Image"}):l({className:"game_cover empty"},"no image :(")),l({className:"report_content_column"},l({className:"report_header"},k({title:"Report ID - Send this to Customer Support if you need help",className:"report_id"},"#"+A.id)," ",k({},s({href:m},A.game.title)," by ",s({href:A.game.user.url},A.game.user.name)),this.props.set_search?k({className:"filter_links"},this.props.search_query===A.game.id?a({className:"button small",onClick:function(J){return function(){return J.props.set_search("")}}(this)},"Unfilter"):a({className:"button outline small",onClick:function(J){return function(){return J.props.set_search(A.game.id)}}(this)},"Filter")):void 0),A.jam_game?void 0:l({className:"submission_status"},k({className:"icon icon-warning"})," ",p({},"This project is no longer submitted to the jam")),(D=A.jam_game)!=null&&D.disqualified?l({className:"submission_status"},k({className:"icon icon-warning"})," ",p({title:"You can requalify the entry from the submission page"},"This entry is disqualified")):void 0,(L=A.jam_user)!=null&&L.ban_submission?l({className:"submission_status"},k({className:"icon icon-warning"})," ",p({},"Account banned")):void 0,l({className:"reporter"},"Reported ",n({date:A.created_at})," by ",A.reporter.url?s({href:A.reporter.url},A.reporter.name):c({},A.reporter.name)),A.reason?l({className:"report_reason"},p({},"Reason: "),o({},A.reason)):void 0,A.description?l({className:"report_description"},A.description):void 0,l({className:"report_tools"},(O=A.report_review)!=null&&(O.status="dismissed")?(H=A.report_review,b({},a({type:"button",className:"button disabled outline",disabled:!0},"Dismissed"),a({type:"button",className:"textlike",onClick:this.requeue_report||(this.requeue_report=function(J){return function(){return J.submit_action("requeue_report")}}(this)),title:"Put the report back onto the queue for review"},"Requeue"),H.user?k({className:"report_user"},"Reviewed by ",s({href:H.user.url},H.user.name)," ",n({date:H.created_at})):void 0)):this.render_action_form())))},render_action_form:function(){var m,N,S;return S=this.props.report,m=[{value:"dismiss",name:"Dismiss"}],(N=S.jam_game)!=null&&N.disqualified||m.push({value:"dismiss_disqualify",name:"Dismiss and Disqualify"}),m.push({value:"dismiss_ban",name:"Dismiss and Ban Account"}),b({},a({onClick:function(C){return function(){var D;switch(D=C.dismiss_action_ref.current.current_option(),D.value){case"dismiss":return C.submit_action("dismiss_report");case"dismiss_disqualify":return C.submit_action("dismiss_report",{disqualify:"on"});case"dismiss_ban":return C.submit_action("dismiss_report",{ban:"on"})}}}(this),type:"button",className:"button"},"Update"),M.Forms.SimpleSelect({ref:this.dismiss_action_ref||(this.dismiss_action_ref=React.createRef()),name:"action",options:m}),a({type:"button",className:"help_button textlike",title:"Help",onClick:function(C){return function(D){return Y(e({}))}}(this)},Et({width:18,height:18})))}}),Tt=r("EditReports",{componentDidMount:function(){return this.fetch_page()},getInitialState:function(){return{loading:!0,filter_status:null}},fetch_next_page:function(){if(this.state.next_page)return this.fetch_page(this.state.next_page)},fetch_page:function(m){var N;return m==null&&(m=null),this.current_req&&this.current_req.abort(),N=this.props.reports_url+"?"+$.param({status:this.state.filter_status,game:this.state.search_query,after_id:m}),this.setState({errors:null,loading:!0}),this.current_req=$.getJSON(N).done(function(S){return function(C){var D;return delete S.current_req,D=m?S.state.reports.concat(C.reports):C.reports,S.setState(Object.assign({loading:!1},C,{reports:D}))}}(this))},render:function(){var m;return this.enclose({},this.state.errors?M.Forms.FormErrors({errors:this.state.errors,scroll_into_view:!0}):void 0,f({className:"result_filters"},f({className:"page_tabs"},a({className:G("tab",{active:!this.state.filter_status}),onClick:function(N){return function(){return N.set_filter_status(null)}}(this)},"Pending"),a({onClick:function(N){return function(){return N.set_filter_status("dismissed")}}(this),className:G("tab",{active:this.state.filter_status==="dismissed"})},"Dismissed")),d({className:"search_fields form",onSubmit:function(N){return function(S){return S.preventDefault(),N.fetch_page()}}(this)},y({type:"text",name:"game",placeholder:"Game URL/Submission URL/Game ID",value:this.state.search_query||"",onChange:function(N){return function(S){return N.setState({search_query:S.target.value})}}(this)}))),this.state.loading&&!((m=this.state.reports)!=null&&m.length)?u({className:"loadin_message"},"Loading..."):this.render_reports())},set_errors:function(m){return this.setState({errors:m})},set_search:function(m){return this.setState({search_query:m},function(N){return function(){return N.fetch_page()}}(this))},update_report:function(m,N){return this.setState(function(S){return{reports:S.reports.map(function(C){return function(D){return D===m?N:D}}(this))}})},set_filter_status:function(m){return this.setState({filter_status:m},function(N){return function(){return N.fetch_page()}}(this))},render_reports:function(){var m;return(m=this.state.reports)!=null&&m.length?f({className:G("report_list",{loading:this.state.loading})},this.state.reports.map(function(N){return function(S){return r.SubmissionReport({key:S.id,update_report_url:"",update_report:N.update_report,set_errors:N.set_errors,set_search:N.set_search,search_query:N.state.search_query,report:S})}}(this)),this.state.has_more?a({className:"button outline load_more_btn",type:"button",onClick:function(N){return function(S){return S.preventDefault(),N.fetch_next_page()}}(this)},"Load more"):void 0):f({className:"report_list"},u({className:"empty_message"},"No reports"))}})}),window.init_DashboardJamReports=function(n,e){M.render(n+" .reports_editor_drop",()=>Tt(e))},I.DashboardJamSubmissions=function(){function n(e){this.el=$(e),this.setup_late_submit_form(),this.el.dispatch("click",{disqualify_submission_btn:function(r){return function(t){var s;if(s=t.closest(".jam_game"),!s.is(".loading"))return s.addClass("loading"),$.post(t.data("href"),I.with_csrf(),function(i){if(i.errors&&Y(R.ErrorLightbox({errors:i.errors})),i.redirect_to)return window.location=i.redirect_to})}}(this),remove_game_btn:function(r){return function(t){var s;if(s=t.closest(".jam_game"),!s.is(".loading")&&confirm("Are you sure you want to remove this submission? The owner will be able to resubmit unless they have been banned from the jam."))return s.addClass("loading"),$.post(t.data("href"),I.with_csrf(),function(i){return s.slideUp(function(){return s.remove()})})}}(this)})}return n.prototype.setup_late_submit_form=function(){return this.late_submit=this.el.find(".late_submit_form"),this.late_submit.remote_submit(function(e){return function(r){if(Y(R.JamEdit.LateSubmitLightbox(r)),!r.errors)return e.late_submit.find(".game_url_input").val("")}}(this))},n}(),window.init_DashboardJamSubmissions=function(n,e){new I.DashboardJamSubmissions(n)},E.Lightbox||console.warn("I.Lightbox is being depended on but is missing from the page");var me=E.Lightbox,Ur=function(n,e){for(var r in e)Gr.call(e,r)&&(n[r]=e[r]);function t(){this.constructor=n}return t.prototype=e.prototype,n.prototype=new t,n.__super__=e.prototype,n},Gr={}.hasOwnProperty,nt=function(n){Ur(e,n);function e(){return e.__super__.constructor.apply(this,arguments)}return e.prototype.init=function(){return this.el.has_tooltips(),this.el.dispatch("click",{show_download_btn:function(r){return function(t){return r.el.toggleClass("show_download_group")}}(this)})},e}(me);window.init_DashboardPurchase=function(n,e){new nt($(n).find(".lightbox"))};var Or=function(n,e){for(var r in e)zr.call(e,r)&&(n[r]=e[r]);function t(){this.constructor=n}return t.prototype=e.prototype,n.prototype=new t,n.__super__=e.prototype,n},zr={}.hasOwnProperty,Pt=function(n){Or(e,n);function e(){return e.__super__.constructor.apply(this,arguments)}return e.prototype.init=function(r){return this.el.dispatch("click",{tab_btn:function(t){return function(s){var i;return i=s.data("tab"),t.el.find(".tab_content").hide().filter("[data-tab="+i+"]").show(),t.el.find(".tab_btn").removeClass("selected").filter(s).addClass("selected")}}(this),pick_image_btn:function(t){return function(s){return typeof r=="function"?r(s.data("url")):void 0}}(this),upload_image_btn:function(t){return function(s){return E.upload_image({url:E.root_url("dashboard/upload-image"),thumb_size:"original"}).progress(function(){if(!s.prop("disabled"))return s.prop("disabled",!0).addClass("disabled"),s.data("original_text",s.text()),s.text("Uploading...")}).fail(function(){return s.prop("disabled",!1).removeClass("disabled"),s.text(s.data("original_text"))}).done(function(i){var a,o;return s.prop("disabled",!1).removeClass("disabled"),s.text(s.data("original_text")),i.success?typeof r=="function"?r(i.upload.thumb_url):void 0:(a=((o=i.errors)!=null?o[0]:void 0)||"Image upload failed",E.flash(a,"error"))})}}(this)})},e}(me),Mt=null,Br={plugins:["source","table","alignment","video","addimage"],toolbarFixed:!1,buttons:["format","bold","italic","deleted","lists","link"],minHeight:250,linkSize:80},Vr=function(n){return E.libs.redactor.done(n)},ie=function(n,e){var r,t;if(e==null&&(e={}),!window.location.href.match(/\bredactor=0\b/)&&!E.in_test){if(!V.fn.redactor){console.warn("tried to create redactor text element without redactor on page",n[0]);return}e=V.extend({},Br,e),e.source===!1&&(delete e.source,e.plugins=function(){var s,i,a,o;for(a=e.plugins,o=[],s=0,i=a.length;s<i;s++)t=a[s],t!=="source"&&o.push(t);return o}()),n.closest(".lightbox_widget").exists()&&e.plugins&&(e.plugins=function(){var s,i,a,o;if(t!=="addimage"){for(a=e.plugins,o=[],s=0,i=a.length;s<i;s++)t=a[s],o.push(t);return o}}());try{return n.redactor(e)}catch(s){return r=s,E.event("error","redactor","invalid_content"),n.parent().replaceWith(n).end().val("").redactor(e)}}};V.Redactor?Mt=V.Redactor:E.libs.redactor.done(function(){return Mt=V.Redactor,V.Redactor.prototype.addimage=function(){return{langs:{en:{}},init:function(){var n;return n=this.button.addAfter("image","image","Add image"),this.button.setIcon(n,'<i class="re-icon-image"></i>'),this.button.addCallback(n,this.addimage.show)},show:function(){return me.open_remote(E.root_url("dashboard/upload-image"),Pt,function(n){return function(e){var r;return E.Lightbox.close(),r=V("<img>").attr("src",e)[0].outerHTML,n.placeholder.hide(),n.buffer.set(),n.insert.html(r)}}(this))}}}}),window.init_RedactorInput=function(n,e){Vr(function(){ie($(n),e)})},window.init_DashboardToolEdit=function(n,e){},window.init_DashboardToolGames=function(n,e){new I.DashboardToolGames(n,e)};var it=function(n,e,r){var t,s,i,a,o,l,c,d,b;for(e==null&&(e=null),r==null&&(r=!0),typeof n=="number"&&(n=xe.duration(n)),c=[["y","years","a year"],["m","months","a month"],["d","days","a day"],["h","hours","an hour"],["m","minutes","a minute"],["s","seconds","a second"]],o=[],s=0,a=c.length;s<a&&(l=c[s],!(e&&o.length===e));s++)i=l[0],t=l[1],d=l[2],b=n[t](),b>0&&(b>1?t==="seconds"&&r?o.push("a few seconds"):o.push(b+" "+t):o.push(d));return o.length>1&&(o[o.length-1]="and "+o[o.length-1]),o.join(", ")},Hr=function(n,e){return function(){return n.apply(e,arguments)}};I.EditBundleForm=function(){n.prototype.date_format="yy-mm-dd",n.prototype.time_format="HH:mm:ss",n.prototype.format_date_time=function(e){var r,t;return t=$.datepicker.formatTime(this.time_format,{hour:e.getHours(),minute:e.getMinutes(),second:e.getSeconds()}),r=$.datepicker.formatDate(this.date_format,new Date(e)),r+" "+t};function n(e){this.format_date_time=Hr(this.format_date_time,this);var r,t;this.el=$(e),this.form=this.el.find("form").remote_submit(function(s){return function(i,a){if(i.errors){a.set_form_errors(i.errors);return}return a.set_form_errors([]),i.url?window.location=i.url:I.flash("Co-op bundle updated")}}(this)),t=this.el.find(".header_nav").find(".save_btn").on("click",function(s){return function(){return s.form.submit()}}(this)),this.form.on("i:before_submit",function(s){return function(){return t.prop("disabled",!0).addClass("disabled")}}(this)),this.form.on("i:after_submit",function(s){return function(){return t.prop("disabled",!1).removeClass("disabled")}}(this)),I.setup_dirty_warning(this.form),this.setup_datepickers(),this.setup_timezone(),this.el.format_timestamps(),(r=this.el.find("textarea"))&&ie(r,{minHeight:80}),this.el.dispatch("click",{delete_bundle_btn:function(s){return function(i){if(confirm("Are you sure you want to delete this bundle?"))return i.addClass("disabled"),$.ajax({type:"post",data:I.with_csrf(),url:i.data("url"),success:function(a){return window.location=a.redirect_to||"/"}})}}(this)})}return n.prototype.setup_datepickers=function(){var e,r,t,s,i,a;if(s=this.el.find(".date_picker"),!!s.length&&(i=this.el.find(".date_picker.start_date"),t=this.el.find(".date_picker.end_date"),e=this.el.find(".duration_summary"),a=function(o,l){var c,d,b;if(l==null&&(l=!0),l&&o.is(".start_date")&&(d=o.datetimepicker("getDate"),t.datetimepicker("option","minDate",new Date(+d))),b=i.datetimepicker("getDate"),c=t.datetimepicker("getDate"),b&&c)return e.text(it(c-b,3,!1))},!!s&&(Ie(s,{onSelect:function(o){return a($(this))}}),i.val())))return r=$.datepicker.parseDateTime(this.date_format,this.time_format,t.val()),t.datetimepicker("setDate",r),a(i)},n.prototype.setup_timezone=function(){return this.el.find(".timezone_offset").val(new Date().getTimezoneOffset()/60)},n}(),window.init_EditBundle=function(n,e){new I.EditBundleForm(n)};var Lt=null;I.libs.react.done(function(){var n,e,r,t,s,i;return e=F,s=e.h2,i=e.p,t=e.em,r=e.a,n=M.package("GameEdit"),Lt=n("DeleteBlockedLightbox",{render:function(){return re({className:this.enclosing_class_name()},s({},"This project can't be deleted"),i({},"This project currently has owners. Deleting this project would prevent them from being able to access it. If you want to prevent new people from seeing or buying the page please put it in ",t({},"Restricted")," mode. Alternatively you can just disable purchases."),i({},"For generated download keys, revoking them will enable you to delete the page. Keys generated from payment can only be revoked on refund."),i({},"If there are still circumstances where you need to delete the page, ",r({href:"/support"},"contact support")," and explain why and how you have ensured that any buyers still have access to what they have paid for, if relevant."),i({},r({href:"#",className:"close_btn"},"Got it")))}})});var Jr=[].slice,$e=null;I.libs.react.done(function(){var n,e,r,t,s,i,a,o;return e=F,i=e.p,s=e.li,a=e.strong,t=e.h2,o=e.ul,r=e.button,n=M.package("GameEdit"),$e=n("ErrorLightbox",{propTypes:{title:j.string,sub_text:j.string,errors:j.array.isRequired},format_field_name:function(l){var c;switch(l){case"short_text":l="short_description";break}return c=l.split("_").map(function(d){switch(d){case"url":return"URL";case"slug":return"Project URL";default:return d}}),c.join(" ")},parse_errors:function(){return this.props.errors.map(function(l){return function(c){var d,b,h,y;return(y=c.match(/([^:]+):\s*(.+)$/))?(d=y[0],h=y[1],b=y[2],s({},a({},l.format_field_name(h))," \u2014 ",b)):s({},c)}}(this))},render:function(){return re({className:"game_edit_error_lightbox_widget compact",close:!1,ref:this.lightbox_ref||(this.lightbox_ref=React.createRef())},t({},this.props.title||this.tt("dashboard.edit_project.error_dialog.title")),i({className:"sub_text"},this.props.sub_text),o.apply(null,[{className:"error_list"}].concat(Jr.call(this.parse_errors()))),i({className:"buttons"},r({className:"button",type:"button",onClick:function(l){return function(){var c;return(c=l.lightbox_ref.current)!=null?c.close():void 0}}(this)},this.tt("dashboard.edit_project.error_dialog.confirm_button"))))}})});var $t,Ft,At,Wr=function(n,e){return function(){return n.apply(e,arguments)}},Fe=function(n,e){for(var r in e)Kr.call(e,r)&&(n[r]=e[r]);function t(){this.constructor=n}return t.prototype=e.prototype,n.prototype=new t,n.__super__=e.prototype,n},Kr={}.hasOwnProperty;At=E.lazy_template,$t={flash:/^swf$/,unity:/^unity3d$/,java:/^jar$/,html:/^zip|html$/},Ft=function(n){var e;if(n)return e=n.match(/\.(\w+)$/),e!=null?e[1].toLowerCase():void 0};var st=function(n,e){var r,t,s;return t=n.filename,t?(s=$t[e],r=Ft(t),r&&s&&s.test(r)):!1},at=function(n){Fe(e,n),e.prototype.kind="upload";function e(r,t){this.file=r,this.opts=t!=null?t:{},this.mark_failed=Wr(this.mark_failed,this),e.__super__.constructor.apply(this,arguments),this.state="uploading",this.deferred=$.Deferred()}return e.prototype.to_props=function(){var r,t,s,i;return{id:(r=this.upload_data)!=null?r.upload_id:void 0,edit_url:(t=this.upload_data)!=null?t.edit_url:void 0,state:this.state,filename:(s=this.file)!=null?s.name:void 0,size:(i=this.file)!=null?i.size:void 0,progress_percent:this.progress_percent,errors:this.errors,file_upload:this}},e.prototype.have_upload_data=function(){return this.deferred.notify("upload_data",this.upload_data)},e.prototype.progress=function(r,t){return this.progress_percent=Math.round(r/t*100),this.deferred.notify("progress",this.progress_percent)},e.prototype.mark_failed=function(r){return this.errors=r,this.state="failed",this.deferred.reject()},e.prototype.start_upload=function(){return e.__super__.start_upload.call(this).fail(function(r){return function(t){return r.mark_failed(t!=null?t.errors:void 0)}}(this))},e.prototype.prepare_upload=function(){var r;return((r=this.file)!=null?r.name:void 0)==="UnityPlayer.dll"?$.Deferred().reject({errors:["Do not upload UnityPlayer.dll, you must package your project","Please read https://itch.io/t/3260941/packaging-your-unity-game-for-itchio-a-step-by-step-guide"]}):e.__super__.prepare_upload.call(this).done(function(t){return function(){return t.have_upload_data()}}(this))},e.prototype.save_upload=function(){return e.__super__.save_upload.call(this).done(function(r){return function(){return r.state="ready",r.deferred.resolve()}}(this))},e}($r),qt=function(n){Fe(e,n);function e(){return e.__super__.constructor.apply(this,arguments)}return e.prototype.poll_delay=1e3,e.prototype.start_upload=function(){if(this.upload_data){console.warn("Attempt to start_upload when upload has already been started");return}return this.progress(1,1),$.when(this.opts.upload_prefix||this.upload_prefix).then(function(r){return function(t){var s;return s=he($.ajax({url:t+"/upload/slurp",type:"post",dataType:"json",data:E.with_csrf({filename:r.file.name,kind:"upload",url:r.file.link})})),s.fail(function(i){return r.mark_failed(i.errors)}),s.then(function(i){return r.upload_data=i,r.have_upload_data(),r.poll_for_completion()})}}(this))},e.prototype.poll_for_completion=function(){var r,t;if(!this.upload_data){console.warn("attempted to poll for completion without upload data");return}return t=function(s){return function(){return $.Deferred(function(i){return setTimeout(function(){return s.poll_delay=Math.min(s.poll_delay+200,4e3),i.resolve()},s.poll_delay)}).then(function(){return s.poll_for_completion()})}}(this),r=$.ajax({type:"get",url:this.upload_data.poll_url,dataType:"json"}),r.fail(t),r.then(function(s){return function(i){var a;return i.errors?(s.mark_failed(i.errors),$.Deferred().reject(i)):i.deleted?(a=["Failed to transfer file from remote server"],s.mark_failed(a),$.Deferred().reject({errors:a})):i.ready?(s.state="ready",s.deferred.resolve(),i):t()}}(this))},e}(at),Yr=function(n){Fe(e,n);function e(){return e.__super__.constructor.apply(this,arguments)}return e.prototype.upload_params=function(){return{kind:"upload",storage:"external"}},e.prototype.to_props=function(){var r;return r=e.__super__.to_props.call(this),r.external=!0,r},e.prototype.start_upload=function(){return this.prepare_upload().then(function(r){return function(t){return r.state="ready",r.deferred.resolve(),t}}(this))},e}(at),Xr=function(n){Fe(e,n),e.prototype.template=At(e,"screenshot_uploader"),e.prototype.save_params=function(){return{type:"screenshot",thumb_size:"editor_preview"}};function e(){e.__super__.constructor.apply(this,arguments),this.el=$(this.template(this)),this.progress_inner=this.el.find(".progress_inner")}return e.prototype.prepare_upload=function(){var r;return r=function(t){return t.then(null,function(s){return $.Deferred().reject({errors:[s]})})},r(E.test_image_format(this.file)).then(function(t){return function(){return r(E.test_image_dimensions(t.file))}}(this)).then(function(t){return function(){return e.__super__.prepare_upload.call(t)}}(this))},e.prototype.progress=function(r,t){var s,i;return s=Math.round(100*r/t),(i=this.progress_inner)!=null?i.css("right",100-s+"%"):void 0},e}(Fr),Ut;Ut=I.get_template,I.EditGame=function(){function n(e,r){var t;this.opts=r,this.game=this.opts.game,this.user_slug=this.opts.user_slug,this.is_new=!this.game.id,this.el=$(e),this.form=this.el.find("form"),this.el.has_tooltips(),this.setup_type_picker(),this.setup_screenshots(),this.setup_redactor(),this.setup_slug_picker(),this.setup_classification_picker(),I.setup_selectize(this.el),t=this.el.find(".header_nav").find(".save_btn").on("click",function(s){return function(){return s.form.find(".save_btn").trigger("click")}}(this)),this.form.remote_submit(function(s){return function(i,a){var o,l;if(i.game&&($.extend(s.game,i.game),(l=i.game.edit_url)&&typeof(o=window.history).replaceState=="function"&&o.replaceState({},"Edit project",l),s.form.attr("action",s.game_prefix())),i.errors){Y($e({errors:i.errors,sub_text:"Please correct the errors and try again"})),s.game_deferred&&s.game_deferred.reject(i);return}if(s.game_deferred)return s.game_deferred.resolve(s.game);if(s.is_new){if(s.game.url)return window.location=s.game.url}else return I.flash("Saved")}}(this)),this.form.on("i:before_submit",function(s){return function(){return t.prop("disabled",!0).addClass("disabled")}}(this)),this.form.on("i:after_submit",function(s){return function(){return t.prop("disabled",!1).removeClass("disabled")}}(this)),I.setup_dirty_warning(this.form),R.dispatch(this.el,{"game:resolve_upload_prefix":function(s){return function(i,a){return s.with_game().done(function(){return a.resolve(s.upload_prefix())}).fail(function(){return a.reject()})}}(this)}),this.el.dispatch("click",{delete_game_btn:function(s){return function(i){if(s.opts.delete_blocked){Y(Lt({}));return}if(confirm("Are you sure you want to delete this game?"))return i.addClass("disabled"),$.ajax({type:"post",data:I.with_csrf(),url:i.data("url"),success:function(a){return window.location=a.redirect_to||"/"}})}}(this)})}return n.prototype.setup_slug_picker=function(){return I.slug_input(this.el.find(".slug_input"),this.el.find(".title_input"))},n.prototype.setup_redactor=function(){var e,r,t,s,i;if(this.opts.enable_codemirror){for(t=this.el.find("textarea"),s=[],e=0,r=t.length;e<r;e++)i=t[e],s.push(CodeMirror.fromTextArea(i,{mode:"htmlmixed",lineNumbers:!0,tabSize:2}));return s}else return ie(this.el.find(".game_description_input"),{minHeight:200}),ie(this.el.find(".game_instructions_input"),{minHeight:60})},n.prototype.setup_screenshots=function(){var e,r,t,s,i;if(this.screen_editor=this.el.find(".screenshot_editor"),this.screen_list=this.screen_editor.find(".screenshot_list"),this.screen_queue=this.screen_editor.find(".screenshot_queue"),e=this.screen_editor.find(".add_screenshot_btn"),I.make_upload_button(e,function(a){return function(o){var l;return l=new Xr(o,{upload_prefix:a.with_game().then(function(){return a.upload_prefix()})}),l.start_upload().done(function(c){return l.el.remove(),a.add_screenshot(c),a.update_screenshot_positions()}).fail(function(c){return Y(et({errors:c.errors})),l.el.remove(),a.update_screenshot_positions()}),a.screen_queue.append(l.el)}}(this)),this.game.screenshots)for(s=this.game.screenshots,r=0,t=s.length;r<t;r++)i=s[r],this.add_screenshot(i);return this.update_screenshot_positions(),this.screen_list.dispatch("click",{delete_screen_btn:function(a){return function(o){var l,c;if(i=o.closest(".screenshot"),l=i.data("screen"),c=l.id,confirm("Are you sure you want to delete this screenshot?"))return a.delete_screenshot(c),i.remove(),a.update_screenshot_positions()}}(this),move_screen_up_btn:function(a){return function(o){var l;return l=o.closest(".screenshot"),l.swap_with(l.prev()),a.update_screenshot_positions()}}(this),move_screen_down_btn:function(a){return function(o){var l;return l=o.closest(".screenshot"),l.swap_with(l.next()),a.update_screenshot_positions()}}(this)})},n.prototype.delete_screenshot=function(e){return $.when(this.upload_prefix()).then(function(r){return function(t){return $.ajax({url:t+"/image/delete/"+e,type:"post",data:I.with_csrf()})}}(this))},n.prototype.update_screenshot_positions=function(){var e,r,t,s,i,a;for(this.screen_list.toggleClass("has_image",this.screen_list.find("> *").length>0),i=this.screen_list.find(".screenshot_position_input"),a=[],e=t=0,s=i.length;t<s;e=++t)r=i[e],a.push($(r).val(e));return a},n.prototype.add_screenshot=function(e){return this.screen_template||(this.screen_template=Ut("screenshot")),this.screen_list.addClass("has_image"),e=$(this.screen_template(e)).data("screen",e),e.appendTo(this.screen_list)},n.prototype.setup_type_picker=function(){return this.type_picker||(this.type_picker=this.el.find(".game_type_picker")),this.type_picker.on("change",function(e){return function(r){var t;t=$(r.target).val(),R.trigger(e.form,"game:set_state",{type:t}),e.el.removeClass("type_flash type_unity type_java type_html"),t!=="default"&&e.el.addClass("type_"+t)}}(this))},n.prototype.setup_classification_picker=function(){var e,r,t;return this.classification_picker=this.el.find(".classification_picker").find("select"),r=this.classification_picker.closest("[data-nouns]").data("nouns"),e=this.el.find(".user_classification_noun"),t=function(s){return function(){var i;return i=s.classification_picker.val(),R.trigger(s.form,"game:set_state",{classification:i}),e.text(r[i])}}(this),this.classification_picker.on("change",t),t()},n.prototype.game_prefix=function(){return"/game/edit/"+this.game.id},n.prototype.upload_prefix=function(){return this.game_prefix()},n.prototype.with_game=function(){return this.game.id!=null?$.Deferred().resolve(this.game):(this.game_deferred||(this.game_deferred=$.Deferred(function(e){return function(){return e.form.trigger("submit")}}(this)).always(function(e){return function(){return delete e.game_deferred}}(this))),this.game_deferred)},n}();var Qr=[].indexOf||function(n){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===n)return e;return-1},Gt=[].slice,Ot=null,zt=null,Bt=null,Vt=null,Ht=null;I.libs.react.done(function(){var n,e,r,t,s,i,a,o,l,c,d,b,h,y,g,w,u,f,k;return e=F,d=e.label,i=e.div,c=e.input,y=e.p,g=e.span,r=e.a,t=e.button,u=e.strong,h=e.option,o=e.h2,k=e.ul,b=e.li,l=e.iframe,s=e.code,a=e.form,n=R.package("GameEdit"),f=PropTypes,w=[{label:"Steam",name:"steam_url",example:"http://store.steampowered.com/app/220/HalfLife_2/"},{label:"Apple App Store",name:"app_store_url",example:"https://itunes.apple.com/us/app/my-game/id879877684?mt=8&uo=4"},{label:"Google Play",name:"google_play_url",example:"https://play.google.com/store/apps/details?id=com.mygame.example"},{label:"Amazon App Store",name:"amazon_appstore_url",example:"http://www.amazon.com/Foobar/dp/B00992CF6W"},{label:"Windows Store",name:"windows_phone_url",example:"https://www.microsoft.com/en-us/store/apps/itchio/9nblgggz6166"}],Bt=n("GameLinks",{pure:!0,propTypes:{tags:f.array,app_store_url:f.string,google_play_url:f.string,amazon_appstore_url:f.string,windows_phone_url:f.string},getInitialState:function(){var p,x;return x=function(){var v,m,N;for(N=[],v=0,m=w.length;v<m;v++)p=w[v].name,this.props[p]&&N.push(p);return N}.call(this),{open_stores:x}},store_by_name:function(p){return function(x){var v,m,N;for(v=0,m=w.length;v<m;v++)if(N=w[v],N.name===x)return N}}(this),render:function(){return i({className:"links_editor"},this.render_ludum_dare_input(),i({className:"input_row app_store_links_row"},i({className:"label"},"App store links",y({className:"sub"},"If your project is available on any other stores we'll link to it.")),this.render_store_links()))},has_ludum_dare:function(){var p,x,v,m;for(v=this.props.tags,p=0,x=v.length;p<x;p++)if(m=v[p],m.match(/^ludum-dare/))return!0;return!1},render_ludum_dare_input:function(){if(this.has_ludum_dare())return i({className:"input_row ludum_dare_input_row"},d({},i({className:"label"},"Ludum Dare submission URL",g({className:"sub"}," \u2014 Please include submission URL to be eligible for tag")),c({type:"text",name:"game[ludum_dare_url]",defaultValue:this.props.ludum_dare_url,ref:"ludum_dare_input",placeholder:"eg. https://ldjam.com/events/ludum-dare/"+this.props.current_ludum_dare+"/your-game-name"})))},render_store_links:function(){var p,x,v,m;return v=function(){var N,S,C,D;for(C=this.state.open_stores,D=[],N=0,S=C.length;N<S;N++)x=C[N],D.push(this.store_by_name(x));return D}.call(this),p=function(){var N,S,C,D;for(D=[],N=0,S=w.length;N<S;N++)m=w[N],C=m.name,Qr.call(this.state.open_stores,C)<0&&D.push(m);return D}.call(this),i({},this.render_open_stores(v),i.apply(null,[{className:"add_buttons"}].concat(Gt.call(this.render_closed_stores(p)))),this.empty_values(p))},render_open_stores:function(p){return i({className:"store_url_inputs",children:p.map(function(x){return function(v){return i({className:"input_row",key:v.name},y({className:"sub"},v.label),i({className:"input_wrapper"},c({type:"text",ref:v.name,name:"game["+v.name+"]",placeholder:"eg. "+v.example,defaultValue:x.props[v.name]}),t({className:"clear_store_button",type:"button",onClick:function(m){var N;return m.preventDefault(),x.setState({open_stores:function(){var S,C,D,L;for(D=this.state.open_stores,L=[],S=0,C=D.length;S<C;S++)N=D[S],N!==v.name&&L.push(N);return L}.call(x)})}},"\xD7")))}}(this))})},empty_values:function(p){return p.map(function(x){return function(v){return c({key:v.name,type:"hidden",name:"game["+v.name+"]",value:""})}}(this))},render_closed_stores:function(p){return p.map(function(x){return function(v){return t({key:v.name,type:"button",className:"add_link_button",onClick:function(m){return x.setState({open_stores:x.state.open_stores.concat([v.name])}),_.defer(function(){var N;return(N=x.refs[v.name])!=null?N.focus():void 0}),m.preventDefault()}},g({className:"icon icon-plus"}),v.label)}}(this))}}),Vt=n("AccessControl",{pure:!0,propTypes:{game_id:f.number,noun:f.string,published:f.bool,active:f.bool,unlisted:f.bool,restricted:f.bool,password:f.string,purchases_count:f.number},getInitialState:function(){var p,x;return p=this.props.published?this.props.restricted?"restricted":"published":"draft",x=p!=="restricted"?this.props.unlisted:void 0,{published:p,custom_settings_open:!this.props.active||x,prevent_new:!this.props.active,unlisted:x,require_password:!!this.props.password,password:this.props.password}},render:function(){return i({className:"access_control input_row"},i({className:"label"},this.tt("dashboard.edit_project.visibility_access_header")),y({className:"sub"},this.tt("dashboard.edit_project.visibility_access_info",{a:function(p){return r({href:"/docs/creators/access-control",target:"blank"},p)}})),R.Forms.RadioButtons({name:"game[published]",value:this.state.published,onChange:function(p){return function(x){return p.setState({published:x.target.value})}}(this),options:[["draft",this.tt("misc.project_visibility.draft"),"Only those who can edit the project can view the page"],["restricted",this.tt("misc.project_visibility.restricted"),"Only owners & authorized people can view the page"],["published",this.tt("misc.project_visibility.public"),g({},"Anyone can view the page",this.props.game_id==null?g({},", ",u({},"you can enable this after you've saved")):void 0,!this.state.custom_settings_open&&this.state.published==="published"?g({}," ",r({href:"#",className:"configure_link",onClick:function(p){return function(x){return x.preventDefault(),p.setState({custom_settings_open:!p.state.custom_settings_open})}}(this)},"Configure settings...")):void 0),{disabled:this.props.game_id==null}]]}),this.render_draft_warning(),this.show_access_settings()?this.render_access_settings():void 0)},show_access_settings:function(){return this.state.published==="restricted"?!0:this.state.published==="published"?this.state.custom_settings_open:!1},render_draft_warning:function(){var p;if(this.state.published==="draft"&&this.props.purchases_count&&this.props.purchases_count>0)return p=this.props.purchases_count>1?"people":"person",y({className:"sub warning"},u({},"Warning: "),"The "+this.props.purchases_count+" "+p+" who bought the project will not be able to access it while it's draft.")},render_public_access_options:function(){return React.createElement(React.Fragment,{},i({className:"input_row",key:"prevent_new"},d({},c({type:"checkbox",name:"game[prevent_new]",checked:this.state.prevent_new,onChange:function(p){return function(x){return p.setState({prevent_new:x.target.checked})}}(this)}),this.tt("dashboard.edit_project.access_control.disable_downloads_option"),i({className:"help_hover","data-tooltip":"Only those who already own the game or get a download key can download. Does not affect embedded files"}))),i({className:"input_row",key:"unlisted"},d({},c({type:"checkbox",name:"game[unlisted]",checked:this.state.unlisted,onChange:function(p){return function(x){return p.setState({unlisted:x.target.checked})}}(this)}),this.tt("dashboard.edit_project.access_control.unlisted_option"))))},render_restricted_access_options:function(){return React.createElement(React.Fragment,{},y({className:"sub"},"Only people who own the project can view the page. You can give access by generating a download key. The page will be unlisted in browse and search."),i({className:"input_row"},d({},c({type:"checkbox",name:"game[require_password]",checked:this.state.require_password,onChange:function(p){return function(x){return p.setState({require_password:x.target.checked})}}(this)}),this.tt("dashboard.edit_project.access_control.allow_password_option"),i({className:"help_hover","data-tooltip":"Password not required for owners"})),this.state.require_password?c({type:this.state.password_focused?"text":"password",required:!0,className:"password_input",name:"game[password]",autoComplete:"new-password",placeholder:this.t("dashboard.edit_project.access_control.password_label"),value:this.state.password,onFocus:function(p){return function(){return p.setState({password_focused:!0})}}(this),onBlur:function(p){return function(){return p.setState({password_focused:!1})}}(this),onChange:function(p){return function(x){return p.setState({password:x.target.value})}}(this)}):void 0))},render_access_settings:function(){var p,x;return x=this.state.published==="published",p=function(){switch(this.state.published){case"published":return this.tt("dashboard.edit_project.access_control.public_access_settings");case"restricted":return this.tt("dashboard.edit_project.access_control.restricted_access_settings");default:return this.tt("dashboard.edit_project.access_control.access_settings")}}.call(this),i({className:"publish_toggles"},i({className:"toggle_header"},g({},p),x?t({type:"button",onClick:function(v){return function(m){return v.setState({custom_settings_open:!1})}}(this)},"\xD7"):void 0),function(){switch(this.state.published){case"published":return this.render_public_access_options();case"restricted":return this.render_restricted_access_options()}}.call(this))}}),Ot=n("GameTags",{pure:!0,propTypes:{genres:f.array.isRequired,classification:f.string,suggested_tags:f.array,on_change_tags:f.func},getInitialState:function(){return{tags:_.toArray(this.props.tags)}},has_tag:function(p){var x,v,m,N;for(m=this.state.tags,x=0,v=m.length;x<v;x++)if(N=m[x],p===N)return!0;return!1},add_tag:function(p){var x;return x=this.tags_input[0].selectize,x.createItem(p,!1)},componentDidMount:function(){var p,x,v,m;return v=_.toArray(this.props.suggested_tags),m=$(this.refs.tags_input),x=m.data("json_value")||[],p=_.toArray(this.props.tags),this.tags_input=m.selectize({delimiter:",",plugins:["remove_button"],persist:!1,placeholder:m.attr("placeholder"),valueField:"slug",labelField:"slug",searchField:["slug"],closeAfterSelect:!0,options:v.concat(p).map(function(N){return{slug:N}}),create:function(N){return{slug:I.slugify(N)}},onChange:function(N){return function(){var S,C;return C=N.tags_input[0].selectize.items||[],N.setState({tags:C}),typeof(S=N.props).on_change_tags=="function"?S.on_change_tags(C):void 0}}(this)})},hide_genre:function(){return this.props.classification!=="game"},render:function(){return this.enclose({},this.hide_genre()?c({type:"hidden",name:"game[genre]",value:"none"}):i({className:"input_row"},i({className:"label"},this.tt("dashboard.edit_project.details_genre_header")),y({className:"sub"},this.tt("dashboard.edit_project.details_genre_info")),R.Forms.Select({name:"game[genre]",defaultValue:this.state.genre||this.props.genre,selectize:!0,onChange:function(p){return function(x){return p.setState({genre:x.target.value})}}(this),options:[["none","No genre"]].concat(Gt.call(this.props.genres.map(function(p){return function(x){var v,m;return m=x.title,v=x.slug,[v,m]}}(this))))})),i({className:"input_row tags_input_row"},i({className:"label"},this.tt("dashboard.edit_project.details_tags_header"),g({className:"sub"},"\u2014 ",r({href:this.props.tag_guide_url,target:"blank"},"Tips for choosing tags"))),y({className:"sub"},"Any other keywords someone might search to find your game. Max of 10."),this.hide_genre()?y({className:"sub"},"Avoid duplicating any platforms provided on files above."):y({className:"sub"},"Avoid using the genre or platforms provided above."),this.state.tags.length>this.props.max_tags?y({className:"sub error"},"Too many tags! Please choose at most "+this.props.max_tags+" tags."):void 0,i({className:"selectize_group"},c({type:"text",name:"game[tags]",className:"tag_input",ref:"tags_input",defaultValue:_.toArray(this.props.tags).join(","),placeholder:"Click to view options, type to filter or enter custom tag"})),this.props.ludum_dare_tag&&!this.has_tag(this.props.ludum_dare_tag)?i({className:"ludum_dare_tagger"},y({},u({},"Ludum Dare "+this.props.current_ludum_dare+" submission?")," ",t({type:"button",className:"button small add_tag_btn",onClick:function(p){return function(x){return p.add_tag(p.props.ludum_dare_tag)}}(this)},"Add Ludum Dare tag"))):void 0))}}),zt=n("EmbedOptions",{pure:!0,getInitialState:function(){return Object.assign({embed_type:"frame",size_type:"manual",width:"",height:"",mobile_friendly:!1,fullscreen:!1,scrollbars:!1,autostart:!1},this.props)},render:function(){return this.enclose({},o({},this.tt("dashboard.edit_project.embed_options_header")),this.render_embed_mode(),this.render_dimensions(),this.render_frame_options())},render_dimensions:function(){if(!(this.props.type==="html"&&(this.state.embed_type!=="frame"||this.state.size_type!=="manual")))return i({className:"input_row"},i({className:"label"},this.tt("dashboard.edit_project.embed_options.viewport_dimensions")),i({className:"dimensions_inputs"},d({},g({className:"dimension_label"},this.tt("dashboard.edit_project.embed_options.width")),c({className:classNames("inline_input",{has_error:this.state.width===""}),name:"embed[width]",type:"text",value:this.state.width,required:!0,onChange:function(p){return function(x){if(x.target.value.match(/^\d*$/))return p.setState({width:x.target.value})}}(this)}),g({className:"size_unit"},"px")),g({className:"mult"},"\xD7"),d({},g({className:"dimension_label"},this.tt("dashboard.edit_project.embed_options.height")),c({className:classNames("inline_input",{has_error:this.state.height===""}),name:"embed[height]",type:"text",required:!0,value:this.state.height,onChange:function(p){return function(x){if(x.target.value.match(/^\d*$/))return p.setState({height:x.target.value})}}(this)}),g({className:"size_unit"},"px"))))},checkbox:function(p){return c({type:"checkbox",name:"embed["+p+"]",checked:this.state[p],onChange:function(x){return function(v){var m;return m={},m[p]=v.target.checked,x.setState(m)}}(this)})},render_frame_options:function(){if(this.props.type==="html")return i({className:"input_row"},i({className:"label"},this.tt("dashboard.edit_project.embed_options.frame_options")),k({className:"check_list frame_options"},b({},d({},this.checkbox("mobile_friendly"),this.tt("dashboard.edit_project.embed_options.mobile_friendly_option"),g({className:"sub"}," \u2014 ",this.tt("dashboard.edit_project.embed_options.mobile_friendly_info"))),this.state.mobile_friendly?i({className:"orientation_options"},d({},u({},this.tt("dashboard.edit_project.embed_options.orientation")),R.Forms.SimpleSelect({name:"embed[orientation]",value:this.state.orientation||"",onChange:function(p){return function(x){return p.setState({orientation:x===""?null:x})}}(this),options:[{name:"Default",value:""},{name:"Landscape",value:"landscape"},{name:"Portrait",value:"portrait"}]}))):void 0),this.state.embed_type!=="maximized"?b({},d({},this.checkbox("autostart"),"Automatically start on page load",g({className:"sub"}," \u2014 Not recommended for Unity games, since they can lag the browser when loading"))):void 0,this.state.embed_type!=="maximized"?b({},d({},this.checkbox("fullscreen"),this.tt("dashboard.edit_project.embed_options.fullscreen_button_option"),g({className:"sub"}," \u2014 Add a button to the bottom right corner of your embed to make it fullscreen"))):void 0,b({},d({},this.checkbox("scrollbars"),this.tt("dashboard.edit_project.embed_options.enable_scrollbars_option"),g({className:"sub"}," \u2014 Enable scrollbars in the iframe that contains your project"))),b({},d({},this.checkbox("cdn_type"),s({},"SharedArrayBuffer")," support",g({className:"sub"}," \u2014 ",u({},"(Experimental)")," This may break parts of the page or your project. Only enable if you know you need it. ",r({href:"https://itch.io/t/2025776/experimental-sharedarraybuffer-support"},"Learn more"))))))},render_embed_mode:function(){return this.props.type!=="html"?React.createElement(React.Fragment,{},c({type:"hidden",name:"embed[embed_type]",value:"frame"}),c({type:"hidden",name:"embed[size_type]",value:"manual"})):i({className:"input_row"},y({className:"sub"},"How should your project be run in your page?"),i({className:"dimensions_row"},R.Forms.SimpleSelect({name:"embed[embed_type]",value:this.state.embed_type,onChange:function(p){return function(x){return p.setState({embed_type:x})}}(this),options:[{name:this.t("dashboard.edit_project.embed_options.embed_in_page_option"),value:"frame"},{name:this.t("dashboard.edit_project.embed_options.launch_fullscreen_option"),value:"maximized"}]})," ",this.state.embed_type==="frame"?R.Forms.SimpleSelect({name:"embed[size_type]",value:this.state.size_type,onChange:function(p){return function(x){return p.setState({size_type:x})}}(this),options:[{name:"Manually set size",value:"manual"},{name:"Auto-detect size (Unity HTML only)",value:"auto"}]}):void 0))}}),Ht=n("UploadUrlLightbox",{getInitialState:function(){return{invalid_url:!0}},is_valid_url:function(p){return p.match(/https?:\/\/[^\/]+\/.+/)},render:function(){return re({className:classNames(this.enclosing_class_name(),"compact")},o({},"Upload file from URL"),a({className:"form",onSubmit:function(p){return function(x){var v;if(x.preventDefault(),!p.state.invalid_url)return typeof(v=p.props).on_url=="function"&&v.on_url(p.url_input_ref.current.value,p.filename_input_ref.current.value),I.Lightbox.close()}}(this)},i({className:"input_row"},d({},i({className:"label"},"Enter URL"),c({ref:this.url_input_ref||(this.url_input_ref=React.createRef()),required:!0,type:"text",placeholder:"http://....",onChange:function(p){return function(x){var v,m,N,S;if(S=x.target.value,m=p.is_valid_url(S),p.state.invalid_url!==!m&&p.setState({invalid_url:!m}),!p.state.dirty&&(v=(N=S.match(/([^\/]+$)/))!=null?N[1]:void 0))return p.filename_input_ref.current.value=v}}(this)}))),i({className:"input_row"},d({},i({className:"label"},"Filename"),c({required:!0,ref:this.filename_input_ref||(this.filename_input_ref=React.createRef()),type:"text",placeholder:this.t("misc.forms.required"),onChange:function(p){return function(x){if(!p.state.dirty)return p.setState({dirty:!0})}}(this)}))),i({className:"buttons"},t({className:classNames("button",{disabled:!!this.state.invalid_url}),disabled:!!this.state.invalid_url},"Start upload"))))}})});var Ae=null;E.libs.react.done(function(){var n,e,r;return e=F,r=e.button,n=M.package("Forms"),Ae=n("FocusButton",{pure:!0,getInitialState:function(){return{focused:!1}},componentWillUnmount:function(){var t;if(this.state.focused)return typeof(t=this.props).on_decrement_focus=="function"?t.on_decrement_focus():void 0},on_focus:function(){var t;return this.setState({focused:!0}),typeof(t=this.props).on_increment_focus=="function"?t.on_increment_focus():void 0},on_blur:function(){var t;return this.setState({focused:!1}),typeof(t=this.props).on_decrement_focus=="function"?t.on_decrement_focus():void 0},render:function(){var t;return t=$.extend({onFocus:this.on_focus,onBlur:this.on_blur},this.props),delete t.on_increment_focus,delete t.on_decrement_focus,r(t)}})});var Jt=null;I.libs.react.done(function(){var n,e,r,t,s,i,a,o,l;return r=F,t=r.button,a=r.img,s=r.div,l=r.p,o=r.input,i=r.fragment,i=React.createElement.bind(null,React.Fragment),i.type=React.fragment,e=M.package("GameEdit"),I.i18n.preload(["misc.errors","dashboard.edit_project.cover_uploader","dashboard.edit_project.errors"]),n=createReactClass({displayName:"LoadingImage",componentDidMount:function(){var c;return typeof(c=this.props).on_mount=="function"?c.on_mount():void 0},componentWillUnmount:function(){var c;return typeof(c=this.props).on_unmount=="function"?c.on_unmount():void 0},render:function(){var c;return c=$.extend({},this.props),delete c.on_mount,delete c.on_unmount,a(c)}}),Jt=e("CoverUploader",{pure:!0,propTypes:{upload_image_url:j.string.isRequired,cover_image:j.object},getInitialState:function(){return{focus_count:0,cover_image:this.props.cover_image,image_loading:!!this.props.cover_image}},start_upload:function(c){return c.preventDefault(),I.upload_image({url:this.props.upload_image_url,thumb_size:"cover_big",max_size:this.props.max_size,test_file:function(d){return function(b,h){return $.when(I.test_image_dimensions(b),I.test_image_format(b)).done(function(){return h.resolve()}).fail(function(y){return h.reject(y)})}}(this),on_pick_files:function(d){return function(){return d.setState({picking:!0})}}(this),on_start_upload:function(d){return function(){return d.setState({upload_progress:0,uploading:!0,picking:!1})}}(this)}).done(function(d){return function(b){return d.setState({uploading:!1,upload_progress:1,cover_image:b.upload})}}(this)).progress(function(d){return function(b,h,y){return d.setState({upload_progress:h/y})}}(this)).fail(function(d){return function(b){return Array.isArray(b)||(b=[d.t("misc.errors.server_error")]),d.setState({picking:!1,uploading:!1}),Y($e({errors:b.map(function(h){var y,g;return Array.isArray(h)?(g=h[0],y=h[1],y!=null&&y.name?y.name+": "+g:g):h}),title:d.t("dashboard.edit_project.errors.invalid_file"),sub_text:d.t("dashboard.edit_project.errors.invalid_image")}))}}(this))},remove_image:function(c){if(c.preventDefault(),confirm(this.t("dashboard.edit_project.cover_uploader.confirm_remove")))return this.setState({cover_image:null})},increment_focus:function(){return this.setState(function(c){return{focus_count:c.focus_count+1}})},decrement_focus:function(){return this.setState(function(c){return{focus_count:c.focus_count-1}})},on_image_load:function(){return this.setState({image_loading:!1})},on_mount_image:function(){return this.setState({image_loading:!0})},render:function(){var c;return c=this.state.uploading||this.state.image_loading||this.state.picking,this.enclose({className:classNames({has_image:!c&&!!this.state.cover_image,image_loading:this.state.image_loading,uploading:c})},s({className:classNames("upload_container",{focused:this.state.focus_count>0})},this.state.cover_image&&!(this.state.uploading||this.state.picking)?React.createElement(n,{key:"image:"+this.state.cover_image.id,className:"cover_thumb",src:this.state.cover_image.thumb_url,onLoad:this.on_image_load,on_mount:this.on_mount_image,on_unmount:this.on_image_load}):void 0,c?s({className:"upload_progress",key:"upload_progress",style:{width:100*(this.state.upload_progress||0)+"%"}}):this.render_file_tools()),l({className:"sub instructions"},this.props.sub||this.tt("dashboard.edit_project.cover_uploader.cover_description")))},render_file_tools:function(){return s({className:"file_tools",key:"file_tools"},this.props.name?o({type:"hidden",name:this.props.name,value:this.state.cover_image?this.state.cover_image.id:""}):void 0,this.state.cover_image?i({},Ae({on_increment_focus:this.increment_focus,on_decrement_focus:this.decrement_focus,className:"button",type:"button",onClick:this.start_upload,key:"replace_button"},this.tt("dashboard.edit_project.cover_uploader.replace_image")),Ae({on_increment_focus:this.increment_focus,on_decrement_focus:this.decrement_focus,type:"button",className:"textlike remove_image_btn",onClick:this.remove_image},this.tt("dashboard.edit_project.cover_uploader.remove_image"))):Ae({on_increment_focus:this.increment_focus,on_decrement_focus:this.decrement_focus,className:"button",type:"button",onClick:this.start_upload,key:"upload_button"},this.tt("dashboard.edit_project.cover_uploader.upload_button")))}})});var Zr=[].slice,ge=null,Re=null,Wt=null;E.libs.react.done(function(){var n,e,r,t,s,i,a;return n=F,e=n.a,a=n.span,i=n.label,r=n.button,t=n.div,s=0,ge=M.component("RowMover",{pure:!0,render:function(){return this.enclose({},a({className:"mover_label"},this.props.label||"Move"),r({type:"button",className:"move_up_btn",disabled:this.props.first,onClick:this.props.move_up,title:"Move up"},tt({})),r({type:"button",className:"move_down_btn",disabled:this.props.last,onClick:this.props.move_down,title:"Move down"},rt({})))}}),Re=M.component("ListManager",{propTypes:{initial_items:j.array,on_list_update:j.func,empty_content:j.node,item_component:j.node},getInitialState:function(){var o;return{rows:function(){var l,c,d,b;for(d=z.toArray(this.props.initial_items),b=[],l=0,c=d.length;l<c;l++)o=d[l],b.push({item:o});return b}.call(this)}},componentDidUpdate:function(o,l){var c,d;return l.rows!==this.state.rows&&typeof(c=this.props).on_list_update=="function"&&c.on_list_update(function(){var b,h,y,g;for(y=this.state.rows,g=[],b=0,h=y.length;b<h;b++)d=y[b],g.push(d.item);return g}.call(this)),this.state},replace_items:function(o){return this.setState({rows:o.map(function(l){return function(c){return{item:c}}}(this))})},add:function(o,l){return this.setState(function(c){return function(d){return{rows:d.rows.concat([{item:o}])}}}(this),l?function(c){return function(){var d,b,h,y,g;for(h=c.state.rows,d=0,b=h.length;d<b;d++)if(g=h[d],g.item===o){typeof l=="function"&&l((y=g.ref)!=null?y.current:void 0);return}}}(this):void 0)},remove_item:function(o){return this.setState(function(l){return function(c){var d;return{rows:function(){var b,h,y,g;for(y=c.rows,g=[],b=0,h=y.length;b<h;b++)d=y[b],d.item!==o&&g.push(d);return g}()}}}(this))},find_row:function(o){var l,c,d,b;for(d=this.state.rows,l=0,c=d.length;l<c;l++)if(b=d[l],b.item===o)return b},update_all:function(o){return this.setState(function(l){return function(c){return{rows:c.rows.map(o)}}}(this))},update_item:function(o,l){return this.update_all(function(c){return function(d){var b;return d.item===o?(b=Object.assign({},d,{item:Object.assign({},d.item,l)}),b):d}}(this))},update_row:function(o,l,c){var d,b;return d=Object.assign({},o,l),b=function(h){return function(y){var g,w;if(g=!1,w=y.rows.map(function(u){return u===o?(g=!0,d):u}),g||console.warn("tried to update row that doesn't exist"),g)return{rows:w}}}(this),this.setState(b,c),d},move_item:function(o,l){var c,d,b,h,y,g;return g=this.find_row(o),c=this.props.animate?(h=X.findDOMNode(g.ref.current),y=h.getBoundingClientRect(),b=y.top,d=y.left,function(w){return function(){var u,f,k,p,x,v,m;return x=h.getBoundingClientRect(),f=x.top,u=x.left,p=f-b,k=u-d,v=250,m=[{position:"relative",transform:"translate("+-k+"px, "+-p+"px)",zIndex:"1"},{position:"relative",transition:"transform "+v/1e3+"s ease",transform:"translate(0, 0)",zIndex:"1"},{}],g=w.update_row(g,{style:m[0]},function(){return z.defer(function(){return g=w.update_row(g,{style:m[1]},function(){return setTimeout(function(){return w.update_row(g,{style:m[2]})},v)})})})}}(this)):void 0,this.setState(function(w){return{rows:E.move(w.rows,g,l)}},c)},render:function(){var o;return this.props.empty_content&&!this.state.rows.length?this.props.empty_content:(o=this,this.state.rows.map(function(l){return function(c,d){var b;return b={key:c.key||(c.key=c.item.id||"item-"+s++),ref:c.ref||(c.ref=P.createRef()),position:d,first:d===0,last:d===l.state.rows.length-1,style:c.style,update:l.props_update||(l.props_update=function(){var h;return h=o.state.rows[this.position],o.update_item.apply(o,[h.item].concat(Zr.call(arguments)))}),update_all:l.props_update_all||(l.props_update_all=function(h){return o.update_all(function(y){return function(g){var w;return(w=h(g.item))?Object.assign({},g,{item:Object.assign({},g.item,w)}):g}}(this))}),remove:l.props_remove||(l.props_remove=function(){var h;return h=o.state.rows[this.position],o.remove_item(h.item)}),move_up:l.props_move_up||(l.props_move_up=function(){var h;return h=o.state.rows[this.position],o.move_item(h.item,-1)}),move_down:l.props_move_down||(l.props_move_down=function(){var h;return h=o.state.rows[this.position],o.move_item(h.item,1)})},b[l.props.item_name||"item"]=c.item,l.props.item_props&&Object.assign(b,l.props.item_props(c.item,d)),l.props.item_component(b)}}(this)))}}),Wt=M.component("RowAnimator",{pure:!0,propTypes:{idx:j.number.isRequired,set_style:j.func,active_styles:j.object},getDefaultProps:function(){return{animation_duration:250}},getInitialState:function(){return{}},get_position:function(){var o,l,c,d;return o=this.props.el||this.el_ref.current,c=o.getBoundingClientRect(),d=c.top,l=c.left,{top:d,left:l}},getSnapshotBeforeUpdate:function(o){return o.idx!==this.props.idx?this.get_position():null},componentDidUpdate:function(o,l,c){if(o.idx!==this.props.idx)return this.animate_position(c,this.get_position())},componentWillUnmount:function(){if(this.active_timer!=null)return clearTimeout(this.active_timer)},set_style:function(o){return o&&this.props.active_styles&&(o=Object.assign(o,this.props.active_styles)),this.props.set_style?this.props.set_style(o):this.setState({style:o})},animate_position:function(o,l){var c,d;if(o&&l)return d=l.top-o.top,c=l.left-o.left,this.set_style({position:"relative",transform:"translate("+-c+"px, "+-d+"px)",zIndex:"1"}),this.active_timer=setTimeout(function(b){return function(){return b.set_style({position:"relative",transition:"transform "+b.props.animation_duration/1e3+"s ease",transform:"translate(0, 0)",zIndex:"1"}),b.active_timer=setTimeout(function(){return delete b.active_timer,b.set_style({})},b.props.animation_duration)}}(this),0)},componentDidUpdate:function(o,l,c){if(o.idx!==this.props.idx)return this.animate_position(c,this.get_position())},render:function(){return this.props.el&&this.props.set_style?this.props.children:t({"data-animating":this.active_timer!=null?!0:null,className:this.props.className,style:this.state.style,ref:this.el_ref||(this.el_ref=P.createRef())},this.props.children)}})}),I.libs.react.done(function(){var n,e,r,t,s,i,a,o,l,c,d,b;return e=F,a=e.input,t=e.div,l=e.label,b=e.span,r=e.button,i=e.form,d=e.option,s=e.em,n=M.package("GameEdit"),o=0,c=function(){return""+o++},n("GameLinkRow",{pure:!0,input_name:function(h){return"links["+(this.props.position+1)+"]["+h+"]"},render:function(){var h;return h=this.props.link,this.enclose({className:"link_row",style:this.props.style},a({type:"hidden",name:this.input_name("id"),value:h.id}),a({type:"hidden",name:this.input_name("type"),value:h.type}),t({className:"label_column"},h.type==="other"?a({type:"text",name:this.input_name("name"),value:h.name||"",placeholder:"Name",required:!0,onChange:function(y){return function(g){return y.props.update({name:g.target.value})}}(this)}):b({className:"link_type_name"},this.props.link_names[h.type])),a({type:"text",name:this.input_name("url"),value:h.url,autoFocus:h.just_added?!0:void 0,placeholder:"http://",required:!0,onChange:function(y){return function(g){return y.props.update({url:g.target.value})}}(this)}),this.props.first&&this.props.last?void 0:ge({move_up:this.move_up||(this.move_up=function(y){return function(){return y.props.move_up()}}(this)),move_down:this.move_down||(this.move_down=function(y){return function(){return y.props.move_down()}}(this)),first:this.props.first,last:this.props.last}),r({type:"button",className:"remove_btn",title:"Remove",onClick:function(y){return function(g){if(g.preventDefault(),!((h.name||h.url)&&!confirm("Are you sre you want to remove this link?")))return y.props.remove()}}(this)},_e({width:18})))}}),n("EditLinks",{propTypes:{game_link_types:j.array.isRequired,link_names:j.object.isRequired,links:j.arrayOf(j.shape({id:j.number,name:j.string,url:j.string.isRequired,type:j.string.isRequired}))},getInitialState:function(){var h;return{links:function(){var y,g,w,u;for(w=this.props.links||[],u=[],y=0,g=w.length;y<g;y++)h=w[y],u.push(h);return u}.call(this)}},add_link:function(h){return this.list_ref.current.add({just_added:!0,type:h,name:"",url:""})},render:function(){return this.enclose({component:"form",method:"post",ref:this.form_ref||(this.form_ref=React.createRef()),className:"game_links_editor form",onSubmit:this.on_sumit||(this.on_sumit=function(h){return function(y){if(y.preventDefault(),!h.state.loading)return h.setState({loading:!0,errors:null}),I.remote_submit($(h.form_ref.current)).done(function(g){if(h.setState({loading:!1}),g.redirect_to&&(window.location=g.redirect_to),g.errors)return h.setState({errors:g.errors})})}}(this))},a({type:"hidden",name:"json",value:"1"}),a({type:"hidden",name:"csrf_token",value:I.get_csrf()}),this.state.errors?M.Forms.FormErrors({errors:this.state.errors,animated:!0,scroll_into_view:!0}):void 0,this.render_links(),t({className:"add_buttons"},l({},b({className:"type_label label"},"Add new link to")," ",M.Forms.SimpleSelect({ref:this.type_picker_ref||(this.type_picker_ref=React.createRef()),options:this.props.game_link_types.map(function(h){return function(y){return{value:y,name:h.props.link_names[y]}}}(this))}))," ",r({className:"button",type:"button",onClick:function(h){return function(y){return y.preventDefault(),h.add_link(h.type_picker_ref.current.current_option().value)}}(this)},"Enter URL...")),t({className:"buttons"},r({className:"button"},"Save links")))},render_links:function(){return t({className:"link_list"},Re({animate:!0,item_name:"link",ref:this.list_ref||(this.list_ref=React.createRef()),item_component:n.GameLinkRow,initial_items:this.state.links,on_list_update:this.on_list_update||(this.on_list_update=function(h){return function(y){return h.setState({links:y})}}(this)),empty_content:s({className:"empty_message"},"No links added yet"),item_props:function(h){return function(y){return{link_names:h.props.link_names}}}(this)}))}})});var Kt=null;I.libs.react.done(function(){var n,e,r,t,s,i,a,o,l,c,d,b,h;return t=F,l=t.label,o=t.input,c=t.p,b=t.strong,s=t.a,a=t.div,i=t.button,d=t.span,r=R.package("GameEdit"),h=PropTypes,e=100,n=200,Kt=r("PricePicker",{pure:!0,propTypes:{currency:h.string.isRequired,min_price:h.number,suggested_price:h.number,disable_payments:h.bool,reward_required:h.bool,is_embed:h.bool,default_donation_amount:h.number},getInitialState:function(){return{payment_mode:this.props.disable_payments?"disable_payments":this.props.min_price>0?"paid":"free",show_suggested_price:this.props.suggested_price&&this.props.suggested_price>this.props.min_price||!1,min_price:this.props.min_price,suggested_price:this.props.suggested_price}},render:function(){var y,g,w;return g=[{label:this.tt("dashboard.edit_project.pricing.free_or_donate",{money:I.format_money(0,this.props.currency).replace(/\.00$/,"")}),name:"free"},{label:this.tt("dashboard.edit_project.pricing.paid"),name:"paid"},{label:this.tt("dashboard.edit_project.pricing.no_payments"),name:"disable_payments"}],this.enclose({},o({type:"hidden",name:"game[payment_mode]",value:this.state.payment_mode}),this.props.reward_required?c({className:"reward_notice"},b({},"A reward is required to download. "),"You projects's minimum price is fixed to the lowest available reward. ",s({className:"forward_link",target:"_blank",href:this.props.rewards_url},"Configure rewards")):void 0,a({className:"payment_modes",children:g.map(function(u){return function(f){var k;return k=f.name===u.state.payment_mode,i({type:"button",role:"checkbox","aria-checked":k,key:f.name,className:classNames("payment_mode_"+f.name,{active:k}),onClick:function(){var p;return u.setState({payment_mode:f.name}),p=f.name==="paid"?u.state.min_price||e:0,u.trigger("game:set_state",{disable_payments:f.name==="disable_payments",min_price:p})}},d({className:classNames("icon",{"icon-checkbox-checked":k,"icon-checkbox-unchecked":!k})}),d({className:"label"},f.label))}}(this))}),function(){switch(this.state.payment_mode){case"paid":return y=this.state.min_price||e,w=y<e,a({className:"price_inputs"},this.props.is_embed?c({className:"price_note"},this.tt("dashboard.edit_project.pricing.embed_pricing_info")):void 0,R.Forms.TextInputRow({title:this.tt("dashboard.edit_project.pricing.minimum_price_label"),sub:this.tt("dashboard.edit_project.pricing.minimum_price_info"),name:"game[min_price]",defaultValue:I.format_money(y,this.props.currency),money_input:!0,currency:this.props.currency,placeholder:I.format_money(0,this.props.currency),has_error:w,error_message:w?"Please enter a price of at least "+I.format_money(e,this.props.currency):void 0,onKeyUp:function(u){return function(f){var k;return k=I.parse_money(f.target.value),u.setState({min_price:k}),u.trigger("game:set_state",{min_price:k})}}(this)}),this.render_suggested_price());case"free":return a({className:"mode_free"},o({type:"hidden",name:"game[min_price]",value:I.format_money(0,this.props.currency)}),c({className:"sub"},this.tt("dashboard.edit_project.pricing.free_price_info")),a({className:"price_inputs"},this.render_suggested_price({sub:this.tt("dashboard.edit_project.pricing.default_donation_amount_info")})));case"disable_payments":return a({className:"mode_disable_payments"},o({type:"hidden",name:"game[min_price]",value:I.format_money(0,this.props.currency)}),this.props.reward_required?c({className:"warning"},"Your project will be unable to be downloaded or purchased if payments are disabled and a reward is required. Please change one of the options. (Existing owners will still maintain access)"):c({className:"sub"},this.tt("dashboard.edit_project.pricing.payment_disabled_info")))}}.call(this))},suggested_price_enabled:function(){return this.state.show_suggested_price||this.state.payment_mode==="free"},render_suggested_price:function(y){var g,w;return y==null&&(y={}),a({className:"suggested_price"},this.state.payment_mode==="paid"?a({className:"input_row suggest_alt_input_row"},l({},o({type:"checkbox",className:"suggested_price_toggle",checked:this.state.show_suggested_price,onChange:function(u){return function(f){var k;return k={show_suggested_price:f.target.checked},u.state.payment_mode==="paid"&&k.show_suggested_price&&(k.suggested_price=Math.max(u.props.default_donation_amount||n,u.state.min_price||0)),u.setState(k)}}(this)}),this.tt("dashboard.edit_project.pricing.suggest_default_price_label"))):void 0,this.suggested_price_enabled()?(w=this.state.payment_mode==="paid"?(this.state.min_price||0)>(this.state.suggested_price||0):void 0,g=this.state.suggested_price||this.props.default_donation_amount||n,R.Forms.TextInputRow({title:this.state.payment_mode==="free"?this.tt("dashboard.edit_project.pricing.suggested_donation_label"):this.tt("dashboard.edit_project.pricing.suggested_price_label"),sub:y.sub||this.tt("dashboard.edit_project.pricing.default_price_info"),defaultValue:I.format_money(g,this.props.currency),name:"game[suggested_price]",money_input:!0,currency:this.props.currency,has_error:w,error_message:w?this.tt("dashboard.edit_project.pricing.price_too_low_error"):void 0,onKeyUp:function(u){return function(f){var k;return k=I.parse_money(f.target.value),u.setState({suggested_price:k})}}(this),placeholder:I.format_money(0,this.props.currency)})):void 0)}})});var Yt=[].slice,Xt=null;I.libs.react.done(function(){var n,e,r,t,s,i,a,o,l,c,d,b,h,y,g,w,u,f,k,p,x;return e=F,t=e.button,h=e.label,o=e.fragment,f=e.span,l=e.h2,i=e.div,a=e.form,c=e.h3,w=e.p,r=e.a,x=e.ul,y=e.li,d=e.input,k=e.strong,g=e.option,s=e.code,u=e.select,o=React.createElement.bind(null,React.Fragment),o.type=React.fragment,n=M.package("GameEdit"),p=PropTypes,b=0,n("UploadButton",{pure:!0,componentDidMount:function(){return I.make_upload_button($(this.upload_button_ref.current),function(v){return function(m){var N;return typeof(N=v.props).file_callback=="function"?N.file_callback(m):void 0}}(this))},render:function(){return t({type:"button","data-max_size":this.props.max_size,className:G("button",this.props.className),ref:this.upload_button_ref||(this.upload_button_ref=React.createRef())},this.props.label||"Upload")}}),n("DropboxUploadButton",{pure:!0,componentDidMount:function(){return I.wait_for_object(window,"Dropbox",function(v){return function(){var m;return m=Dropbox.createChooseButton({linkType:"direct",multiselect:!0,success:function(N){var S;return typeof(S=v.props).files_callback=="function"?S.files_callback(N):void 0}}),v.dropbox_drop_ref.current.appendChild(m)}}(this))},render:function(){return o({},f({className:"dropbox_drop",ref:this.dropbox_drop_ref||(this.dropbox_drop_ref=React.createRef())}))}}),n("UploadToolsLightbox",{submit_handler:function(v){var m;if(v.preventDefault(),!((m=this.state)!=null&&m.loading))return this.setState({loading:!0,errors:null}),$.post(this.props.upload.edit_url,I.with_csrf({action:"download"})).done(function(N){return function(S){if(N.setState({loading:!1}),S.errors)return N.setState({errors:S.errors});if(S.url)return window.location=S.url}}(this))},render:function(){var v,m,N,S,C;return re({className:G(this.enclosing_class_name(),"compact")},l({},this.props.upload.display_name||this.props.upload.filename||"Upload"),i({className:"download_form"},c({},"Download"),w({},"Need to make a backup? You can download the file exactly as it was uploaded."),(v=this.state)!=null&&v.errors?x({className:"form_errors"},this.state.errors.map(function(D){return y({key:D},D)})):void 0,a({className:"form",onSubmit:this.submit_handler},M.CSRF({}),t({name:"action",disabled:(m=(N=this.state)!=null?N.loading:void 0)!=null?m:!1,value:"download",className:G("button",{disabled:(S=(C=this.state)!=null?C.loading:void 0)!=null?S:!1})},"Download"))))}}),Xt=n("UploadList",{pure:!0,propTypes:{form_el:p.object,initial_uploads:p.array,game_min_price:p.number,disable_payments:p.bool,uploads_locked:p.bool,currency:p.string.isRequired,money_placeholder:p.string.isRequired},assign_default_embed:function(){var v;if(v=this.state.uploads.find(function(m){return function(N){return st(N,m.props.type)&&N.embed}}(this)),!v)return this.setState(function(m){var N;return N=!1,{uploads:m.uploads.map(function(S){return function(C){return st(C,S.props.type)&&!N?Object.assign(C,{embed:!0}):C.embed?Object.assign(C,{embed:!1}):C}}(this))}})},getInitialState:function(){return{uploads:this.props.initial_uploads||[]}},find_upload_by_file_upload:function(v){return this.state.uploads.find(function(m){return function(N){return N.file_upload===v}}(this))},remove_upload:function(v){return this.setState(function(m){return function(N){return{uploads:N.uploads.filter(function(S){return S!==v})}}}(this))},append_upload:function(v){var m,N;return m=v.deferred,N=function(S){return function(){return S.update_upload(S.find_upload_by_file_upload(v),v.to_props())}}(this),m.done(function(S){return function(){return N()}}(this)),m.fail(function(S){return function(){return N()}}(this)),m.progress(function(S){return function(C,D){var L;switch(C){case"upload_data":D.replaced_upload_id&&(L=S.state.uploads.find(function(O){return O.id===D.replaced_upload_id}),S.remove_upload(L))}return N()}}(this)),$.when(v.opts.upload_prefix).fail(function(S){return function(){return S.remove_upload(S.find_upload_by_file_upload(v))}}(this)),v.start_upload().done(function(S){return function(C){if(C.upload)return S.update_upload(S.find_upload_by_file_upload(v),Object.assign({},C.upload,{just_uploaded:!0,hidden:!1}))}}(this)),this.setState(function(S){return{uploads:S.uploads.concat([v.to_props()])}})},dirty_check:function(){if(this.state.uploads.find(function(v){return function(m){return m.state==="uploading"}}(this)))return"Uploads in progress"},synchronize_form_classes:function(){var v,m,N,S,C;for(v=!1,S=this.state.uploads,m=0,N=S.length;m<N;m++)if(C=S[m],!C.embed&&!C.hidden){v=!0;break}return this.props.form_el.classList.toggle("has_download",v)},componentDidUpdate:function(v,m){if(m.uploads!==this.state.uploads)return this.synchronize_form_classes()},componentDidMount:function(){return $(window).on("beforeunload",this.dirty_check),this.synchronize_form_classes(),this.disconnect_events=this.dispatch("upload",{move_up:function(v){return function(m,N){return v.setState(function(S){var C,D;return D=Yt.call(S.uploads),C=D[N-1],D[N-1]=D[N],D[N]=C,{uploads:D}})}}(this),move_down:function(v){return function(m,N){return v.setState(function(S){var C,D;return D=Yt.call(S.uploads),C=D[N+1],D[N+1]=D[N],D[N]=C,{uploads:D}})}}(this),remove:function(v){return function(m,N){return v.remove_upload(N)}}(this),update_upload:function(v){return function(m,N,S,C){var D;return D={},D[S]=C,v.update_upload(N,D)}}(this),open_channel:function(v){return function(m,N){var S;return S={channel_name:N.channel_name,game:{id:v.props.game_id}},I.Lightbox.open_remote(N.channel_lightbox_url,I.DashboardGameChannelLightbox,S)}}(this)})},componentWillUnmount:function(){return typeof this.disconnect_events=="function"&&this.disconnect_events(),$(window).off("beforeunload",this.dirty_check)},get_upload_prefix:function(){var v;return v=$.Deferred(),this.trigger("game:resolve_upload_prefix",v),v},create_file_upload:function(v){var m;return m=new at(v,{upload_prefix:this.get_upload_prefix()}),this.append_upload(m),m},create_dropbox_uploads:function(v){var m,N,S,C,D,L;for(L=this.get_upload_prefix(),C=[],N=0,S=v.length;N<S;N++)m=v[N],D=new qt(m,{upload_prefix:L}),C.push(this.append_upload(D));return C},create_external_upload:function(){var v;return v=new Yr(null,{upload_prefix:this.get_upload_prefix()}),this.append_upload(v),v},upload_from_url:function(){return Y(Ht({on_url:function(v){return function(m,N){var S;return S=new qt({link:m,name:N},{upload_prefix:v.get_upload_prefix()}),v.append_upload(S)}}(this)}))},update_upload:function(v,m){return this.setState(function(N){var S;return S=this.state.uploads.map(function(C){return function(D){return v===D?Object.assign({},D,m):m.embed&&D.embed?Object.assign({},D,{embed:!1}):D}}(this)),{uploads:S}})},render:function(){var v,m,N;return m=!1,N=this.state.uploads.map(function(S){return function(C,D){return C._react_id||(C._react_id="key-"+b++),C.state==="uploading"&&(m=!0),n.Uploader(Object.assign({upload:C,key:C._react_id,idx:D,total_uploads:S.state.uploads.length,can_embed:st(C,S.props.type),currency:S.props.currency,game_min_price:S.props.game_min_price,money_placeholder:S.props.money_placeholder,disable_payments:S.props.disable_payments,game_id:S.props.game_id}))}}(this)),v=this.props.uploads_locked?void 0:i({className:"add_file_btn_outer upload_buttons"},n.UploadButton({max_size:this.props.upload_limit,label:this.tt("dashboard.edit_project.upload_files_button"),file_callback:this.create_file_upload}),this.props.enable_dropbox?o({},f({className:"button_divider"},"or"),n.DropboxUploadButton({files_callback:this.create_dropbox_uploads})):void 0,this.props.enable_slurp?o({}," ",t({type:"button",className:"button small outline upload_from_url_btn",onClick:this.upload_from_url},"From URL")):void 0,i({className:"external_file_buttons"},t({className:"textlike external_file_btn",type:"button",onClick:this.create_external_upload},this.tt("dashboard.edit_project.add_external_file_button")),i({className:"help_hover",tabIndex:0,"data-tooltip":this.t("dashboard.edit_project.external_file_tooltip")}))),this.enclose({},i({className:G("file_list",{has_files:N.length>0,upload_in_progress:m})},N),m?i({className:"uploading_message"},i({className:"loader"}),"Do not close this page while uploads are in progress"):void 0,v)}}),n("Uploader",{pure:!0,propTypes:{currency:p.string.isRequired,money_placeholder:p.string.isRequired,can_embed:p.bool,state:p.oneOf(["uploading","ready","failed"]).isRequired,idx:p.number.isRequired,upload:p.shape({id:p.number,position:p.number,filename:p.string,progress_percent:p.number}).isRequired},getInitialState:function(){return{min_price_enabled:this.props.upload.min_price&&this.props.upload.min_price>0}},componentDidUpdate:function(v,m,N){if(this.props.upload.just_uploaded&&!v.upload.just_uploaded)return this.setState({min_price_enabled:this.props.upload.min_price&&this.props.upload.min_price>0,edit_display_name:this.props.upload.storage==="external"&&!this.props.upload.display_name})},input_name:function(v){return this.props.upload.id||console.warn("attempting to render upload form input with no upload id!"),"upload["+this.props.upload.id+"]["+v+"]"},update_upload:function(v,m){return this.trigger("upload:update_upload",this.props.upload,v,m)},delete_upload:function(){if(!this.props.loading){if(!this.props.upload.edit_url){console.error("Tried to delete an upload that lacks the edit_url prop");return}if(confirm("Are you sure you want to delete "+(this.props.upload.filename||"this file")+"? Deleted files **can not** be recovered."))return this.setState({loading:!0,deleting:!0}),he($.ajax({url:this.props.upload.edit_url,type:"delete",data:I.with_csrf()})).always(function(v){return function(){return v.setState({loading:!1,deleting:!1})}}(this)).then(function(v){return function(m){return v.trigger("upload:remove",v.props.upload)}}(this)).fail(function(v){return function(m){return Y($e({errors:m.errors}))}}(this))}},render:function(){switch(this.props.upload.state){case"ready":return this.render_ready();case"failed":return this.render_failed();case"uploading":return this.render_uploading();default:return M.Forms.FormErrors({errors:["Invalid state for rendering upload: "+this.props.upload.state]})}},render_uploading:function(){var v;return v=this.props.upload,i({className:"uploader is_uploading"},i({className:"upload_content"},i({className:"upload_title"},v.external?f({className:"progress_message"},"Creating"):o({},k({className:"upload_display_name"},I.truncate(v.display_name||v.filename,80)),f({className:"progress_message"}," \xB7 Uploading"))),i({className:"progress"},i({className:"progress_inner",style:{right:100-v.progress_percent+"%"}}))))},render_failed:function(){return i({className:"uploader"},i({className:"upload_content"},i({className:"error_message",role:"alert"},k({},"There was a problem completing your upload. "),this.props.upload.errors?this.props.upload.errors.join(", "):o({},"Try again. If the problem persists ",r({target:"_blank",href:"/support"},"contact support"),"."))))},render_ready:function(){var v,m,N;return m=this.props.upload,v=G("uploader",{loading:this.state.loading,is_hidden:this.props.upload.hidden,is_embed:this.props.can_embed&&this.props.upload.embed,is_demo:this.props.upload.demo,is_preorder:this.props.upload.preorder,is_external:this.props.upload.external,delete_hover:this.state.hover_delete}),Wt({className:v,idx:this.props.idx},d({type:"hidden",name:this.input_name("position"),value:this.props.idx}),i({className:"upload_tools"},m.external?void 0:t({type:"button",className:"more_btn textlike",onClick:function(S){return function(){return Y(M.GameEdit.UploadToolsLightbox({upload:m}))}}(this)},this.tt("misc.more_ellip")),t({type:"button",className:"delete_btn",onMouseEnter:function(S){return function(){return S.setState({hover_delete:!0})}}(this),onMouseLeave:function(S){return function(){return S.setState({hover_delete:!1})}}(this),onClick:this.delete_upload},this.tt("dashboard.edit_project.uploads.delete_file_button"))),i({className:"upload_content"},i({className:"upload_title"},d({name:this.input_name("display_name"),type:"hidden",value:m.display_name||""}),this.state.edit_display_name?n.InlineEdit({initial_value:m.display_name||m.filename||"",placeholder:"Enter a display name",finished:function(S){return function(C){return S.setState({edit_display_name:!1}),C.match(/^\s*$/)&&(C=null),C===m.filename&&(C=null),S.update_upload("display_name",C)}}(this)}):(N=m.display_name||m.filename)?o({},k({className:"upload_display_name"},I.truncate(N,80)),m.display_name?i({className:"upload_fname"},I.truncate(m.filename,80)):this.props.upload.just_uploaded?f({className:"success_message"}," \xB7 Success"):void 0):void 0),this.render_channel(),this.render_meta_data(),m.uploaded_at||m.downloads?i({className:"upload_stats"},!(this.props.can_embed&&m.embed)&&m.downloads!=null?f({},I.number_format(m.downloads)+" Download"+(m.downloads===1&&""||"s"),m.uploaded_at?", ":void 0):void 0,m.uploaded_at?f({title:m.uploaded_at+" UTC"},Ne(m.uploaded_at,"calendar")):void 0):void 0,i({className:"upload_type"},this.render_type_picker(),this.render_platform_picker()),this.render_external_url_row(),this.render_price_picker(),this.render_demo_toggle(),this.render_preorder_toggle(),this.render_embed_toggle(),this.render_hidden_toggle()))},render_external_url_row:function(){return this.props.upload.external?i({className:"external_url_row"},d({type:"text",defaultValue:this.props.upload.url||"",className:"external_url_input",name:this.input_name("url"),placeholder:"http://",required:"required"})):!1},render_meta_data:function(){var v;return v=this.props.upload,i({className:"meta_data"},v.external?f({className:"external_label"},"External file"):f({className:"file_size"},I.format_bytes(v.size)),f({className:"display_name_wrap"}," \xB7 ",r({href:"#",className:"set_display_name_btn",onClick:function(m){return function(N){return N.preventDefault(),m.setState({edit_display_name:!m.state.edit_display_name})}}(this)},this.tt("dashboard.edit_project.uploads.change_display_name_button"))),this.props.total_uploads>1?o({},"  ",ge({first:this.props.idx===0,last:this.props.idx===this.props.total_uploads-1,move_up:function(m){return function(){return m.trigger("upload:move_up",m.props.idx)}}(this),move_down:function(m){return function(){return m.trigger("upload:move_down",m.props.idx)}}(this)})):void 0)},render_type_picker:function(){var v,m,N;if(m=this.props,N=m.upload,v=m.can_embed,!(v&&N.embed))return M.Forms.SimpleSelect({name:this.input_name("type"),value:this.props.upload.type||"default",onChange:function(S){return function(C){return S.update_upload("type",C)}}(this),options:[{group:"Download",name:"Executable",value:"default"},{group:"Download",name:"Other",value:"other"},{group:"Download",name:"Soundtrack",value:"soundtrack"},{group:"Download",name:"Source code",value:"sourcecode"},{group:"Download",name:"Book or Document",value:"book"},{group:"Download",name:"Video",value:"video"},{group:"Download",name:"Mod",value:"mod"},{group:"Download",name:"Graphical assets",value:"graphical_assets"},{group:"Download",name:"Audio assets",value:"audio_assets"},{group:"Download",name:"Documentation or Instructions",value:"documentation"}]})},render_channel:function(){if(this.props.upload.channel_name)return i({className:"channel_row"},t({href:"#",title:"Channel: "+this.props.upload.channel_name,className:"channel_link open_channel_btn",onClick:function(v){return function(m){return m.preventDefault(),v.trigger("upload:open_channel",v.props.upload)}}(this)},f({className:"icon icon-upload"}),this.props.upload.channel_name))},render_platform_picker:function(){var v,m,N;if(m=this.props,N=m.upload,v=m.can_embed,!(v&&N.embed)&&(this.props.upload.type==="default"||!this.props.upload.type))return i({className:"platform_list"},f({className:"platforms_for"}," for "),[["p_windows","windows8","Download for Windows"],["p_linux","tux","Download for Linux"],["p_osx","apple","Download for Mac OS X"],["p_android","android","Download for Android"]].map(function(S){return function(C){var D,L,O,A;return L=C[0],O=C[1],A=C[2],D=G({platform_picker:!0,chosen:S.props.upload[L]}),h({key:L,className:D},d({name:S.input_name(L),"data-name":L,type:"checkbox",className:"checkbox",checked:S.props.upload[L]||!1,onChange:function(){return S.update_upload(L,!S.props.upload[L])}}),f({title:A,className:"icon icon-"+O}))}}(this)))},render_price_picker:function(){var v,m,N,S;return this.props.can_embed&&this.props.upload.embed||this.props.upload.demo||this.props.disable_payments?!1:(m=this.props.upload.min_price&&this.props.upload.min_price<=this.props.game_min_price,i({className:"upload_price_picker"},i({className:"min_price_toggle"},h({},d({type:"checkbox",className:"checkbox min_price_toggle_input",checked:this.state.min_price_enabled||!1,onChange:function(C){return function(){return C.setState({min_price_enabled:!C.state.min_price_enabled})}}(this)}),this.tt("dashboard.edit_project.uploads.set_price_toggle"))),this.state.min_price_enabled?(N=(S=this.props.upload.min_price)!=null?S:0,v=I.format_money(N,this.props.currency),i({className:"min_price_input_row input_row"},h({},i({className:"label"},"Minimum Price"),w({className:"sub"},"The minimum price for a file should be greater than the minimum price for the entire project. You should only set this if the file's minimum price is different than the project's."),n.MoneyInput({"data-currency":this.props.currency,name:this.input_name("min_price"),placeholder:this.props.money_placeholder,className:G("file_min_price",{has_error:m}),defaultValue:v,onKeyUp:function(C){return function(D){return C.update_upload("min_price",I.parse_money($(D.target).val()))}}(this)}),m?f({className:"price_error"},"Should be greater than the project's minimum price"):void 0))):void 0))},render_field_toggle:function(v){var m;if(!v.field)throw"missing field";return m=G("upload_field_toggle",v.className),i({className:m},h({},d({name:this.input_name(v.field),type:"checkbox","data-field":v.field,className:"checkbox",checked:this.props.upload[v.field]||!1,onChange:function(N){return function(){return N.update_upload(v.field,!N.props.upload[v.field])}}(this)}),v.label))},render_demo_toggle:function(){return this.props.upload.hidden||this.props.can_embed&&this.props.upload.embed||this.props.game_min_price===0||this.props.disable_payments?!1:this.render_field_toggle({field:"demo",label:this.tt("dashboard.edit_project.uploads.demo_toggle")})},render_preorder_toggle:function(){return this.props.upload.hidden||this.props.can_embed&&this.props.upload.embed||this.props.upload.demo||this.props.upload.external||this.props.game_min_price===0||this.props.disable_payments?!1:this.render_field_toggle({field:"preorder",label:this.tt("dashboard.edit_project.uploads.preorder_toggle")})},render_embed_toggle:function(){return this.props.upload.hidden||this.props.upload.demo||this.props.upload.external||!this.props.can_embed?!1:this.render_field_toggle({field:"embed",label:this.tt("dashboard.edit_project.uploads.play_in_browser_toggle")})},render_hidden_toggle:function(){return this.props.upload.embed?!1:this.render_field_toggle({field:"hidden",label:this.tt("dashboard.edit_project.uploads.hide_toggle")})}}),n("InlineEdit",{propTypes:{initial_value:p.string.isRequired,placeholder:p.string,finished:p.func},componentDidMount:function(){var v,m;return m=$(X.findDOMNode(this)),m.focus().select(),v=function(N){return function(S){var C,D;if(N.isMounted()){if(D=$(S.target).closest(m).length,D)return;typeof(C=N.props).finished=="function"&&C.finished(N.value())}return $(document.body).off("click",v)}}(this),$(document.body).on("click",v)},value:function(){return $(X.findDOMNode(this)).val()},render:function(){return d({type:"text",className:"inline_edit_input",placeholder:this.props.placeholder,defaultValue:this.props.initial_value,onKeyDown:function(v){return function(m){var N,S;switch(m.keyCode){case 9:return _.defer(function(){var C;return typeof(C=v.props).finished=="function"?C.finished(v.value()):void 0});case 13:return m.preventDefault(),typeof(N=v.props).finished=="function"?N.finished(v.value()):void 0;case 27:return m.preventDefault(),typeof(S=v.props).finished=="function"?S.finished(v.props.initial_value):void 0}}}(this)})}}),n("MoneyInput",{componentDidMount:function(){var v;return v=$(X.findDOMNode(this)),I.money_input(v)},render:function(){return d($.extend({type:"text",ref:"input"},this.props))}})});var Qt=null;I.libs.react.done(function(){var n,e,r,t,s,i,a;return e=F,i=e.form,r=e.a,t=e.code,a=e.fragment,a=P.createElement.bind(null,P.Fragment),a.type=P.fragment,n=M.package("GameEdit"),s=X.createPortal,Qt=n("FormManager",{propTypes:{game_tags:j.object,upload_image_url:j.string,upload_image_size_limit:j.number,cover_image:j.object},getInitialState:function(){var o;return{type:this.props.type,classification:this.props.classification,tags:_.toArray(((o=this.props.game_tags)!=null?o.tags:void 0)||[]),min_price:this.props.min_price,disable_payments:this.props.disable_payments}},componentDidMount:function(){return this.disconnect_events=M.dispatch($(this.props.form_el),{"game:set_state":function(o){return function(l,c){return console.warn("game:set_state",c),o.setState(c)}}(this)})},componentWillUnmount:function(){return this.disconnect_events()},render_game_tags:function(){return Ot(Object.assign({classification:this.state.classification,on_change_tags:function(o){return function(l){return o.setState({tags:l})}}(this)},this.props.game_tags))},render_cover_uploader:function(){return Jt({name:"game[cover_image_id]",upload_image_url:this.props.upload_image_url,max_size:this.props.upload_image_size_limit,cover_image:this.props.cover_image})},render_embed_options:function(){var o;return(o=this.state.type)!=="unity"&&o!=="java"&&o!=="html"?null:zt(Object.assign({type:this.state.type},this.props.embed_options))},render_game_links:function(){return Bt(Object.assign({tags:this.state.tags},this.props.game_links))},render_access_control:function(){var o;return Vt({game_id:(o=this.props.game)!=null?o.id:void 0,noun:this.props.noun,published:this.props.published,active:this.props.active,unlisted:this.props.unlisted,restricted:this.props.restricted,password:this.props.password,purchases_count:this.props.purchases_count})},render_price_picker:function(){return Kt({currency:this.props.currency,min_price:this.props.min_price,suggested_price:this.props.suggested_price,disable_payments:this.props.disable_payments,money_placeholder:this.props.money_placeholder,is_embed:this.state.type!=="default",default_donation_amount:this.props.default_donation_amount,reward_required:this.props.reward_required,rewards_url:this.props.rewards_url})},render_uploads:function(){var o;return Xt({ref:this.upload_list_ref||(this.upload_list_ref=P.createRef()),form_el:this.props.form_el,game_id:(o=this.props.game)!=null?o.id:void 0,initial_uploads:this.props.uploads,game_min_price:this.state.min_price,disable_payments:this.state.disable_payments,currency:this.props.currency,money_placeholder:this.props.money_placeholder,enable_dropbox:this.props.enable_dropbox,enable_slurp:this.props.enable_slurp,upload_limit:this.props.upload_limit,uploads_locked:this.props.uploads_locked,type:this.state.type})},render:function(){return this.tags_el||(this.tags_el=this.props.form_el.querySelector(".tags_drop")),this.cover_el||(this.cover_el=this.props.form_el.querySelector(".cover_uploader_drop")),this.embed_options_el||(this.embed_options_el=this.props.form_el.querySelector(".game_dimensions_drop")),this.game_links_el||(this.game_links_el=this.props.form_el.querySelector(".links_drop")),this.access_control_el||(this.access_control_el=this.props.form_el.querySelector(".access_control_drop")),this.price_picker_el||(this.price_picker_el=this.props.form_el.querySelector(".price_picker_drop")),this.uploads_el||(this.uploads_el=this.props.form_el.querySelector(".upload_drop")),a({},s(this.render_game_tags(),this.tags_el),s(this.render_cover_uploader(),this.cover_el),s(this.render_embed_options(),this.embed_options_el),s(this.render_game_links(),this.game_links_el),s(this.render_access_control(),this.access_control_el),s(this.render_price_picker(),this.price_picker_el),s(this.render_uploads(),this.uploads_el))}})}),window.init_EditGame=function(n,e){new I.EditGame(n,e),M.render(n+" .form_manager",()=>Qt(Object.assign({form_el:document.querySelector(n)},e)))};var en=[].slice,tn=[].indexOf||function(n){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===n)return e;return-1},Zt=null,er=null,tr=null,rr=null;E.libs.react.done(function(){var n,e,r,t,s,i,a,o,l,c,d,b,h,y,g,w;return e=F,a=e.div,o=e.h2,b=e.p,r=e.a,h=e.select,s=e.button,l=e.input,g=e.strong,c=e.label,y=e.span,w=e.ul,d=e.li,i=e.code,t=e.br,n=M.package("EditSale"),Zt=n("SaleConditions",{propTypes:{games:j.array.isRequired,selected_games:j.array.isRequired,sale_triggers:j.array.isRequired},getInitialState:function(){var u,f,k,p,x;for(u={},x=this.props.games,k=0,p=x.length;k<p;k++)f=x[k],u[f.id]=f;return{trigger_games:this.props.sale_triggers.map(function(v){return function(m){return u[m.game_id]}}(this))}},componentDidMount:function(){return this.dispatch({add_trigger:function(u){return function(f){var k;if(k=u.available_for_selection()[0],!!k)return u.setState({trigger_games:u.state.trigger_games.concat([k])})}}(this),remove_trigger:function(u){return function(f,k){var p,x;return u.setState({trigger_games:function(){var v,m,N,S;for(N=this.state.trigger_games,S=[],x=v=0,m=N.length;v<m;x=++v)p=N[x],x!==k&&S.push(p);return S}.call(u)})}}(this)})},available_games:function(){var u,f,k,p,x,v,m,N,S;for(S={},v=this.props.selected_games,f=0,p=v.length;f<p;f++)u=v[f],S[u.id]=!0;for(m=this.props.games,N=[],k=0,x=m.length;k<x;k++)u=m[k],u.paid_status>1&&!S[u.id]&&N.push(u);return N},render:function(){var u;return u=this.available_games(),a({className:"sale_conditions"},o({},"Sale conditions"),b({},"You can restrict who has access to this sale based on their purchase history."),u.length?this.render_trigger_picker():b({},"You don't have any available games to create a condition."))},render_trigger_picker:function(){var u;return u=this.available_games(),a({},a({className:"condition_rows"},this.state.trigger_games.map(function(f){return function(k,p){var x;if(x=f.available_games_select(k.id,p),!!x)return a({key:p,className:"condition_row"},"Must own ",x,s({type:"button",className:"button small",onClick:function(v){return f.trigger("remove_trigger",p)}},"Remove condition"))}}(this))),this.available_for_selection().length?a({className:"button_row"},s({type:"button",className:"button",onClick:function(f){return function(){return f.trigger("add_trigger")}}(this)},"Add condition")):void 0)},available_for_selection:function(u){return this.available_games().filter(function(f){return function(k){return k.id===u?!0:!f.state.trigger_games.some(function(p){return p.id===k.id})}}(this))},available_games_select:function(u,f){var k;if(k=this.available_for_selection(u),!(u&&!k.some(function(p){return function(x){return x.id===u}}(this))))return M.Forms.SimpleSelect({value:u,name:"sale_triggers["+(f+1)+"]",onChange:function(p){return function(x){var v,m,N,S,C,D;for(x=+x,S=p.props.games,C=[],m=0,N=S.length;m<N;m++)v=S[m],v.id===x?(D=en.call(p.state.trigger_games),D[f]=v,C.push(p.setState({trigger_games:D}))):C.push(void 0);return C}}(this),options:k.map(function(p){return function(x,v){return{value:x.id,name:x.title}}}(this))})}}),er=n("BundlePrice",{propTypes:{rate:j.number,bundle_price:j.number,selected_games:j.array.isRequired,suggested_price:j.number,currency:j.string},getInitialState:function(){return{custom_price:!!this.props.bundle_price}},can_bundle:function(){var u,f;return f=function(){var k,p,x,v;for(x=this.props.selected_games,v=[],k=0,p=x.length;k<p;k++)u=x[k],u.paid_status>1&&v.push(u);return v}.call(this),(this.props.rate||0)<100&&f.length>1},render:function(){return a({className:"input_row bundle_input_row"},o({},"Bundle"),this.can_bundle()?this.render_bundle_settings():b({},"If your sale has at least two projects and a rate less than 100% it can be bought as a bundle."))},render_bundle_settings:function(){var u,f;return f=E.format_money(this.props.suggested_price,this.props.currency),u=this.props.bundle_price||this.props.suggested_price,a({},b({},"Because you've selected multiple paid projects, your sale will also be available as a bundle for ",g({},f)," or more. (Sum of all items with rate applied)"),a({className:"custom_bundle_price_toggle"},c({},l({type:"checkbox",checked:this.state.custom_price,name:"sale[allow_bundle]",onChange:function(k){return function(p){return k.setState({custom_price:p.target.checked})}}(this)}),"Provide a custom bundle price")),this.state.custom_price?M.Forms.TextInputRow({title:"Bundle price",sub:"Minimum price to buy all items in sale at once",money_input:!0,currency:this.props.currency,name:"sale[bundle_price]",class:"medium_input bundle_price_input money_input",placeholder:E.format_money(0,this.props.currency),defaultValue:u?E.format_money(u,this.props.currency):void 0}):void 0)}}),tr=n("RatePicker",{propTypes:{set_rate:j.func,rate:j.number,allow_promotion_claim:j.bool},componentDidMount:function(){var u,f;return f=$(this.refs.rate_slider).slider({range:"min",min:0,value:this.state.rate,max:100,slide:function(k){return function(p,x){var v,m;return m=parseInt(x.value,10),k.setState({rate:m}),typeof(v=k.props).set_rate=="function"?v.set_rate(m,k.state.reverse):void 0}}(this)}),typeof(u=this.props).set_rate=="function"?u.set_rate(this.state.rate,this.state.reverse):void 0},getInitialState:function(){var u,f;return{rate:Math.abs((u=(f=this.props.rate)!=null?f:this.props.default_rate)!=null?u:50),reverse:this.props.rate?this.props.rate<0:!1}},render_rate_picker:function(){return a({className:"input_row rate_row"},a({className:"label"},"Rate",y({className:"sub"}," \u2014 What percentage "+(this.state.reverse&&"increase"||"off")+" is this sale?")),a({className:"inner_toggle"},c({},l({type:"checkbox",name:"sale[reverse_rate]",checked:this.state.reverse,onChange:function(u){return function(f){var k;return u.setState({reverse:f.target.checked}),typeof(k=u.props).set_rate=="function"?k.set_rate(u.state.rate,f.target.checked):void 0}}(this)}),"Reverse sale",y({className:"sub"}," \u2014 Make your projects more expensive!"))),a({className:"slider_row"},a({className:"rate_slider_outer"},a({className:"rate_slider",ref:"rate_slider"}),l({type:"hidden",name:"sale[rate]",className:"rate_slider_input",value:this.state.rate})),y({className:"rate_value"},this.state.rate+"%"),y({className:"sub"},this.state.reverse?" increased minimum prices":" off all minimum prices")))},render_rate_settings:function(){var u;if(this.state.rate===100&&!this.state.reverse)return a({className:"input_row"},a({className:"label"},"Additional settings"),w({className:"check_list"},d({},c({},l({type:"checkbox",defaultChecked:(u=this.props.allow_promotion_claim)!=null?u:!0,name:"sale[allow_promotion_claim]"}),"Allow items to be claimed",y({className:"sub"}," \u2014 People can permanently claim a free copy while the sale is active")))))},render:function(){return a({className:"rate_picker"},this.render_rate_picker(),this.render_rate_settings())}}),rr=n("CouponSettings",{propTypes:{user_slug:j.string.isRequired,coupon:j.string,max_redeems:j.number,redeems:j.number,taken_slugs:j.array,rate:j.number},getInitialState:function(){return{coupon:this.props.coupon,max_redeems:this.props.max_redeems===0?"":this.props.max_redeems}},randomize_coupon:function(){var u,f;return u="ABCDEFGHJKMNPQRSTUVWXY3456789",i=function(){var k,p;for(p=[],f=k=1;k<=10;f=++k)p.push(u[Math.floor(Math.random()*u.length)]);return p}().join(""),this.setState({coupon:i})},render:function(){return a({className:"coupon_settings"},o({},"Coupon code"),b({},"If a coupon code is provided then the coupons's special URL must be used to access the promotion. The sale will not be listed anywhere on itch.io. You can also limit the quantity available. Coupons are case insensitive."),this.props.redeems&&this.props.redeems>0?b({className:G({coupon_error:this.state.redeem_error})},"This coupon has already been claimed ",g({},this.props.redeems+" times.")):void 0,a({className:"joint_input_row"},M.Forms.TextInputRow({title:"Coupon code",name:"sale[coupon]",placeholder:"Optional",multi:!0,slug_input:!0,value:this.state.coupon||"",has_error:this.state.slug_error,onChange:function(u){return function(f){var k,p;return i=f.target.value,p=(k=i.toLowerCase(),tn.call(u.props.taken_slugs,k)>=0),u.setState({coupon:i,slug_error:p})}}(this),sub:s({"data-tooltip":"Generate random",className:"icon icon-dice random_coupon_btn",onClick:function(u){return function(f){return u.randomize_coupon(),f.preventDefault()}}(this)})}),this.props.rate!==100?M.Forms.TextInputRow({title:"Maximum redeems",sub:"How many times can the coupon be used",name:"sale[coupon_max_redeems]",has_error:this.state.redeem_error,value:this.state.max_redeems,placeholder:"No limit",pattern:"[0-9]*",integer_input:!0,onChange:function(u){return function(f){var k,p;return p=f.target.value,k=p&&+p>0?(u.props.redeems||0)>+p:!1,u.setState({max_redeems:p,redeem_error:k})}}(this)}):void 0),(this.state.coupon||"")!==""?this.state.slug_error?b({className:"coupon_error"},"That name is already taken by a project on your account"):b({className:"coupon_preview"},g({},"Your coupon URL:"),t({}),y({className:"preview_url"},"https://"+this.props.user_slug+".itch.io/"+(this.state.coupon||""))):void 0)}})});var nr=function(n,e){return function(){return n.apply(e,arguments)}};I.EditSaleForm=function(){n.prototype.date_format="yy-mm-dd",n.prototype.time_format="HH:mm:ss",n.prototype.format_date_time=function(e){var r,t;return t=$.datepicker.formatTime(this.time_format,{hour:e.getHours(),minute:e.getMinutes(),second:e.getSeconds()}),r=$.datepicker.formatDate(this.date_format,new Date(e)),r+" "+t};function n(e,r){var t;this.opts=r,this.setup_game_pickers=nr(this.setup_game_pickers,this),this.format_date_time=nr(this.format_date_time,this),this.sale=this.opts.sale,this.is_new=!this.sale,this.el=$(e),this.setup_datepickers(),this.setup_bundle_price(),this.setup_goal_amount(),this.render(),this.setup_game_pickers(),this.setup_timezone(),this.el.has_tooltips(),t=this.el.find(".header_nav").find(".save_btn").on("click",function(s){return function(){return s.form.submit()}}(this)),this.form=this.el.find("form").remote_submit(function(s){return function(i,a){var o;if(i.errors){a.set_form_errors(i.errors);return}return a.set_form_errors([]),i.edit_url&&typeof(o=window.history).replaceState=="function"&&o.replaceState({},"Edit sale",i.edit_url),s.is_new?window.location=i.url:I.flash("Sale saved")}}(this)),this.form.on("i:before_submit",function(s){return function(){return t.prop("disabled",!0).addClass("disabled")}}(this)),this.form.on("i:after_submit",function(s){return function(){return t.prop("disabled",!1).removeClass("disabled")}}(this)),I.setup_dirty_warning(this.form),this.el.dispatch("click",{select_all_games_btn:function(s){return function(i){var a;return a=i.closest(".input_group").find(".game_row:not(.disabled) input"),a.prop("checked",!0),s.el.trigger("i:update_games")}}(this),select_no_games_btn:function(s){return function(i){var a;return a=i.closest(".input_group").find(".game_row:not(.disabled) input"),a.prop("checked",!1),s.el.trigger("i:update_games")}}(this)}),ie(this.el.find("textarea"),{minHeight:80})}return n.prototype.render_errors=function(e){var r,t;return this.form_errors||(this.form_errors=this.el.find(".form_errors")),this.el.addClass("has_errors"),t=function(){var s,i,a;for(a=[],s=0,i=e.length;s<i;s++)r=e[s],a.push($("<li>").text(r));return a}(),this.form_errors.find("ul").empty().append(t),this.form_errors.hide().slideDown("fast")},n.prototype.setup_goal_amount=function(){return this.goal_input=this.el.find(".goal_input"),I.money_input(this.goal_input)},n.prototype.setup_bundle_price=function(){var e,r;return this.price_input=this.el.find(".bundle_price_input"),I.money_input(this.price_input),this.el.on("change",".bundle_toggle_input",function(t){return function(s){var i;return i=$(s.currentTarget),t.el.toggleClass("is_bundle",i.prop("checked"))}}(this)),e=this.el.find(".game_list"),r=function(t){return function(){var s,i,a,o,l,c;if(t.current_rate!=null)return l=t.reverse_rate?1+t.current_rate/100:1-t.current_rate/100,a=e.find("input:checked"),i=l>0&&a.length>1,t.selected_games=function(){var d,b,h;for(h=[],d=0,b=a.length;d<b;d++)s=a[d],h.push({id:$(s).data("game_id"),min_price:$(s).data("game_min_price"),paid_status:$(s).data("game_paid_status")});return h}(),t.suggested_price=function(){var d,b;if(i){for(c=0,d=0,b=a.length;d<b;d++)o=a[d],c+=$(o).data("game_min_price");return c*l}}(),t.render()}}(this),this.el.on("i:update_rate i:update_games",function(t){return function(){return r()}}(this))},n.prototype.setup_timezone=function(){return this.el.find(".timezone_offset").val(new Date().getTimezoneOffset()/60)},n.prototype.render=function(){return this.render_slider(),this.render_bundle_price(),this.render_sale_conditions(),this.render_coupon_settings()},n.prototype.render_coupon_settings=function(){var e,r,t,s,i;return X.render(rr({user_slug:this.opts.user_slug,taken_slugs:_.toArray(this.opts.taken_slugs),coupon:(e=this.sale)!=null?e.coupon:void 0,redeems:(r=this.sale)!=null?r.coupon_redeems:void 0,max_redeems:(t=this.sale)!=null?t.coupon_max_redeems:void 0,rate:(s=this.current_rate)!=null?s:(i=this.sale)!=null?i.rate:void 0}),this.el.find(".coupon_drop")[0])},n.prototype.render_sale_conditions=function(){return X.render(Zt({selected_games:this.selected_games||[],sale_triggers:this.opts.sale_triggers||[],games:this.opts.games||[]}),this.el.find(".sale_conditions_drop")[0])},n.prototype.render_bundle_price=function(){var e,r,t;return X.render(er({rate:(e=this.current_rate)!=null?e:(r=this.sale)!=null?r.rate:void 0,bundle_price:(t=this.sale)!=null?t.bundle_price:void 0,currency:this.opts.currency,selected_games:this.selected_games||[],suggested_price:this.suggested_price}),this.el.find(".bundle_price_drop")[0])},n.prototype.render_slider=function(){var e,r;return this._set_rate||(this._set_rate=function(t){return function(){var s,i;return s=t.el.find(".game_list"),i=s.find(".game_price.after_sale"),function(a,o){var l,c,d,b,h;for(h=a/100,c=0,d=i.length;c<d;c++)b=i[c],b=$(b),l=o?b.data("default_price")*(1+h):b.data("default_price")*(1-h),b.text(I.format_money(l,t.opts.currency));return t.current_rate=a,t.reverse_rate=o,t.el.trigger("i:update_rate",[h])}}}(this)()),X.render(tr({rate:(e=this.sale)!=null?e.rate:void 0,allow_promotion_claim:(r=this.sale)!=null?r.allow_promotion_claim:void 0,default_rate:this.opts.default_rate,set_rate:this._set_rate}),this.el.find(".sale_rate_drop")[0])},n.prototype.setup_datepickers=function(){var e,r,t,s,i,a;if(i=this.el.find(".date_picker.start_date"),t=this.el.find(".date_picker.end_date"),e=this.el.find(".duration_summary"),a=function(o,l){var c,d,b;if(l==null&&(l=!0),l&&o.is(".start_date")&&(d=o.datetimepicker("getDate"),t.datetimepicker("option","minDate",new Date(+d))),b=i.datetimepicker("getDate"),c=t.datetimepicker("getDate"),b&&c)return e.text(it(c-b,3,!1))},s=this.el.find(".date_picker"),Ie(s,{onSelect:function(o){return a($(this))}}),i.val())return r=$.datepicker.parseDateTime(this.date_format,this.time_format,t.val()),t.datetimepicker("setDate",r),a(i)},n.prototype.setup_game_pickers=function(){var e;return e=this.el.find(".game_list"),e.on("change","input",function(r){return function(){return r.el.trigger("i:update_games")}}(this))},n}(),window.init_EditSale=function(n,e){new I.EditSaleForm(n,e)},window.init_GamePressLinks=function(n,e){new I.GameInteract(n,e)},window.init_GameKeys=function(n,e){new I.GameKeys(n,e)};var rn=[].slice,ot=null;I.libs.react.done(function(){var n,e,r,t,s,i,a,o,l,c,d,b;return e=F,r=e.a,a=e.label,s=e.button,i=e.div,o=e.span,n=R.package("Dashboard"),d=F.thead,l=F.tbody,b=F.tr,c=F.td,t=F.abbr,ot=n("NiceTable",{getInitialState:function(){return{rows_sorted:this.props.rows}},componentDidUpdate:function(h,y){if(h.rows!==this.props.rows)return this.setState({rows_sorted:this.props.rows})},set_sort:function(h){var y,g,w,u,f;return u=rn.call(this.state.rows_sorted),w=function(){var k;switch(h.sort){case"both":return this.state.sort_col===h?this.state.sort_dir==="asc"?"desc":"asc":h.type==="number"?"desc":(k=h.default_sort)!=null?k:"asc";case"asc":return"asc";case"desc":return"desc"}}.call(this),y=-1,g=1,w==="asc"&&(y=1,g=-1),f=function(k){return function(p){var x,v,m;return(x=(v=k.props.field_sorters)!=null?v[h.type]:void 0)?x(p,h):h.value?h.value(p,h):p[(m=h.sort_field)!=null?m:h.field]}}(this),u.sort(function(k,p){var x,v;return x=f(k),v=f(p),x==null?y:v==null?g:x===v?0:x<v?g:x>v?y:0}),this.setState({rows_sorted:u,sort_dir:w,sort_col:h})},render:function(){return this.enclose({component:"table",className:classNames("nice_table",this.props.className)},d({},b({},this.render_column_headers())),l({},this.render_rows()))},render_column_headers:function(){return this.props.columns.map(function(h){return function(y,g){var w,u,f,k;return u=(f=y.label)!=null?f:y.field,y.sort&&(u=s({className:"sort_button",type:"button",onClick:function(p){return h.set_sort(y)}},u,i({className:"sort_directions"},tt({}),rt({})))),w=y===h.state.sort_col?classNames({sorted:!0,sort_desc:h.state.sort_dir==="desc",sort_asc:h.state.sort_dir==="asc"}):void 0,c({className:w,key:(k=y.field)!=null?k:g},u)}}(this))},render_rows:function(){return this.state.rows_sorted.map(function(h){return function(y,g){var w,u;return w=(u=y.key)!=null?u:g,b({key:w},h.props.columns.map(function(f,k){var p;return c({key:w+"-"+((p=f.field)!=null?p:k)},h.render_field(y,f))}))}}(this))},render_field:function(h,y){var g,w,u;return u=y.field?h[y.field]:y.value?y.value(h,y):void 0,g=function(){var f,k;switch(y.type){case"number":return u&&u!==0?I.number_format(u):o({className:"sub"},"0");case"boolean":return u?i({className:"bool_column"},y.field):i({className:"bool_column false"},"not "+y.field);case"date":return u?t({title:u,className:"datetime"},o({className:"icon icon-stopwatch","aria-hidden":"true"})," ",Ne(u)):o({className:"sub"},"n/a");case"html":return o({dangerouslySetInnerHTML:{__html:u}});default:if(y.render)return y.render(h,y);if((f=this.props.field_renderers)!=null&&f[y.type])return(k=this.props.field_renderers)!=null?k[y.type](h,y):void 0;if(y.type)return"unhandled type: "+y.type;if(u)return u;if(y.empty_value)return o({className:"sub"},y.empty_value)}}.call(this),(w=y.href&&h[y.href])?r({className:"field_"+(y.type||"text"),href:w},g):g}})}),window.init_GameSummary=function(n,e){new I.GameSummary(n)};var ut=null;E.libs.react.done(function(){var n,e,r,t;return e=F,r=e.input,t=e.textarea,n=M.package("Forms"),ut=n("RedactorInput",{pure:!0,componentDidMount:function(){var s;return s=V.extend({minHeight:80,source:!1},this.props.redactor_opts),s.callbacks||(s.callbacks={}),s.callbacks.change=function(i){return function(a){var o;if(typeof(o=i.props).on_change=="function"&&o.on_change(a),i.props.remember_key)return i.set_memory||(i.set_memory=z.throttle(function(l){return E.store_memory(this.remember_key(),l)},500)),i.set_memory(a)}}(this),ie(V(this.input_ref.current),s)},remember_key:function(){return"inputmemory:"+this.props.remember_key},clear_memory:function(){return E.clear_memory(this.remember_key())},get_default_value:function(){var s;if((s=this.props.defaultValue)||this.props.remember_key&&(s=typeof localStorage!="undefined"&&localStorage!==null?localStorage.getItem(this.remember_key()):void 0))return s},render:function(){return t({ref:this.input_ref||(this.input_ref=P.createRef()),name:this.props.name,value:this.props.value,defaultValue:this.get_default_value(),placeholder:this.props.placeholder,required:this.props.required,autoFocus:this.props.autofocus})}})});var ir=null;E.libs.react.done(function(){var n,e,r,t,s,i,a,o,l,c,d,b,h,y;return e=F,o=e.input,s=e.div,l=e.label,h=e.span,d=e.option,c=e.li,y=e.ul,b=e.p,r=e.a,t=e.button,i=e.form,a=e.h2,n=M.package("Bundle"),n("Timezone",{render:function(){return o({type:"hidden",name:"timezone_offset",className:"timezone_offset",value:new Date().getTimezoneOffset()/60})}}),n("Label",{render:function(){return s({className:"label"},this.props.title,this.props.sub?h({className:"sub"}," \u2014 ",this.props.sub):void 0)}}),n("BasicInfo",{render:function(){return s({},s({className:"input_row"},l({},n.Label({title:"Title",sub:"What is the name of your bundle?"}),o({type:"text",name:"bundle[title]",className:"big_input title_input"}))),s({className:"input_row"},l({},n.Label({title:"Description",sub:"Optional description of bundle"}),ut({name:"bundle[description]"}))))}}),n("Slider",{componentDidMount:function(){return this.slider=$(X.findDOMNode(this)).slider({range:"min",animate:"fast",min:0,max:100,step:.001,value:this.props.value,disabled:!!this.props.disabled,slide:function(g){return function(w,u){return g.props.onChange(u.value)}}(this)})},componentDidUpdate:function(g){if(g.value!==this.props.value&&this.slider.slider("value",this.props.value),g.disabled!==this.props.disabled)return this.slider.slider("option","disabled",this.props.disabled)},render:function(){return s({className:"split_slider"},o({type:"hidden",name:"bundle[split]["+this.props.name+"]",className:"split_slider_input",value:this.props.intValue}))}}),n("SplitSlider",{render:function(){return c({className:"split_slider_container"},we({width:35,height:35,src:this.props.user.avatar,className:"avatar"}),s({className:"username"},this.props.user.name),s({className:"split_slider_outer"},n.Slider({name:this.props.user.id,value:this.props.value,intValue:this.props.intValue,onChange:this.props.onChange,disabled:this.props.disabled})),s({className:"split_summary"},h({className:"split_value"},[this.props.intValue,"%"])))}}),n("RevenueSplit",{getInitialState:function(){return{parts:[]}},render:function(){return this.state.parts.length>0?s({},n.Label({title:"Developer cut distribution",sub:"How revenue is split among participants"}),s({className:"input_row split_row"},y({className:"split_list",children:this.state.parts.map(function(g){return function(w,u){return n.SplitSlider({key:w.user.id,user:w.user,value:w.split,intValue:g.intSplit(u),disabled:g.state.parts.length===1,onChange:g.setSplit.bind(g,w.user.id)})}}(this))}),s({className:"split_presets"},"Choose a preset: ",r({href:"#",className:"equal_split_btn",onClick:this.setEqualSplit},"equal split")))):!1},setSplit:function(g,w,u){var f,k,p,x,v,m;return u==null&&(u=this.state.parts),k=z.findIndex(u,function(N){return N.user.id===g}),u[k].split=w,p=u.length-1,v=0,x=0,m=1e-5,u.forEach(function(N,S){if(v+=N.split,S!==k)return x+=N.split+m}),f=100-v,u.forEach(function(N,S){var C;if(S!==k)return C=(N.split+m)/x,N.split+=f*C}),u.forEach(function(N,S){var C,D,L;if(!(N.split>=0))return D=N.split,C=u.filter(function(O,A){return A!==k&&A.split>0}),L=D/C.length,N.split=0,C.forEach(function(O){return function(A){return A.split+=L}}(this))}),this.setState({parts:u})},intSplit:function(g){var w,u,f,k,p,x;if(p=function(){var v,m,N,S;for(N=this.state.parts,S=[],v=0,m=N.length;v<m;v++)k=N[v],S.push($.extend({},k));return S}.call(this),x=100,p.length===0)return x;for(u=0,f=p.length;u<f;u++)k=p[u],k.split=Math.floor(k.split),x-=k.split;for(w=0;x>0;)x-=1,p[w%p.length].split+=1,w+=1;return p[g].split},setEqualSplit:function(g){var w,u,f,k,p,x,v;if(g!=null&&g.preventDefault(),p=function(){var m,N,S,C;for(S=this.state.parts,C=[],m=0,N=S.length;m<N;m++)k=S[m],C.push(k);return C}.call(this),p.length!==0){for(v=Math.floor(100/p.length),x=100,u=0,f=p.length;u<f;u++)k=p[u],k.split=v,x-=v;for(w=0;x>0;)x-=1,p[w%p.length].split+=1,w+=1;return this.setState({parts:p})}},getTotal:function(){return z.reduce(this.state.parts,function(g,w){return g+w.split},0)}}),n("GameList",{getInitialState:function(){return{game_url:"",games:[],loading:!1}},render_game:function(g){return c({key:g.id,className:"game_row"},o({type:"hidden",name:"bundle[games]["+g.id+"][checked]",value:"true"}),s({className:"primary_details"},g.cover?we({width:37,height:28,src:g.cover}):void 0,s({className:"game_info"},r({href:g.url,className:"game_title",target:"_blank"},g.title),h({}," by ",r({href:g.user.url,className:"game_author",target:"_blank"},g.user.name))),s({className:"price_tag"},E.format_money(g.price,g.currency)),l({className:"minimum_price_checkbox"},o({type:"checkbox",onChange:this.minPriceToggle.bind(this,g.id)}),"Set minimum price"),t({type:"button",className:"remove_game textlike",onClick:function(w){return function(){return w.removeGame(g.id)}}(this)},"Remove")),g.has_min_price?s({className:"minimum_price_picker"},s({className:"label"},"Minimum price"),b({className:"sub"},"The minimum price for an item should be greater than the minimum price for the entire bundle. You should only set this if the item's minimum price is different than the bundle's."),n.MoneyInput({name:"bundle[games]["+g.id+"][min_price]",className:"item_price_input",currency:"USD"})):void 0)},render:function(){var g;return s({className:G("input_row game_list_row",{loading:this.state.loading})},b({},"Paste the itch.io URL of one or more projects separated by spaces"),n.Label({title:"Project URLs"}),s({className:"input_split"},o({type:"text",className:"game_url_input",placeholder:"e.g. http://example.itch.io/game",onChange:function(w){return function(u){return w.setState({game_url:u.target.value})}}(this),onKeyPress:function(w){return function(u){if(u.charCode===13)return w.submitGame(),u.preventDefault()}}(this),value:this.state.game_url,disabled:this.state.loading}),t({type:"button",className:"button add_game_btn",onClick:this.submitGame},"Add")),s({className:"loader form_loader",style:{display:this.state.loading&&"inline-block"}}),(g=this.state.errors)!=null&&g.length?M.Forms.FormErrors({errors:this.state.errors}):void 0,this.state.games.length>0?s({},y({className:"bundle_game_list",children:this.state.games.map(this.render_game)}),s({className:"game_list_summary"},"Sum of all games: ",h({className:"price"},this.priceSummary()))):void 0)},submitGame:function(g){return $.ajax({url:"/bundle/game-info",type:"post",data:E.with_csrf({urls:this.state.game_url}),success:function(w){return function(u){return w.setState({errors:u.errors}),w.add_games(u)}}(this),error:function(){return this.setState({errors:["Server error, try again later"]})},complete:function(w){return function(){return w.setState({loading:!1})}}(this)}),this.setState({loading:!0})},add_games:function(g){var w;return w=z.union(this.state.games,g.games),w=z.uniq(w,function(u){return u.id}),this.setState({games:w,game_url:""})},removeGame:function(g){var w;return w=z.filter(this.state.games,function(u){return u.id!==g}),this.setState({games:w})},minPriceToggle:function(g,w){var u,f;return f=w.target.checked,u=z.map(this.state.games,function(k){return k.id===g?z.extend(k,{has_min_price:f}):k}),this.setState({games:u})},componentDidUpdate:function(g,w){if(w.games!==this.state.games)return this.props.on_games(this.state.games)},priceSummary:function(){var g,w;return g=z.groupBy(this.state.games,"currency"),w=z.map(g,function(u,f){var k,p,x,v;for(v=0,p=0,x=u.length;p<x;p++)k=u[p],v+=k.price;return E.format_money(v,f)}),z.reduce(w,function(u,f){return u+" + "+f})}}),n("MoneyInput",{componentDidMount:function(){return E.money_input($(X.findDOMNode(this)))},render:function(){return o({type:"text",name:this.props.name,className:"medium_input money_input "+this.props.className,placeholder:"$0.00"})}}),n("Price",{render:function(){return P.createElement(P.Fragment,{},s({className:"input_row bundle_price_row"},l({},n.Label({title:"Minimum price",sub:"Minimum price to buy this bundle, can be 0"}),n.MoneyInput({name:"bundle[bundle_price]",className:"bundle_price_input",currency:"USD"}))),M.Forms.TextInputRow({title:"Goal",sub:P.createElement(P.Fragment,{},"Publicly show the earnings of the bundle along with the progress towards your goal. Leave blank to disable. ",r({href:"https://itch.io/docs/creators/sales#sale-goals"},"Learn more")),name:"bundle[goal]",placeholder:"Optional",money_input:!0,currency:"USD"}))}}),n("DatePicker",{componentDidMount:function(){var g;return g=$(this.input_ref.current),Ie(g,{onSelect:function(w){return function(u){return w.props.onChange(g.datetimepicker("getDate"))}}(this)})},render:function(){return o({ref:this.input_ref||(this.input_ref=P.createRef()),type:"text",className:"date_picker",name:this.props.name,readOnly:"readonly"})}}),n("Duration",{getInitialState:function(){return{}},render:function(){return s({className:"input_row duration_row"},n.Label({title:"Duration",sub:"When the bundle starts and ends in your local time"}),s({},l({},h({className:"duration_label"},"Start date:"),n.DatePicker({name:"bundle[start_date]",onChange:this.setDate.bind(this,"start")})),l({},h({className:"duration_label"},"End date:"),n.DatePicker({name:"bundle[end_date]",onChange:this.setDate.bind(this,"end")})),h({className:"duration_summary"},this.state.summary)))},setDate:function(g,w){var u;return u=this.state,u[g]=w,u.start&&u.end&&(u.summary=it(u.end-u.start,3,!1)),this.setState(u)}}),n("Published",{render:function(){return s({className:"input_row"},n.Label({title:"Publishing your bundle"}),b({className:"sub"},"Once you create the bundle it will be locked in draft mode. All participants must approve of the bundle before it can be made public. Only minimal edits can be made to a bundle in draft mode so participants can approve it without any surprise changes. Please verify the information you provided above is correct."))}}),ir=n("NewBundle",{getInitialState:function(){return{errors:[]}},componentDidMount:function(){return $(this.form_ref.current).remote_submit(function(g){return function(w,u){if(g.setState({errors:w.errors}),!w.errors&&w.url)return window.location=w.url}}(this))},render:function(){var g;return this.enclose({component:"form",method:"POST",ref:this.form_ref||(this.form_ref=P.createRef())},M.CSRF({}),n.Timezone({}),b({},"A co-op bundle is a bundle between multiple creators on itch.io. From this page you can invite others into your bundle by picking their content. After you've created the bundle each participant must approve it before it can be enabled and go live."),this.props.warn_payouts?b({className:"payouts_warning"},"Due to the complexity of distributing purchases across multiple sellers, all purchases of co-op bundles go through ",r({href:"/dashboard/payouts"},"itch.io's payout system"),". Prices are done in USD and VAT will automatically be added if necessary."):void 0,(g=this.state.errors)!=null&&g.length?M.Forms.FormErrors({errors:this.state.errors,scroll_into_view:!0}):void 0,n.BasicInfo({}),a({},"Add projects"),n.GameList({on_games:this.on_games,price:this.state.price,ref:"game_list"}),a({},"Price & date"),n.Price({}),n.Duration({}),n.RevenueSplit({ref:"split"}),n.Published({}),s({className:"buttons"},t({className:"button save_btn"},"Create co-op bundle")))},on_games:function(g){var w,u,f,k,p,x,v,m;return p=this.refs.split,u=z.indexBy(p.state.parts,function(N){return N.user.id}),m=z.map(g,function(N){return N.user}),m=z.indexBy(m,function(N){return N.id}),f=z.groupBy(g,function(N){return N.user.id}),f=z.map(f,function(N,S){var C;return{user:m[S],numGames:N.length,split:((C=u[S])!=null?C.split:void 0)||-1}}),f.length===1?f[0].split=100:f.length>0&&(w=!1,z.each(f,function(N){if(N.split===-1)return w=!0,p.setSplit(N.user.id,Math.ceil(100/f.length),f)}),w||(v=0,z.each(f,function(N){return v+=N.split}),x=100/v,k=100,z.each(f,function(N){return N.split=Math.floor(N.split*x),k-=N.split}),f[0].split+=k)),p.setState({parts:f})}})}),window.init_NewBundle=function(n,e){M.render(n+" .padded",()=>ir(e))};var nn=function(){function n(e,r){var t,s,i,a;for(this.el=$(e),i=this.el.find(".remote_table"),t=0,s=i.length;t<s;t++)a=i[t],$(a).remote_table();this.el.format_timestamps("fromNow"),r.cumulative_earnings&&new Je("#cumulative_earnings_graph",r.cumulative_earnings,{currency:r.currency})}return n}();window.init_SaleAnalytics=function(n,e){new nn(n,e)};var qe=[].slice,sn={}.hasOwnProperty,sr=null;E.libs.react.done(function(){var n,e,r,t,s,i,a,o,l,c,d,b,h,y,g,w,u,f,k,p,x,v,m,N,S,C,D,L,O,A,H,J,K,oe,vr,yr,wr;return l=F,x=l.input,c=l.a,A=l.select,h=l.code,wr=l.ul,m=l.li,b=l.button,g=l.div,vr=l.textarea,p=l.img,k=l.iframe,f=l.h2,u=l.form,v=l.label,L=l.pre,C=l.p,d=l.br,H=l.span,w=l.em,a=M.package("Forms"),J=F.table,K=F.tbody,yr=F.tr,oe=F.td,sr=a("MarkdownInput",{pure:!0,propTypes:{name:j.string,value:j.string},getDefaultProps:function(){return{max_default_height:400,enable_image_pasting:!0}},getInitialState:function(){return{}},componentWillUnmount:function(){return this.unmounted=!0},componentDidMount:function(){var T,q,U;if(U=this.input_ref.current.scrollHeight,T=this.input_ref.current.clientHeight,U>T&&this.setState({default_height:Math.min(U,this.props.max_default_height)}),this.props.autofocus&&z.defer(function(B){return function(){var W;return(W=B.input_ref.current)!=null?W.focus():void 0}}(this)),this.props.enable_image_pasting)return(q=this.input_ref.current)!=null?q.addEventListener("paste",this.on_paste):void 0},on_paste:function(T){var q,U,B,W,te,ee,Ve,ye;if(!this.state.loading){for(q=T.clipboardData||window.clipboardData,ee=q.items,Ve=[],B=0,te=ee.length;B<te;B++)if(W=ee[B],W.kind==="file"&&(W.type==="image/png"||W.type==="image/jpeg")&&W.getAsFile!=null){U=W.getAsFile(),T.preventDefault(),ye=Lr(Rt(U,{url:E.root_url("dashboard/upload-image"),file_params:function(Z){return $.when(E.test_image_format(Z),E.test_image_dimensions(Z)).then(function(se){return function(){return E.image_dimensions(Z).then(function(De){var je,kr;return kr=De[0],je=De[1],{width:kr,height:je,source:"clipboard"}})}}(this))}})),this.setState({loading:!0,loading_reason:"Uploading image..."}),ye.always(function(Z){return function(){if(!Z.unmounted)return Z.setState({loading:!1})}}(this)),ye.then(function(Z){return function(se){var De,je;if(!Z.unmounted&&(De=(je=se.upload)!=null?je.thumb_url:void 0)&&Z.input_ref.current!=null)return Z.insert_line("!["+U.name+"]("+De+")")}}(this)),ye.fail(function(Z){return function(se){if(!Z.unmounted)return Y(et(Object.assign({title:"Unable to upload image"},se)))}}(this));break}return Ve}},get_value:function(){var T;return(T=this.input_ref.current)!=null?T.value:void 0},set_value:function(T){return this.input_ref.current.value=T},click_bold_text:function(T){return this.wrap_selection("**","**")},click_italic_text:function(T){return this.wrap_selection("*","*")},click_insert_link:function(T){var q,U,B;if(B=this.get_selected_text(),q=this.input_ref.current,B.match(/^https?:\/\/[^\s]+$/))return this.wrap_selection("[](",")"),q.selectionStart=q.selectionStart-2,q.selectionEnd=q.selectionStart;if(this.wrap_selection("[","](url)"),B.length>0)return U=q.selectionEnd,q.selectionStart=U+2,q.selectionEnd=U+5},click_insert_video:function(T){return Y(a.MarkdownVideoEmbedLightbox({on_submit:function(q){return function(U){return q.insert_line(U)}}(this)}))},click_insert_image:function(T){return E.Lightbox.open_remote(E.root_url("dashboard/upload-image"),Pt,function(q){return function(U){var B;if(E.Lightbox.close(),!q.unmounted&&(B=q.input_ref.current))return q.insert_line("![]("+U+")")}}(this))},click_show_help:function(T){return Y(a.MarkdownHelpLightbox({}))},get_selected_text:function(){var T;return(T=this.input_ref.current)?T.value.substring(T.selectionStart,T.selectionEnd):""},wrap_selection:function(T,q){var U,B,W,te,ee,Ve,ye,Z,se;return U=this.input_ref.current,ee=U.selectionStart,te=U.selectionEnd,se=U.value,ye=se.substring(0,U.selectionStart),Ve=se.substring(U.selectionEnd,se.length),Z=se.substring(U.selectionStart,U.selectionEnd),U.focus(),W=""+T+(Z||"")+q,B=document.execCommand("insertText",!1,W),B||typeof U.setRangeText=="function"&&U.setRangeText(W),U.selectionStart=ee+T.length,U.selectionEnd=te+T.length},insert_line:function(T){var q,U;if(q=this.input_ref.current,q.focus(),U=document.execCommand("insertText",!1,T),!U)return typeof q.setRangeText=="function"&&q.setRangeText(T),q.selectionStart=q.selectionStart+T.length,q.selectionEnd=q.selectionEnd},on_hotkey_keydown:function(T){var q;if(T.metaKey||T.ctrlKey){switch(T.key){case"b":this.click_bold_text(T);break;case"i":this.click_italic_text(T);break;case"k":this.click_insert_link(T);break;case"Enter":typeof(q=this.props).on_submit_hotkey=="function"&&q.on_submit_hotkey();break;default:return}return T.preventDefault()}},render:function(){var T;return this.enclose({className:G({loading:this.state.loading})},wr({className:"markdown_toolbar"},m({},b({tabIndex:-1,type:"button",onClick:this.click_show_help,title:"Markdown Help"},i({}))),m({},b({tabIndex:-1,type:"button",onClick:this.click_bold_text,title:"Bold"},n({}))),m({},b({tabIndex:-1,type:"button",onClick:this.click_italic_text,title:"Italic"},e({}))),m({},b({tabIndex:-1,type:"button",title:"Insert link",onClick:this.click_insert_link},t({}))),m({},b({tabIndex:-1,type:"button",title:"Insert image",onClick:this.click_insert_image},r({}))),m({},b({tabIndex:-1,type:"button",title:"Insert video",onClick:this.click_insert_video},s({})))),this.state.loading&&this.state.loading_reason?g({className:"loading_reason"},this.state.loading_reason):void 0,vr({name:this.props.name,ref:this.input_ref||(this.input_ref=P.createRef()),defaultValue:this.get_default_value(),className:"markdown_textarea",onKeyDown:this.on_hotkey_keydown,placeholder:this.props.placeholder,required:this.props.required,disabled:this.state.loading||this.props.disabled,style:(T=this.state)!=null&&T.default_height?{height:this.state.default_height+"px"}:void 0,onChange:function(q){return function(U){var B,W;if(W=U.target.value,typeof(B=q.props).on_change=="function"&&B.on_change(W),q.props.remember_key)return q.set_memory||(q.set_memory=z.throttle(function(te){return E.store_memory(this.remember_key(),te)},500)),q.set_memory(W)}}(this)}))},get_default_value:function(){var T;if((T=this.props.value||this.props.defaultValue)||this.props.remember_key&&(T=typeof localStorage!="undefined"&&localStorage!==null?localStorage.getItem(this.remember_key()):void 0))return T},remember_key:function(){return"inputmemory:"+this.props.remember_key},clear_memory:function(){return E.clear_memory(this.remember_key())}}),D=F.path,N=F.line,O=F.rect,S=function(T){return P.createElement.bind(null,P.memo(T))},i=function(){return P.createElement("svg",{className:G("svgicon markdown_icon"),role:"img",version:"1.1",viewBox:"0 0 208 128",fill:"currentColor"},D({d:"M193 128H15a15 15 0 0 1-15-15V15A15 15 0 0 1 15 0h178a15 15 0 0 1 15 15v98a15 15 0 0 1-15 15zM50 98V59l20 25 20-25v39h20V30H90L70 55 50 30H30v68zm134-34h-20V30h-20v34h-20l30 35z"}))},i=S(i),y=function(){var T,q,U;return q=arguments[0],T=2<=arguments.length?qe.call(arguments,1):[],P.createElement.apply(P,["svg",{className:G("svgicon",q.className),role:"img",version:"1.1",viewBox:"0 0 24 24",width:"24",height:"24",fill:(U=q!=null?q.fill:void 0)!=null?U:"none",stroke:"currentColor",strokeWidth:"3",strokeLinejoin:"round","aria-hidden":!0}].concat(qe.call(T)))},n=function(){return y({className:"icon_format_bold"},D({d:"M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"}),D({d:"M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"}))},n=S(n),e=function(){return y({className:"icon_format_italic"},N({x1:"19",y1:"4",x2:"10",y2:"4"}),N({x1:"14",y1:"20",x2:"5",y2:"20"}),N({x1:"15",y1:"4",x2:"9",y2:"20"}))},e=S(e),t=function(){return y({className:"icon_insert_link"},D({d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}),D({d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"}))},t=S(t),r=function(){return y({className:"icon_insert_image"},O({x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),P.createElement("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),P.createElement("polyline",{points:"21 15 16 10 5 21"}))},r=S(r),s=function(){return y({className:"icon_insert_video"},D({d:"M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"}),P.createElement("polygon",{points:"9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"}))},s=S(s),o={youtube:/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube(?:\-nocookie)?\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.\-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/ig,vimeo:/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/,sketchfab_old:/https?:\/\/(?:www\.)?sketchfab\.com\/models\/([\w]+)($|\/)/,sketchfab:/https?:\/\/(?:www\.)?sketchfab\.com\/3d-models\/.*?-([^-]+)$/},a("MarkdownVideoEmbedLightbox",{pure:!0,getInitialState:function(){return{is_valid:!1}},componentDidMount:function(){return z.defer(function(T){return function(){var q;return(q=T.input_ref.current)!=null?q.focus():void 0}}(this))},generate_youtube_embed_code:function(T){return'<iframe width="560" height="315" src="https://www.youtube.com/embed/'+T+'" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>'},generate_vimeo_embed_code:function(T){return'<iframe src="https://player.vimeo.com/video/'+T+'" width="560" height="315" frameborder="0" allow="autoplay; fullscreen" allowfullscreen></iframe>'},generate_sketchfab_embed_code:function(T){return'<iframe width="560" height="315" src="https://sketchfab.com/models/'+T+'/embed" frameborder="0" allow="autoplay; fullscreen; vr" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe>'},parse_input_value:function(){var T,q,U,B,W,te,ee;if(te=$.trim(((U=this.input_ref.current)!=null?U.value:void 0)||""),te.match(/<iframe/i))return te;for(W in o)if(sn.call(o,W)&&(q=o[W],T=te.match(q),!!T))switch(W){case"youtube":if(ee=(B=T[0].match(/v=([^>"'&]+)/))||(B=T[0].match(/embed\/([^>"'&\/]+)/))?B[1]:void 0,ee)return this.generate_youtube_embed_code(ee);break;case"vimeo":if(ee=T[2])return this.generate_vimeo_embed_code(ee);break;case"sketchfab":case"sketchfab_old":if(ee=T[1])return this.generate_sketchfab_embed_code(ee);break;default:console.log(W,T)}},render:function(){return re({className:G(this.enclosing_class_name(),"compact"),ref:this.lightbox_ref||(this.lightbox_ref=P.createRef())},f({},"Embed Video"),u({className:"form",onSubmit:this.on_submit||(this.on_submit=function(T){return function(q){var U,B;if(q.preventDefault(),!!(T.state.is_valid&&T.state.embed_code))return typeof(U=T.props).on_submit=="function"&&U.on_submit(T.state.embed_code),(B=T.lightbox_ref.current)!=null?B.close():void 0}}(this))},g({className:"label"},"Youtube/Vimeo/Sketchfab URL or ",h({},"<iframe>")," embed code"),g({className:"input_split"},x({type:"text",required:"required",placeholder:"Please paste a valid URL or embed code",ref:this.input_ref||(this.input_ref=P.createRef()),onChange:this.on_change||function(T){return function(q){var U;return U=T.parse_input_value(),T.setState({embed_code:U,is_valid:!!U})}}(this)})," ",b({disabled:!this.state.is_valid,className:G("button",{disabled:!this.state.is_valid})},"Insert"))))}}),a("MarkdownHelpLightbox",{pure:!0,render:function(){var T;return T=function(){var q,U;return q=arguments[0],U=2<=arguments.length?qe.call(arguments,1):[],yr({},oe({className:"format_type"},q),oe.apply(null,[{className:"format_example"}].concat(qe.call(U))))},re({className:G(this.enclosing_class_name(),"compact")},f({},"Quick Markdown Guide"),C({},"Markdown is a writing format that converts into HTML."),g({className:"table_wrapper"},J({className:"nice_table"},K({},T("Bold","**Bolded text here**"),T("Italic","*Emphasized text here*"),T("Bullet list","* First item",d({}),"* Second item"),T("Link","[Linked text](http://example.com)"),T("Blockquote","> Quoted text here",d({}),"> Can span multiple lines"),T("Code","```",d({}),'print("Hello world")',d({}),"```"),T("Video embeds",w({},"Paste embed code directly"))))),C({},c({href:"https://commonmark.org/help/",target:"_blank"},"Extended tutorial \u2197"),". You can also use a subset of HTML directly for advanced formatting."))}})}),window.init_FormsMarkdownInput=function(n,e){M.render(n,()=>sr(e))};var be=[].slice,an=null;E.libs.react.done(function(){var n,e,r,t,s,i,a,o,l,c,d,b,h,y,g,w,u,f,k;return t=F,s=t.a,l=t.img,h=t.p,c=t.input,a=t.div,d=t.label,o=t.h3,i=t.button,u=t.ul,y=t.section,b=t.li,w=t.span,n=M.package("BlogPosts"),k=/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.\-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/ig,f=/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/,g=/https?:\/\/(?:www\.)?sketchfab\.com\/models\/([\w]+)($|\/)/,r=P.createElement("svg",{className:"svgicon icon_play",strokeLinecap:"round",stroke:"currentColor",role:"img",version:"1.1",viewBox:"0 0 24 24",strokeWidth:"2",width:"18",height:"18",strokeLinejoin:"round","aria-hidden":!0,fill:"none"},P.createElement("circle",{cx:"12",cy:"12",r:"10"}),P.createElement("polygon",{points:"10 8 16 12 10 16 10 8"})),e=P.createElement("svg",{className:"svgicon icon_package",strokeLinecap:"round",stroke:"currentColor",role:"img",version:"1.1",viewBox:"0 0 24 24",strokeWidth:"2",width:"18",height:"18",strokeLinejoin:"round","aria-hidden":!0,fill:"none"},P.createElement("path",{d:"M12.89 1.45l8 4A2 2 0 0 1 22 7.24v9.53a2 2 0 0 1-1.11 1.79l-8 4a2 2 0 0 1-1.79 0l-8-4a2 2 0 0 1-1.1-1.8V7.24a2 2 0 0 1 1.11-1.79l8-4a2 2 0 0 1 1.78 0z"}),P.createElement("polyline",{points:"2.32 6.16 12 11 21.68 6.16"}),P.createElement("line",{x1:"12",y1:"22.76",x2:"12",y2:"11"}),P.createElement("line",{x1:"7",y1:"3.5",x2:"17",y2:"8.5"})),an=n("AttachmentEditor",{propTypes:{available_attachments:j.array,selected_attachments:j.array,object:j.object},getInitialState:function(){return{visible_type:"files",selected_attachments:this.props.selected_attachments,available_attachments:this.props.available_attachments,active_uploads:[]}},split_attachments:function(p){var x,v,m,N,S;for(p==null&&(p=this.state.selected_attachments),S=[],v=[],m=0,N=p.length;m<N;m++)switch(x=p[m],x.type){case"image":v.push(x);break;default:S.push(x)}return[S,v]},sort_attachments:function(p){var x,v,m;return p==null&&(p=this.state.selected_attachments),m=this.split_attachments(p),v=m[0],x=m[1],v.concat(x)},componentDidMount:function(){return this.dispatch({append_video:function(p){return function(){var x,v,m;if(m=$.trim(p.refs.video_url.value),m!==""){if(v=z.any([k,f,g],function(N){return m.match(N)}),!v){p.setState({video_error:"That URL is not recognized"});return}if(x=z.any(p.state.selected_attachments,function(N){return N.type==="video"&&N.url===m}),x){p.setState({video_error:"That video has already been added"});return}return p.refs.video_url.value="",p.setState({video_error:null,selected_attachments:p.sort_attachments(p.state.selected_attachments.concat([{type:"video",url:m}]))})}}}(this),pick_images:function(p){return function(){var x,v;return p.setState({upload_errors:[]}),v={},x=function(m){if(m.errors){p.push_errors(m.errors);return}if(!v[m.upload.id])return v[m.upload.id]=!0,{type:"image",upload:m.upload,id:m.upload.id,image_url:m.upload.thumb_url,medium_image_url:m.upload.thumb_url}},E.upload_image({url:p.props.upload_image_url,max_size:p.props.max_upload_size,multiple:!0,test_file:function(m,N){return $.when(E.test_image_dimensions(m),E.test_image_format(m)).done(function(){return N.resolve()}).fail(function(S){return N.reject(S)})},on_start_upload:function(m,N,S){var C;return C={file:m,upload:N,xhr:S,progress:0},p.setState(function(D){return{active_uploads:D.active_uploads.concat([C]),uploading:!0}}),S.progress(function(D,L,O){var A;return A=Object.assign({},C,{progress:L/O}),p.setState(function(H){return{active_uploads:H.active_uploads.map(function(J){return function(K){return K===C?A:K}}(this))}}),C=A}).done(function(D){var L;if(L=x(D))return p.setState(function(O){return{selected_attachments:p.sort_attachments(O.selected_attachments.concat([L]))}})}).always(function(){return p.setState(function(D){var L;return L=D.active_uploads.filter(function(O){return function(A){return A!==C}}(this)),{uploading:!!L.length,active_uploads:L}})})}}).fail(function(m){return p.push_errors(m)})}}(this)})},push_errors:function(p){var x,v,m,N;return typeof p=="string"&&(p=[p]),v=function(){var S,C,D;for(D=[],S=0,C=p.length;S<C;S++)if(x=p[S],typeof x=="string")D.push(x);else if(Array.isArray(x))N=x[0],m=x[1],m?D.push(m.name+" - "+N):D.push(N);else continue;return D}(),this.setState(function(S){return{upload_errors:(S.upload_errors||[]).concat(v)}})},render:function(){var p;return this.enclose({className:"attachment_picker input_row"},a({className:"label"},"Attachments"),(p=this.props.object)?h({className:"attach_summary"},"You can attach things uploaded to ",s({href:p.url,target:"_blank"},p.title)," to this devlog post.",this.props.add_recently_changed?" We've automatically attached some things updated recently.":void 0):void 0,a({className:"attachments_wrapper"},o({},"Selected Attachments"),this.render_selected_attachments(),o({},"Add Attachment"),this.render_attachment_picker()))},render_image_uploader:function(){var p,x;return a({className:"image_uploader"},o({},"Upload a new image for this post"),(x=this.state.upload_errors)!=null&&x.length?M.Forms.FormErrors({errors:this.state.upload_errors}):void 0,h({},"Note: this image will not be added to your project's screenshots, it will only be available for this post. If you'd like to add new screenshots add them to your project first, then you can pick them here."),i({type:"button",className:G("button",{disabled:!!this.state.uploading}),disabled:!!this.state.uploading,onClick:function(v){return function(m){return m.preventDefault(),v.trigger("pick_images")}}(this)},this.state.uploading?this.state.active_uploads.length?(p=Math.min.apply(Math,this.state.active_uploads.map(function(v){return function(m){return m.progress}}(this))),"Uploading "+((p||0)*100).toFixed(2)+"%"):"Uploading...":"Select images"))},render_selected_object:function(p,x,v){var m,N,S,C;if(N=x===0,S=x===v.length-1,C=this.state.selected_attachments.indexOf(p),C<0)throw"object is not selected";return m=function(D){return"attachment["+(C+1)+"]["+D+"]"},this.render_object(p,[N?void 0:s({key:"moveup",className:"move_button",href:"#",onClick:function(D){return function(L){return L.preventDefault(),D.setState({selected_attachments:E.move(D.state.selected_attachments,p,-1)})}}(this)},p.type==="image"?"left":"up"),S?void 0:s({key:"movedown",className:"move_button",href:"#",onClick:function(D){return function(L){return L.preventDefault(),D.setState({selected_attachments:E.move(D.state.selected_attachments,p,1)})}}(this)},p.type==="image"?"right":"down"),i({key:"remove",type:"button",className:"button small outline remove_button",onClick:function(D){return function(L){var O;return L.preventDefault(),D.setState({available_attachments:[p].concat(be.call(D.state.available_attachments)),selected_attachments:function(){var A,H,J,K;for(J=this.state.selected_attachments,K=[],A=0,H=J.length;A<H;A++)O=J[A],O!==p&&K.push(O);return K}.call(D)})}}(this)},"Remove"),p.attachment_id!=null?c({type:"hidden",name:m("attachment_id"),value:p.attachment_id,key:"oai"}):void 0,p.type==="video"?[c({type:"hidden",name:m("url"),value:p.url,key:"vurl"}),c({type:"hidden",name:m("type"),value:"video_link",key:"ot"}),p.id!=null?c({type:"hidden",name:m("id"),value:p.id,key:"oi"}):void 0]:[c({type:"hidden",name:m("object_type"),value:p.type,key:"ot"}),c({type:"hidden",name:m("object_id"),value:p.id,key:"oi"})]])},render_selected_attachments:function(){var p,x,v,m,N,S;return N=this.state.selected_attachments.length?void 0:h({className:"no_attachments_message"},"Nothing is attached. Add something from below to include it with your post (optional)"),S=this.split_attachments(),v=S[0],x=S[1],m=v.length?u({className:"listed_attachments",children:v.map(function(C){return function(D,L){return C.render_selected_object(D,L,v)}}(this))}):void 0,p=x.length?u({className:"image_attachments",children:x.map(function(C){return function(D,L){return C.render_selected_object(D,L,x)}}(this))}):void 0,a({className:"selected_attachments"},N,m,p)},render_attachment_picker:function(){var p,x;return x=this.state.visible_type,p=function(){switch(x){case"upload_image":return this.render_image_uploader();case"video":return this.render_video_attach();default:return this.render_available_attachments()}}.call(this),a({className:"object_picker tab_columns"},a({className:"type_filter tab_column"},i({type:"button",className:G("tab_btn",{selected:x==="files"}),onClick:function(v){return function(m){return v.setState({visible_type:"files"}),m.preventDefault()}}(this)},"Files"),i({type:"button",className:G("tab_btn",{selected:x==="images"}),onClick:function(v){return function(m){return v.setState({visible_type:"images"}),m.preventDefault()}}(this)},"Images"),i({type:"button",className:G("tab_btn",{selected:x==="upload_image"}),onClick:function(v){return function(m){return m.preventDefault(),v.setState({visible_type:"upload_image"})}}(this)},"Upload image"),i({type:"button",className:G("tab_btn",{selected:x==="video"}),onClick:function(v){return function(m){return v.setState({visible_type:"video"}),m.preventDefault()}}(this)},"Video")),a({className:"content_column type_"+x},p))},render_video_attach:function(){return a({className:"video_attach"},o({},"Add a video"),h({},"Provide the link to a video on YouTube, Vimeo, or Sketchfab attach it to the post"),this.state.video_error?h({className:"error_message"},this.state.video_error):void 0,y({className:"video_link_input"},c({type:"text",placeholder:"eg. https://www.youtube.com/watch?v=5JEaA47sPjQ",ref:"video_url",onKeyDown:function(p){return function(x){if(x.keyCode===13)return x.preventDefault(),x.stopPropagation(),p.trigger("append_video")}}(this)}),i({type:"button",className:"button",onClick:function(p){return function(x){return x.preventDefault(),p.trigger("append_video")}}(this)},"Add video")))},render_available_attachments:function(){var p,x,v,m,N,S,C;return p=this.available_attachments_by_type(this.state.visible_type),p.length?(S=this.split_attachments(p),m=S[0],v=S[1],C=function(D){return function(L){return i({type:"button",className:"button small",onClick:function(O){var A;return O.preventDefault(),D.setState({available_attachments:function(){var H,J,K,oe;for(K=this.state.available_attachments,oe=[],H=0,J=K.length;H<J;H++)A=K[H],A!==L&&oe.push(A);return oe}.call(D),selected_attachments:D.sort_attachments(be.call(D.state.selected_attachments).concat([L]))})}},"Attach")}}(this),N=m.length?u({className:"listed_attachments",children:m.map(function(D){return function(L){return D.render_object(L,C(L))}}(this))}):void 0,x=v.length?u({className:"image_attachments",children:v.map(function(D){return function(L){return D.render_object(L,C(L))}}(this))}):void 0,P.createElement(P.Fragment,{},N,x)):a({className:"empty_message"},"Nothing is available")},available_attachments_by_type:function(p){var x,v,m,N,S;for(N=this.state.available_attachments,S=[],v=0,m=N.length;v<m;v++){switch(x=N[v],p){case"files":if(!(x.type==="upload"||x.type==="build"))continue;break;case"images":if(x.type!=="image")continue}S.push(x)}return S},render_object:function(){var p,x,v;switch(v=arguments[0],p=2<=arguments.length?be.call(arguments,1):[],x=v.type+"-"+(v.id||v.attachment_id||v.url),v.type){case"video":return b.apply(null,[{key:x,className:"file_attachment video_attachment"},w({className:"attachment_title"},r,s({target:"_blank",rel:"noopener",className:"video_url",href:v.url},v.url))].concat(be.call(p)));case"upload":case"build":return b.apply(null,[{key:x,className:"file_attachment"},w({className:"attachment_title"},e,w({className:"object_title"},v.name)," ",v.sub_name?w({className:"title_tag"},v.sub_name):void 0),w({className:"attachment_date"},Ne(v.created_at))].concat(be.call(p)));case"image":return b({key:x,style:{backgroundImage:"url("+v.medium_image_url+")"},className:"image_preview"},a({className:"hover_overlay"},a.apply(null,[{className:"image_actions"}].concat(be.call(p)))))}}})}),window.init_DashboardEditBlogPostForm=function(n,e){new I.EditBlogPostForm(n,e)},window.init_DashboardHeader=function(n,e){new I.FilterPickers(n)},window.init_GameInteractBase=function(n,e){new I.GameInteract(n,e)},window.init_IndigenousApplicationSummary=function(n,e){};var lt,on=function(n,e){for(var r in e)un.call(e,r)&&(n[r]=e[r]);function t(){this.constructor=n}return t.prototype=e.prototype,n.prototype=new t,n.__super__=e.prototype,n},un={}.hasOwnProperty;lt=function(n){on(e,n);function e(){return e.__super__.constructor.apply(this,arguments)}return e.prototype.init=function(r,t){var s,i;return this.el.find(".recipient").text(t).end(),s=this.el.find(".admin_url"),s.on("click",function(){return s.select()}),i=_.template(s.data("url_template"))({user_id:r}),s.val(i)},e}(me);var Tn=I.AdminsForm=function(){function n(e,r){var t,s;this.opts=r!=null?r:{},this.el=V(e).remote_link(function(i){return function(a){if(a.removed)return a.is_self?window.location="/dashboard":window.location.reload()}}(this)),this.el.dispatch("click",{show_url_btn:function(i){return function(a){var o;return o=a.closest("tr"),me.open_tpl("admin_accept_lightbox",lt,o.data("user_id"),o.data("user_name"))}}(this)}),this.el.find(".field_toggle_input").on("change",function(i){return function(a){var o,l,c;if(o=V(a.target),l=o.closest(".field_toggle"),!l.is(".disabled"))return l.addClass("disabled"),o.prop("disabled",!0),c=o.closest("tr"),V.post("",I.with_csrf({json:!0,action:"toggle_field",username:c.data("user_slug"),field:o.data("field"),enabled:""+o.prop("checked")}),function(d){return o.prop("disabled",!1),o.prop("checked",d[o.data("field")]),l.removeClass("disabled")})}}(this)),(s=window.location.search.match(/\bnew_admin=(\d+)/))&&this.el.find("[data-user_id="+s[1]+"] .show_url_btn").click(),this.opts.async_add&&(t=this.el.find("form").remote_submit(function(i){return function(a){if(a.errors){t.set_form_errors(a.errors);return}return me.open_tpl("admin_accept_lightbox",lt,a.user_id,a.user_name)}}(this)))}return n}(),ln,cn=function(n,e){return function(){return n.apply(e,arguments)}};ln=function(){function n(){this.init=cn(this.init,this)}return n.prototype.init=function(){},n}(),I.DashboardGameClaimedRewards=function(){function n(e,r){this.el=$(e),this.el.has_tooltips(),new I.FilterPickers(this.el.find(".rewards_pagination_header")),this.el.dispatch("click",{purchase_info_btn:function(t){return function(s,i){return I.is_middle_click(i)?"continue":I.Lightbox.open_remote(s.attr("href"),nt)}}(this),reward_responses_btn:function(t){return function(s,i){return I.is_middle_click(i)?"continue":I.Lightbox.open_remote(s.attr("href"),I.RewardResponsesLightbox)}}(this)}),this.el.on("click",".fullfilled_toggle",function(t){return function(s){var i,a,o;if(o=s.target.checked,a=o?"Mark as fulfilled?":"Mark as unfulfilled?",!confirm(a)){s.preventDefault();return}return i=$(s.target).closest("form"),I.remote_submit(i)}}(this))}return n}(),I.DashboardGameClassification=function(){function n(e,r){this.opts=r,I.event2("game classification"),this.el=$(e),I.setup_selectize(this.el),this.setup_sliders(),this.setup_mp(),this.form=this.el.find("form").remote_submit(function(t){return function(s,i){if(s.errors){i.set_form_errors(s.errors);return}return i.set_form_errors([]),I.flash("Changes saved")}}(this)),I.setup_dirty_warning(this.form),this.setup_nsfw()}return n.prototype.setup_nsfw=function(){var e,r,t,s,i;return t=this.form.find("input[name='data[nsfw]']"),s=t.closest("li"),this.opts.admin_nsfw&&s.addClass("disabled"),e=this.form.find("input[name='data[content_warning]']"),r=e.closest("li"),i=function(a){return function(){return t.prop("checked")||a.opts.admin_nsfw?r.removeClass("disabled"):(e.prop("checked",!1),r.addClass("disabled"))}}(this),t.on("change",i),i()},n.prototype.setup_sliders=function(){var e,r,t,s,i,a,o,l;return e=this.el.find(".players_slider_input"),r=this.el.find(".players_slider_row .sub"),a=this.el.find(".min_players_value"),s=this.el.find(".max_players_value"),i=parseInt(a.val(),10),t=parseInt(s.val(),10),o=function(c){return function(d){return r.text(" \u2014 "+d)}}(this),l=function(c){return function(d){return a.val(d[0]),s.val(d[1]),d[0]===d[1]?d[0]===1?o(" This is a single-player game"):o(" Exactly "+d[0]+" players can play on the same device"):o(" Between "+d[0]+" and "+d[1]+" players can play on the same device")}}(this),this.el.find(".players_slider").slider({range:!0,min:1,max:16,values:[i,t],slide:function(c){return function(d,b){return l(b.values)}}(this)}),l([i,t])},n.prototype.setup_mp=function(){var e,r;return e=this.el.find("input[name='data[multiplayer_features]']"),r=function(t){return function(s){var i,a;return a=e.val().split(","),i=a.indexOf("local")>=0,t.el.toggleClass("with_local_multiplayer",i)}}(this),e.on("change",r),r()},n}(),I.DashboardGameConversionType=function(){function n(e,r){this.el=$(e),new Pe("#conversion_graph",r.counts,{label:r.label,secondary_field:"source",x_ticks:7,range_left:r.stat_left,range_right:r.stat_right,popup_group:function(t){return r.groups[t.source]||""}})}return n}();var pn=function(n,e){for(var r in e)dn.call(e,r)&&(n[r]=e[r]);function t(){this.constructor=n}return t.prototype=e.prototype,n.prototype=new t,n.__super__=e.prototype,n},dn={}.hasOwnProperty;I.DashboardGameConversions=function(){function n(e,r){var t;this.el=$(e),t=function(s){pn(i,s);function i(){return i.__super__.constructor.apply(this,arguments)}return i.prototype.default_opts={range_left:r.stat_left,range_right:r.stat_right,x_ticks:7,min_y:10},i}(Te),r.counts.impression&&new t("#impressions_graph",r.counts.impression,{label:"Impressions"}),r.counts.click&&new t("#clicks_graph",r.counts.click,{label:"Clicks",min_y:3}),r.counts.download&&new t("#downloads_graph",r.counts.download,{label:"Downloads",min_y:3}),r.counts.purchase&&new t("#purchases_graph",r.counts.purchase,{label:"Purchases",min_y:3})}return n}();var fn=[].slice,ar=null;E.libs.react.done(function(){var n,e,r,t,s,i,a,o;return e=F,a=e.label,o=e.span,s=e.div,t=e.button,i=e.input,r=e.a,n=M.package("Forms"),ar=n("FileUploader",{propTypes:{label:j.string,upload:j.shape({id:j.number,url:j.string}),upload_func:j.func},getInitialState:function(){return{upload:this.props.upload}},componentDidMount:function(){return this.dispatch({delete_upload:function(l){return function(c){return l.setState({loading:!0}),$.ajax({url:l.state.upload.url,type:"post",data:E.with_csrf({action:"delete",upload_id:l.state.upload.id})}).done(function(d){if(d.errors){alert(d.errors.join());return}return l.setState({loading:!1,upload:null})})}}(this),pick_file:function(l){return function(c){if(!(l.state.uploading||l.state.loading))return(l.props.upload_func||E.upload_file)({url:l.props.upload_url,on_start_upload:function(){if(!l.state.uploading)return l.setState({uploading:!0})}}).progress(function(d,b,h){if(console.warn.apply(console,arguments),d==="progress")return l.setState({progress:b/h})}).fail(function(){return l.setState({uploading:!1}),console.error.apply(console,["upload failed"].concat(fn.call(arguments)))}).done(function(d){return l.setState({uploading:!1,upload:d.upload})})}}(this)})},render_preview_upload:function(){return this.props.render_preview_upload?this.props.render_preview_upload():o({className:"upload_filename"},this.state.upload.filename)},render:function(){var l,c;return c=this.state.uploading?"Uploading"+(this.state.progress&&" ("+Math.floor(this.state.progress*100)+"%)"||""):this.state.loading?"Loading...":this.props.label?this.props.label:this.state.upload?"Replace upload":"Upload",l=this.state.uploading||this.state.loading,s({className:"file_uploader"},t({className:G("button",{disabled:l}),disabled:l,onClick:function(d){return function(b){return b.preventDefault(),d.trigger("pick_file")}}(this)},c)," ",this.state.upload?i({type:"hidden",name:this.props.name,value:this.state.upload.id}):void 0,this.state.upload&&!this.state.loading?r({href:"#",onClick:function(d){return function(b){return b.preventDefault(),d.trigger("delete_upload")}}(this)},"Remove upload"):void 0,this.state.upload?this.render_preview_upload():void 0)}})}),I.DashboardInvoicesNew=function(){function n(e,r){this.el=$(e),Qe($(".start_date, .end_date")),ReactDOM.render(ar({label:"Upload invoice",upload_url:r.upload_url,name:"invoice[upload_id]"}),this.el.find(".upload_drop")[0]),I.money_input(this.el.find(".amount_input"))}return n}();var hn=function(n,e){return function(){return n.apply(e,arguments)}};I.DashboardJamEditJamForm=function(){n.prototype.date_format="yy-mm-dd",n.prototype.time_format="HH:mm:ss";function n(e,r){var t,s;this.jam=r,this.setup_date_pickers=hn(this.setup_date_pickers,this),this.el=$(e),t=this.el.find(".content_input"),(s=this.jam)!=null&&s.html_enabled?CodeMirror.fromTextArea(t[0],{mode:"htmlmixed",lineNumbers:!0,tabSize:2}):ie(t),ie(this.el.find(".submission_details_input"),{minHeight:80,buttons:["bold","italic","underline","deleted","unorderedlist","orderedlist","link"]}),this.setup_date_pickers(),this.setup_timezone(),this.setup_type_picker(),this.el.dispatch("click",{delete_jam_btn:function(i){return function(a){if(confirm("Are you sure you want to delete this jam? This can't be undone."))return a.addClass("disabled"),$.ajax({type:"post",data:I.with_csrf(),url:a.data("url"),success:function(o){return window.location=o.redirect_to||"/"}})}}(this)}),this.form=this.el.find("form").remote_submit(function(i){return function(a){var o,l,c,d;if(i.render_errors(a.errors||[]),!a.errors)return i.jam||i.set_jam(a.jam),(d=((o=a.jam)!=null?o.url:void 0)||i.redirect_on_save)?window.location=d:I.flash("Jam saved"),(l=R.JamEdit.EditFields.edit_jam_fields)!=null&&l.set_fields(a.fields||[]),(c=R.JamEdit.EditCriteria.edit_jam_criteria)!=null?c.set_criteria(a.criteria||[]):void 0}}(this)),I.slug_input(this.el.find(".slug_input"),this.el.find(".title_input")),I.setup_dirty_warning(this.form)}return n.prototype.save_jam=function(e){return this.el.find("form").trigger("submit",[e])},n.prototype.render_errors=function(e){return this.form.set_form_errors(e,!0,"There was a problem with your submission")},n.prototype.setup_date_pickers=function(){var e,r,t,s;return t=this.el.find(".date_picker.start_date"),r=this.el.find(".date_picker.end_date"),s=this.el.find(".date_picker.voting_end_date"),e=this.el.find(".date_picker"),Ie(e,{onSelect:function(i){}})},n.prototype.setup_timezone=function(){var e;return e=jstz.determine().name(),this.el.find(".timezone_input").val(e),this.el.find(".timezone_label").text(e)},n.prototype.setup_type_picker=function(){return this.el.track_input("[name='jam[type]']","type"),this.el.track_input("[name='jam[rate_queue_type]']","rate_queue_type")},n.prototype.set_jam=function(e){var r,t;return(t=e!=null?e.edit_url:void 0)&&typeof(r=window.history).replaceState=="function"&&r.replaceState({},"Edit jam",t),this.jam=e},n.prototype.with_jam=function(e,r){return this.jam?typeof e=="function"?e(this.jam):void 0:this.save_jam(function(t){return function(s){if(s.errors){t.render_errors(s.errors),alert("Please fix the errors before uploading an image"),typeof r=="function"&&r();return}return t.set_jam(s.jam),t.form.attr("action",t.jam.edit_url),t.redirect_on_save=t.jam.url,typeof e=="function"?e():void 0}}(this))},n}(),I.DashboardJamEntryDownloads=function(){function n(e){this.el=$(e),this.setup_downloads()}return n.prototype.setup_downloads=function(){return this.el.dispatch("click",{upload_download_btn:function(e){return function(r){return $.ajax({url:r.data("href"),type:"post",data:I.with_csrf(),success:function(t){var s;if(t.errors){s=t.errors.join(", "),alert(s);return}return window.location=t.url}})}}(this)})},n}();var _n=function(n,e){return function(){return n.apply(e,arguments)}},mn=function(n,e){for(var r in e)gn.call(e,r)&&(n[r]=e[r]);function t(){this.constructor=n}return t.prototype=e.prototype,n.prototype=new t,n.__super__=e.prototype,n},gn={}.hasOwnProperty;I.DashboardJamParticipants=function(){function n(e,r){var t;r==null&&(r={}),this.el=$(e),new I.FilterPickers(e),r.participants_graph&&(t=function(s){mn(i,s);function i(){return this.get_y=_n(this.get_y,this),i.__super__.constructor.apply(this,arguments)}return i.prototype.get_y=function(a){return a.sum},i.prototype.format_data=Je.prototype.format_data,i}(Te),new t("#participants_graph",r.participants_graph,{label:"Cumulative participants",range_left:r.graph_left,range_right:r.graph_right,x_ticks:7,min_y:10}))}return n}(),I.DashboardPayout=function(){function n(e){this.el=$(e),this.el.has_tooltips()}return n}();var bn=function(n,e){for(var r in e)vn.call(e,r)&&(n[r]=e[r]);function t(){this.constructor=n}return t.prototype=e.prototype,n.prototype=new t,n.__super__=e.prototype,n},vn={}.hasOwnProperty;I.BankAccountLightbox=function(n){bn(e,n);function e(){return e.__super__.constructor.apply(this,arguments)}return e.prototype.init=function(){var r,t,s;return r=this.el.find("form"),t=this.el.find(".type_picker"),s=function(i){return function(){var a,o,l,c,d,b;for(l=["individual","business"],c=[],a=0,o=l.length;a<o;a++)b=l[a],d=t.val()===b,i.el.toggleClass("is_"+b,d),c.push(i.el.find(".for_"+b+" input").prop("disabled",!d));return c}}(this),s(),t.on("change",s),r.remote_submit(function(i){return function(a){if(a.errors){r.set_form_errors(a.errors);return}return window.location.reload()}}(this),function(i){return function(){var a,o,l;return a=r.find(".account_number_input").val(),l=r.find(".routing_number_input").val(),o=[],Stripe.bankAccount.validateRoutingNumber(l,"US")||o.push("Invalid routing number"),Stripe.bankAccount.validateAccountNumber(a,"US")||o.push("Invalid account number"),o.length?(r.set_form_errors(o),!1):!0}}(this))},e}(I.Lightbox),I.DashboardPayouts=function(){function n(e,r){this.opts=r,this.el=$(e),this.el.find(".initiate_payout_form").remote_submit(function(t){return function(s){if(s.success&&(s.redirect_to?window.location=s.redirect_to:window.location.reload()),s.errors)return t.el.find("#error_drop").text(s.errors[0])}}(this)),this.el.has_tooltips(),this.el.dispatch("click",{bank_btn:function(t){return function(s){return I.Lightbox.open_tpl("bank_account_lightbox",I.BankAccountLightbox)}}(this)})}return n}(),I.DashboardPurchaseList=function(){function n(e){this.el=$(e),this.el.dispatch("click",{purchase_info_btn:function(r){return function(t){return I.Lightbox.open_remote(t.attr("href"),nt)}}(this)})}return n}();var or,ur,Ce=function(n,e){return function(){return n.apply(e,arguments)}},lr=function(n,e){for(var r in e)yn.call(e,r)&&(n[r]=e[r]);function t(){this.constructor=n}return t.prototype=e.prototype,n.prototype=new t,n.__super__=e.prototype,n},yn={}.hasOwnProperty;I.DashboardPurchases=function(){function n(e,r){var t,s,i;if(this.el=$(e),this.el.has_tooltips(),r.purchases_graph&&$("#purchases_graph").length&&new ur("#purchases_graph",r.purchases_graph,{label:"Payments",min_y:3,unit:r.unit,left:r.graph_left,right:r.graph_right}),r.earnings_graph){i=r.earnings_graph;for(t in i)s=i[t],e="#earnings_graph_"+t,$(e).length&&new or(e,s,{label:t+" gross revenue",min_y:3,currency:t,unit:r.unit,left:r.graph_left,right:r.graph_right})}}return n}(),ur=function(n){lr(e,n);function e(){return this.get_range=Ce(this.get_range,this),e.__super__.constructor.apply(this,arguments)}return e.prototype.default_opts={num_days:30,x_ticks:7,min_y:10,unit:"daily"},e.prototype.get_range=function(){var r;return r=d3.time.format("%Y-%m-%d"),[r.parse(this.opts.left),r.parse(this.opts.right)]},e.prototype.increment_date=function(r){return this.opts.unit==="monthly"?d3.time.month.offset(r,1):d3.time.day.offset(r,1)},e}(Te),or=function(n){lr(e,n);function e(){return this.get_range=Ce(this.get_range,this),this.format_data=Ce(this.format_data,this),this.popup_date=Ce(this.popup_date,this),this.get_y=Ce(this.get_y,this),e.__super__.constructor.apply(this,arguments)}return e.prototype.default_opts={label:"Amount",min_y:100,x_ticks:8},e.prototype.get_y=function(r){return r.sum},e.prototype.popup_date=function(r){var t;return t=d3.time.format("%Y-%m-%d"),d3.time.format("%B %Y")(t.parse(r.date)),r.date},e.prototype.format_data=function(){var r,t,s,i,a;for(r={},i=this.data,t=0,s=i.length;t<s;t++)a=i[t],r[a.date]=a;return this.map_range(function(o){return function(l){var c,d;return c=o.time_format(l),{sum:((d=r[c])!=null?d.sum:void 0)||0,date:c}}}(this))},e.prototype.get_range=function(){var r;return r=d3.time.format("%Y-%m-%d"),[r.parse(this.opts.left),r.parse(this.opts.right)]},e.prototype.increment_date=function(r){return this.opts.unit==="monthly"?d3.time.month.offset(r,1):d3.time.day.offset(r,1)},e}(Sr),I.DashboardToolGames=function(){function n(e,r){this.el=$(e),new I.FilterPickers(this.el),this.el.dispatch("click",{edit_tags_btn:function(t){return function(s){return Y(R.Dashboard.ToolGameTagsLightbox({game:s.data("game"),tool:r.tool,url:s.data("href"),selected_tags:_.toArray(s.data("tags")),on_save:function(i){return s.data("tags",i.selected_tags),I.Lightbox.close()}}))}}(this)})}return n}();var Ue=function(n,e){return function(){return n.apply(e,arguments)}};I.EditBlogPost=function(){function n(e){$(e).dispatch("click",{convert_to_devlog_btn:function(r){return function(t){return I.Lightbox.open_remote_react(t.data("href"),R.Dashboard.ConvertPostToDevlogLightbox)}}(this)})}return n}(),I.EditBlogPostForm=function(){function n(e,r){var t;this.opts=r,this.setup_date_pickers=Ue(this.setup_date_pickers,this),this.setup_tags=Ue(this.setup_tags,this),this.setup_languages=Ue(this.setup_languages,this),this.refresh_logform=Ue(this.refresh_logform,this),this.el=$(e),this.setup_tags(),this.setup_languages(),this.setup_date_pickers(),this.el.dispatch("click",{delete_post_btn:function(s){return function(i){if(confirm("Are you sure you want to delete this post?"))return i.addClass("disabled").prop("disabled",!0),$.post(i.data("url"),I.with_csrf()).then(function(a){if(console.log(a),a.errors){t.set_form_errors(a.errors);return}a.redirect_to&&(window.location=a.redirect_to)})}}(this)}),t=this.el.find("form").remote_submit(function(s){return function(i){var a;if(i.errors){t.set_form_errors(i.errors);return}if(i.edit_url&&typeof(a=window.history).replaceState=="function"&&a.replaceState({},"Edit blog post",i.edit_url),i.redirect_to){window.location=i.redirect_to;return}return I.flash("Saved post")}}(this)),this.el.find("input[name='post[user_classification]']").on("change",function(s){return function(i){return s.refresh_logform()}}(this)),this.refresh_logform()}return n.prototype.refresh_logform=function(){var e,r,t;return r=this.el.find("input[name='post[user_classification]']:checked"),t=r.val(),e=t&&t!=="general_update"&&t!=="major_update"&&t!=="announcement"||!1,this.el.find(".longform_notification").toggle(e)},n.prototype.setup_languages=function(){return I.setup_selectize(this.el.find(".language_row"))},n.prototype.setup_tags=function(){var e,r,t;return r=_.toArray(this.opts.suggested_tags),t=this.el.find(".tags_input"),e=_.toArray(t.data("json_value")),this.tag_input=t.selectize({delimiter:",",plugins:["remove_button"],persist:!1,placeholder:t.attr("placeholder"),valueField:"name",labelField:"name",searchField:["name"],closeAfterSelect:!0,options:r.concat(e).map(function(s){return{name:s}}),create:function(s){return{name:$.trim(s)}}})},n.prototype.setup_date_pickers=function(){return Qe(this.el.find(".date_picker"))},n}(),I.EmailEditForm=function(){function n(e,r){var t,s;this.opts=r,this.el=$(e),s=_.debounce(function(i){return function(){return i.update_preview()}}(this),100),this.setup_recipients(),this.subject_input=this.el.find(".subject_input").on("change, keyup",s),this.body_input=ie(this.el.find(".body_input"),{changeCallback:s}),this.el.on("change",".show_download_input",function(i){return function(a){return i.update_preview()}}(this)),this.el.find(".send_btn").on("click",function(i){return function(){if(!confirm("Are you sure you want to send this email? It will be delivered right away."))return!1}}(this)),t=this.el.find("form").remote_submit(function(i){return function(a){if(a.errors)return t.set_form_errors(a.errors);if(a.redirect_to)return window.location=a.redirect_to}}(this)),_.defer(function(i){return function(){return i.update_preview()}}(this))}return n.prototype.setup_recipients=function(){var e;return e=this.el.find(".recipients"),e.selectize({valueField:"id",persist:!1,delimiter:",",options:_.toArray(this.opts.recipients),render:{item:function(r){return function(t,s){return"<div>"+s(t.name)+"</div>"}}(this),option:function(r){return function(t,s){var i,a;return i=s(t.name)+" ("+I.number_format(t.count)+")",a=function(){switch(t.type){case"download_key_group":return"<strong>[Group]</strong> ";case"reward":return"<strong>[Reward]</strong> ";default:return""}}(),"<div>"+a+s(i)+"</div>"}}(this)}})},n.prototype.update_preview=function(){var e,r,t;return this.show_link_input||(this.show_link_input=this.el.find(".show_download_input")),this.preview_el||(this.preview_el=this.el.find(".email_preview")),this.preview_subject||(this.preview_subject=this.preview_el.find(".preview_subject")),this.preview_body||(this.preview_body=this.preview_el.find(".body_drop")),this.show_link_input.length&&this.preview_el.toggleClass("show_download_link",this.show_link_input.prop("checked")),t=this.subject_input.val(),e=this.body_input.val(),r=_.template(this.preview_subject.data("template"))({object_title:this.opts.object_title,subject:t}),this.preview_subject.html(r),this.preview_body.html(e)},n}();var cr=I.PurchaseList=function(){function n(e){this.el=$(e),this.el.on("click",".email_cell",function(r){return $(r.currentTarget).closest(".purchase_list_table").addClass("show_emails")})}return n}(),Pn=I.GameSummary=function(){function n(e){this.el=$(e),this.setup_purchases()}return n.prototype.setup_purchases=function(){return new cr(this.el),this.el.find(".purchases_table.remote_table").remote_table()},n}(),wn=function(n,e){return function(){return n.apply(e,arguments)}};I.ExportPurchases=function(){n.prototype.date_format="yy-mm-dd",n.prototype.time_format="HH:mm:ss";function n(e){this.setup_range_form=wn(this.setup_range_form,this),this.el=$(e),this.setup_range_form(),new cr(this.el)}return n.prototype.setup_range_form=function(){var e,r,t,s,i;if(t=this.el.find(".range_form_outer"),r=t.find(".range_form"),!!r.length)return r.find(".timezone_input").val(jstz.determine().name()),s=this.el.find(".date_picker.start_date"),e=this.el.find(".date_picker.end_date"),i=function(a,o){var l;if(o==null&&(o=!0),o&&a.is(".start_date"))return l=a.datetimepicker("getDate"),e.datetimepicker("option","minDate",new Date(+l))},r.find(".date_picker").datetimepicker({timeFormat:this.time_format,dateFormat:this.date_format,onSelect:function(a){return i($(this))},beforeShow:function(a){return function(){_.defer(function(){return $("#ui-datepicker-div").css("z-index",2)})}}(this)}),t.removeClass("has_purchases"),r.remote_submit(function(a){return function(o){if(o.errors){alert(o.errors.join(", "));return}return t.toggleClass("is_plural",o.count!==1).toggleClass("no_results",o.count===0).find(".purchase_count").text(o.count),t.addClass("has_purchases").find(".purchases").html(o.content)}}(this))},n}();var ct=null;E.libs.react.done(function(){var n,e,r,t,s,i,a,o,l,c,d,b,h,y,g;return e=F,c=e.label,a=e.form,o=e.h2,l=e.input,i=e.div,b=e.p,r=e.a,h=e.select,t=e.button,s=e.code,y=e.span,g=e.ul,d=e.li,n=M.package("GameEdit"),ct=n("DownloadKeyLightbox",{propTypes:{new_key:j.bool,download_key:j.shape({id:j.number.isRequired,url:j.string.isRequired,label:j.string,must_be_claimed:j.bool,can_be_claimed:j.bool,unlock_external_keys:j.bool,external_keys:j.array,owner:j.shape({display_name:j.string.isRequired,url:j.string.isRequired})}).isRequired,game:j.shape({noun:j.string.isRequired}).isRequired},componentWillUnmount:function(){if(this.props.new_key&&!E.Spec)return E.Lightbox.open_loading(),window.location.reload()},getInitialState:function(){var w;return w=this.props.download_key,{changed:!1,label:w.label,can_be_claimed:w.can_be_claimed||!1,must_be_claimed:w.must_be_claimed||!1,unlock_external_keys:w.unlock_external_keys||!1}},on_save_close:function(w){if(w&&w.preventDefault(),!this.state.loading)return this.state.changed?this.save_key():E.Lightbox.close()},save_key:function(w){return this.setState({loading:!0,changed:!1}),E.remote_submit($(this.form_ref.current)).then(function(u){return function(f){return f.errors?u.setState({errors:f.errors,loading:!1}):window.location.reload()}}(this))},render:function(){var w;return w=this.props.download_key,M.Lightbox({className:"key_lightbox"},o({},"Download key"),a({ref:this.form_ref||(this.form_ref=P.createRef()),action:"",method:"post",onSubmit:this.on_save_close},M.CSRF({}),l({type:"hidden",name:"action",value:"update"}),l({type:"hidden",name:"download_key_id",value:this.props.download_key.id}),this.state.errors?M.Forms.FormErrors({errors:this.state.errors}):void 0,i({className:"unclaimed_message"},w.owner?b({},"This download key was claimed by ",r({href:w.owner.url},w.owner.display_name),"."):b({},"Share this URL with someone to give them download access to your "+this.props.game.noun+" without paying:"),i({className:"form"},l({type:"text",readOnly:!0,className:"text_input key_url_input",onClick:function(u){return function(f){return f.target.select()}}(this),value:w.url})),w.owner?void 0:b({},"This URL can be used by anyone, so don't spread more than necessary. If you think it's being abused you can revoke it."),i({className:"form key_settings"},this.render_claimed_external_keys(),this.render_label_settings(),this.render_claim_options()),i({className:"button_row"},t({disabled:this.state.loading,className:G("button",{disabled:this.state.loading}),onClick:this.on_save_close},this.state.changed&&"Save & close"||"Close")))))},render_claimed_external_keys:function(){var w;if((w=this.props.download_key.external_keys)!=null&&w.length)return i({className:"input_row"},i({className:"label"},"Claimed external keys"),ot({rows:this.props.download_key.external_keys,columns:[{field:"type",label:"Type"},{field:"key",label:"Key",render:function(u,f){return s({},u.key)}}]}))},render_label_settings:function(){return i({className:"input_row"},c({},i({className:"label"},"Label",y({className:"sub"}," \u2014 ","You can assign a private label to the key for easy identification later.")),l({name:"download_key[label]",type:"text",className:"text_input label_input",placeholder:"Unlabeled",value:this.state.label||"",onChange:function(w){return function(u){return w.setState({changed:!0,label:u.target.value})}}(this)})))},render_claim_options:function(){return i({className:"input_row"},i({className:"label"},"Key options"),g({className:"check_list"},d({},c({className:"claim_toggle"},l({type:"checkbox",name:"download_key[can_be_claimed]",checked:this.state.can_be_claimed,onChange:function(w){return function(){return w.setState({changed:!0,can_be_claimed:!w.state.can_be_claimed})}}(this)}),"Download key can be claimed",y({className:"sub"}," \u2014 ","Enables anyone with an itch.io account to take ownership of the download key, preventing anyone else from using it."))),this.state.can_be_claimed?d({},c({className:"claim_toggle"},l({type:"checkbox",name:"download_key[must_be_claimed]",checked:this.state.must_be_claimed,onChange:function(w){return function(){return w.setState({changed:!0,must_be_claimed:!w.state.must_be_claimed})}}(this)}),"Require key to be claimed",y({className:"sub"}," \u2014 ","Forces the key to be claimed before allowing files to be downloaded. This can help prevent the key from being shared."))):void 0,d({},c({className:"claim_toggle"},l({type:"checkbox",name:"download_key[unlock_external_keys]",checked:this.state.unlock_external_keys,onChange:function(w){return function(){return w.setState({changed:!0,unlock_external_keys:!w.state.unlock_external_keys})}}(this)}),"Grant external key",y({className:"sub"}," \u2014 ","Allows access to any Steam or other keys that you've added to your project. Note that only one type of external key can be granted per download key.")))))}})});var pr,kn=function(n,e){return function(){return n.apply(e,arguments)}},xn=function(n,e){for(var r in e)Nn.call(e,r)&&(n[r]=e[r]);function t(){this.constructor=n}return t.prototype=e.prototype,n.prototype=new t,n.__super__=e.prototype,n},Nn={}.hasOwnProperty;pr=function(n){xn(e,n);function e(){return this.init=kn(this.init,this),e.__super__.constructor.apply(this,arguments)}return e.prototype.init=function(r){var t;return E.money_input(this.el.find(".unlock_price_input")),E.bind_checkbox_to_input(this.el.find(".toggle_unlock_input"),this.el.find(".unlock_price_input")),t=this.el.find("form").remote_submit(function(s){return function(i){if(i.errors){t.set_form_errors(i.errors);return}return window.location.reload()}}(this))},e}(E.Lightbox),E.GameKeys=function(){function n(e,r){this.params=r,this.el=V(e),this.el.dispatch("click",{create_key_group_btn:function(t){return function(s){return E.Lightbox.open_tpl("key_group_lightbox",pr,t)}}(this),create_key_btn:function(t){return function(s){return Y(t.create_download_key().then(function(i){return ct(t.lightbox_props(i,!0))}))}}(this),revoke_key_btn:function(t){return function(s){var i;if(confirm("Are you sure you want to revoke this key?"))return i=s.closest("[data-key]"),i.removeClass("new").addClass("revoked"),t.revoke_download_key(i.data("key"))}}(this),show_key_btn:function(t){return function(s){var i;if(!s.closest(".revoked").length)return i=s.closest("[data-key]").data("key"),Y(ct(t.lightbox_props(i)))}}(this)})}return n.prototype.lightbox_props=function(e,r){return{new_key:r,download_key:e,game:{noun:"game"}}},n.prototype._download_key=function(e,r){return r==null&&(r={}),r.action=e,V.ajax({url:this.params.new_key_url,type:"post",data:E.with_csrf(r)}).then(function(t){return function(s){return s.errors?(alert(s.errors.join(",")),V.Deferred()):s}}(this))},n.prototype.create_download_key=function(){return this._download_key("create")},n.prototype.revoke_download_key=function(e,r){return this._download_key("revoke",{download_key_id:e.id})},n}();var Sn=function(n,e){return function(){return n.apply(e,arguments)}};I.GameReleaseInfo=function(){function n(e,r){this.opts=r,this.setup_date_pickers=Sn(this.setup_date_pickers,this),I.event2("game release info"),this.el=$(e),I.setup_selectize(this.el),this.setup_date_pickers(),this.setup_licenses(),this.form=this.el.find("form").remote_submit(function(t){return function(s,i){if(s.errors){i.set_form_errors(s.errors);return}return i.set_form_errors([]),I.flash("Changes saved")}}(this)),I.setup_dirty_warning(this.form)}return n.prototype.setup_licenses=function(){return["code","assets"].forEach(function(e){return function(r){var t,s;return s=e.el.find("."+r+"_license_picker"),t=function(i){var a;return a=s.val(),e.el.find("."+r+"_license").removeClass("shown"),e.el.find("."+r+"_license.license_"+a).addClass("shown")},s.on("change",t),t()}}(this))},n.prototype.setup_date_pickers=function(){return this.el.find(".timezone_input").val(jstz.determine().name()),Ie(this.el.find(".date_picker"))},n}(),I.libs.react.done(function(){var n,e,r,t,s;return e=F,r=e.div,t=e.label,n=R.package("Dashboard"),s=PropTypes,n("Analytics",{getInitialState:function(){var i;return i=this.props.graphs,{range_left:i!=null?i.range_left:void 0,range_right:i!=null?i.range_right:void 0,group_by:i!=null?i.group_by:void 0,render_group_by:i!=null?i.group_by:void 0,games_by_id:this.make_games_by_id(i.games),graphs:i,default_graph_opts:{class:"graph_container",y_axis_padding:1.1,popup_group:function(a){return function(o){var l;return((l=a.state.games_by_id[o.game_id])!=null?l.title:void 0)||""}}(this),group_url:function(a){return function(o){var l;return(l=a.state.games_by_id[o.game_id])!=null?l.url:void 0}}(this)}}},make_games_by_id:function(i){var a,o,l,c;for(o={},l=0,c=i.length;l<c;l++)a=i[l],o[a.id]=a;return o},refresh_graphs:function(){var i;return this.setState({loading:!0}),i=this.state.group_by,$.getJSON("",{range_left:this.state.range_left,range_right:this.state.range_right,group_by:i}).done(function(a){return function(o){return o.range_left?a.setState({loading:!1,graphs:o,games_by_id:a.make_games_by_id(o.games),render_group_by:i}):a.setState({loading:!1,errors:o.errors})}}(this))},on_update_range:function(i){return this.setState(i,function(a){return function(){return a.refresh_graphs()}}(this))},render:function(){var i,a;return a=this.state.graphs,i=a.num_ticks>52?"line":"stacked",this.enclose({className:classNames({loading:this.state.loading})},Me({loading:this.state.loading,range_left:this.state.range_left,range_right:this.state.range_right,group_by:this.state.group_by,preset_ranges:this.props.preset_ranges,on_update_range:this.on_update_range}),r({className:"graphs"},ne(Object.assign({label:"Views",type:i,data:a.views||[],interval:this.state.render_group_by,range_left:a.range_left,range_right:a.range_right},this.state.default_graph_opts)),_.toArray(a.downloads).length?ne(Object.assign({label:"Downloads",type:i,data:a.downloads,interval:this.state.render_group_by,range_left:a.range_left,range_right:a.range_right,min_y:3},this.state.default_graph_opts)):void 0,_.toArray(a.plays).length?ne(Object.assign({label:"Browser Plays",type:i,data:a.plays,interval:this.state.render_group_by,range_left:a.range_left,range_right:a.range_right,min_y:3},this.state.default_graph_opts)):void 0))}})}),I.libs.react.done(function(){var n,e,r,t,s,i,a,o,l,c,d,b,h,y,g;return e=F,i=e.form,a=e.h2,d=e.p,r=e.a,g=e.ul,c=e.li,h=e.strong,o=e.input,b=e.span,l=e.label,s=e.div,t=e.button,n=R.package("Dashboard"),y=PropTypes,n("ConvertPostToDevlogLightbox",{pure:!0,getInitialState:function(){return{}},remote_submit:function(w){if(w.preventDefault(),!this.state.loading)return this.setState({loading:!0,errors:null}),I.remote_submit($(this.form_ref.current)).then(function(u){return function(f){var k;if(u.setState({loading:!1}),f.errors){u.setState({errors:f.errors});return}if(f.success)if(f.redirect_to)u.setState({loading:!0}),window.location=f.redirect_to;else return(k=u.lightbox_ref.current)!=null?k.close():void 0}}(this))},render:function(){return re({className:classNames(this.enclosing_class_name()),ref:this.lightbox_ref||(this.lightbox_ref=React.createRef())},a({},"Convert Post to Devlog"),d({},"Converting a post to a devlog will attach the post to the selected project. Please confirm before converting:"),g({},c({},"Post will display within the project's page"),c({},"Analytics and comments are kept"),c({},"Any other project owners will gain the ability to edit the post"),c({},h({},"This change is irreversible.")," ","If you make a mistake you will have to delete the post and re-create it")),i({method:"post",className:"form",action:this.props.submit_url,ref:this.form_ref||(this.form_ref=React.createRef()),onSubmit:this.remote_submit},R.CSRF({}),this.state.errors?R.Forms.FormErrors({errors:this.state.errors,animated:!0}):void 0,R.Forms.InputRow({title:"Selected post"},r({target:"_blank",href:this.props.post.url},this.props.post.title)),R.Forms.InputRow({title:"Select the project your post will be attached to"},R.Forms.SimpleSelect({name:"game_id",options:this.props.devlog_targets.map(function(w){return function(u){return{value:""+u.id,name:u.title}}}(this))})),R.Forms.InputRow({},o({type:"checkbox",name:"confirm",required:!0,value:"1"})," ",b({className:"label"},this.tt("misc.forms.confirm"))),s({className:"buttons"},t({disabled:this.state.loading,className:classNames("button",{disabled:this.state.loading})},"Convert post"))))}})});var Ge,ce,pt,dt,ft,ht,pe,dr,_t,Oe,mt,gt,ze,fr,hr,bt,In=[].slice;Oe=function(n,e,r){return n<0?n+=1:n>1&&(n-=1),6*n<1?e+(r-e)*6*n:2*n<1?r:3*n<2?e+(r-e)*(2/3-n)*6:e},pt=function(n,e,r){var t,s,i,a,o;return n=n/360,e=e/100,r=r/100,e===0?(i=r,s=r,t=r):(o=r<.5?r*(1+e):r+e-r*e,a=2*r-o,i=Oe(n+1/3,a,o),s=Oe(n,a,o),t=Oe(n-1/3,a,o)),[i*255,s*255,t*255]},mt=function(n,e,r){var t,s,i,a,o;return n=n/255,e=e/255,r=r/255,a=Math.min(n,e,r),i=Math.max(n,e,r),o=0,t=0,s=(a+i)/2,a!==i&&(o=s<.5?(i-a)/(i+a):(i-a)/(2-i-a),t=function(){switch(i){case n:return(e-r)/(i-a);case e:return 2+(r-n)/(i-a);case r:return 4+(n-e)/(i-a)}}()),t<0&&(t+=6),[t*60,o*100,s*100]},ht=function(){var n,e,r,t,s,i,a,o,l,c,d;if(c=arguments[0],o=2<=arguments.length?In.call(arguments,1):[],t="[a-fA-f0-9]",s=t+t,d="^#("+t+")("+t+")("+t+")$",l="^#("+s+")("+s+")("+s+")$",i=c.match(new RegExp(d)),i)n=i[0],a=i[1],r=i[2],e=i[3],a+=a,r+=r,e+=e;else{if(i=c.match(new RegExp(l)),!i)return null;n=i[0],a=i[1],r=i[2],e=i[3]}return[parseInt(a,16),parseInt(r,16),parseInt(e,16)]},pe=function(){var n;return n=ht.apply(null,arguments),n||[0,0,0]},Ge=function(n){var e;return e=Math.floor(n).toString(16),e.length===1?"0"+e:e},ce=function(n,e,r){return n=Math.min(255,Math.max(0,n)),e=Math.min(255,Math.max(0,e)),r=Math.min(255,Math.max(0,r)),"#"+Ge(n)+Ge(e)+Ge(r)},fr=function(n,e,r){var t,s,i,a,o;return e==null&&(e=15),r==null&&(r=.8),a=mt.apply(null,pe(n)),t=a[0],o=a[1],s=a[2],i=s>50?s-e:s+e,i=Math.max(0,Math.min(100,i)),ce.apply(null,pt(t,o*r,i))},dt=function(n,e,r){return(.299*n+.587*e+.114*r)/255},_t=function(n,e,r){return n=n/255,e=e/255,r=r/255,n=n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4),e=e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4),r=r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4),.2126*n+.7152*e+.0722*r},gt=function(n,e,r){var t,s,i;return i=.299*n+.587*e+.114*r,t=(r-i)*.565,s=(n-i)*.713,[i,t,s]},bt=function(n,e,r){var t,s,i;return i=n+1.403*r,s=n-.344*e-.714*r,t=n+1.77*e,[i,s,t]},ze=function(n,e,r,t){var s,i,a,o;return t==null&&(t=.1),s=gt(n,e,r),o=s[0],i=s[1],a=s[2],t<0?o+=t*o:o+=t*(255-o),bt(o,i,a)},dr=function(n,e,r){var t,s;return typeof n=="string"&&(t=pe(n),n=t[0],e=t[1],r=t[2]),s=_t(n,e,r),s>=.45?ft(ce(n,e,r),"#000000",.2):"#ffffff"},hr=function(n,e,r){var t,s,i,a,o;return e==null&&(e=.15),r==null&&(r=.5),o=pe(n),a=o[0],s=o[1],t=o[2],i=dt(a,s,t),i<r?ce.apply(null,ze(a,s,t,e)):ce.apply(null,ze(a,s,t,-e))},ft=function(n,e,r){var t,s,i,a,o,l,c,d,b;return r===1?n:r===0?e:(d=pe(n),l=d[0],a=d[1],s=d[2],b=pe(e),c=b[0],o=b[1],i=b[2],t=1-r,ce(l*r+c*t,a*r+o*t,s*r+i*t))};var ae=E.Color||(E.Color={hsl_to_rgb:pt,rgb_to_hsl:mt,parse_color:ht,parse_color_safe:pe,hex_color:ce,sub_color:fr,luma:dt,relative_luma:_t,rgb_to_yuv:gt,yuv_to_rgb:bt,scale_luma:ze,readable_text_color:dr,sub_color2:hr,mix_color:ft}),_r=null,ue=null;E.libs.react.done(function(){var n,e,r,t,s;return e=F,t=e.div,r=e.button,s=e.input,n=M.package("Forms"),n("PortalElement",{getInitialState:function(){return this.el=document.createElement("div"),$(this.el).addClass("portal_element"),{}},componentDidMount:function(){return this.props.container_el.appendChild(this.el)},componentWillUnmount:function(){return this.props.container_el.removeChild(this.el)},render:function(){return X.createPortal(this.props.children,this.el)}}),_r=n("ColorWheel",{render:function(){var i,a,o,l,c,d,b,h,y;return(l=this.state)!=null&&l.color&&!this.props.onChange?(c=this.state.color,i=c[0],b=c[1],a=c[2]):this.props.color&&(d=this.props.color,i=d[0],b=d[1],a=d[2]),i==null&&(i=0),b==null&&(b=50),a==null&&(a=100),o=(i-90)/180*Math.PI,h=Math.cos(o),y=Math.sin(o),this.enclose({},t({className:"color_block",style:{background:"hsl("+i+", 100%, 50%)",width:"101px",height:"101px"}}),t({className:"wheel",style:{width:"195px",height:"195px"},onMouseDown:function(g){return function(w){return w.preventDefault(),g.start_drag(w,w.target,function(u,f){var k,p;return h=(u-.5)*2,y=(f-.5)*2,k=Math.atan2(y,h)/Math.PI*180,p=(k+360+90)%360,g.update_color(p,b,a)})}}(this)}),t({className:"mask",style:{width:"101px",height:"101px"},onMouseDown:function(g){return function(w){return w.preventDefault(),g.start_drag(w,w.target,function(u,f){var k,p;return p=(1-u)*100,k=(1-f)*100,g.update_color(i,p,k)})}}(this)}),t({className:"marker h-marker",style:{left:97+h*84+"px",top:97+y*84+"px"}}),t({className:"marker sl-marker",style:{left:47+101*(100-b)/100+"px",top:47+101*(100-a)/100+"px"}}))},set_hex_color:function(i){var a,o,l,c;try{return c=ae.parse_color(i),l=c[0],o=c[1],a=c[2],this.setState({color:ae.rgb_to_hsl(l,o,a)})}catch(d){}},update_color:function(i,a,o){return this.props.onChange!=null?this.props.onChange([i,a,o]):this.setState({color:[i,a,o]})},start_drag:function(i,a,o){var l,c,d;if(!((c=this.state)!=null&&c.dragging))return this.setState({dragging:!0}),l=function(b){var h,y,g,w,u;if(b.preventDefault(),b.buttons===0){d();return}return g=a.getBoundingClientRect(),w=b.clientX,u=b.clientY,h=(w-g.left)/(g.right-g.left),y=(u-g.top)/(g.bottom-g.top),h=Math.min(1,Math.max(0,h)),y=Math.min(1,Math.max(0,y)),typeof o=="function"?o(h,y):void 0},d=function(b){return function(h){return h!=null&&h.preventDefault(),document.body.removeEventListener("mousemove",l),document.body.removeEventListener("mouseup",d),delete b.up_listener,b.setState({dragging:!1})}}(this),document.body.addEventListener("mousemove",l),document.body.addEventListener("mouseup",d),l(i),this.up_listener=d}}),n("ColorInputPopup",{palette:["#193d3f","#3f2832","#743f39","#9e2835","#b86f50","#327345","#e53b44","#4f6781","#0484d1","#fb922b","#afbfd2","#63c64d","#e4a672","#2ce8f4","#ffe762"],set_wheel_color:function(i){var a,o,l,c;try{return c=ae.parse_color(i),l=c[0],o=c[1],a=c[2],this.setState({wheel_color:ae.rgb_to_hsl(l,o,a)})}catch(d){}},componentDidMount:function(){var i;if(!((i=this.state)!=null&&i.wheel_color)&&this.props.color)return this.set_wheel_color(this.props.color)},render:function(){var i,a,o,l;return this.wheel_ref||(this.wheel_ref=P.createRef()),i=this.props.palette||this.palette,(a=this.props.position)&&(l={left:a.left+"px",top:a.top+"px"}),this.enclose({className:"color_popout",style:l},this.props.allow_empty&&this.props.color?r({type:"button",className:"clear_color_btn",onClick:function(c){return function(){var d;return typeof(d=c.props).set_color=="function"?d.set_color(""):void 0}}(this)},"Clear"):void 0,_r({ref:this.wheel_ref,color:(o=this.state)!=null?o.wheel_color:void 0,onChange:function(c){return function(d){var b;return typeof(b=c.props).set_color=="function"&&b.set_color(ae.hex_color.apply(ae,ae.hsl_to_rgb.apply(ae,d))),c.setState({wheel_color:d})}}(this)}),i?t({className:"palette_options"},i.map(function(c){return function(d){return r({key:d,type:"button",style:{backgroundColor:d},onClick:function(b){var h;return typeof(h=c.props).set_color=="function"&&h.set_color(d),c.set_wheel_color(d)}},d)}}(this))):void 0)}}),ue=n("ColorInput",{pure:!0,propTypes:{name:j.string,value:j.any,defaultValue:j.any,allow_empty:j.bool,popout_portal_target:j.object},componentDidMount:function(){return ue.active_inputs||(ue.active_inputs=[]),ue.active_inputs.push(this)},componentWillUnmount:function(){var i;return ue.active_inputs=function(){var a,o,l,c;for(l=ue.active_inputs,c=[],a=0,o=l.length;a<o;a++)i=l[a],i!==this&&c.push(i);return c}.call(this)},componentDidUpdate:function(i,a){var o,l,c;if(l=i.value||"",c=this.props.value||"",l!==c&&(o=this.set_color(c)))return this.refs.input.value=o},getInitialState:function(){return{open:!1,last_value:this.props.value||this.props.defaultValue||""}},on_blur:function(){if(!this.set_color_from_input())return this.input_ref.current.value=this.state.last_value,this.set_color(this.state.last_value)},set_color_from_input:function(){var i,a,o;return a=this.input_ref.current.value,a===""&&this.props.allow_empty?(this.setState({has_error:!1,last_value:""}),!0):(a!==""&&!a.match("^#")&&(a="#"+a,this.input_ref.current.value=a),i=ae.parse_color(a),i?(this.set_color(a),(o=this.popout_ref.current)!=null&&o.set_wheel_color(a),!0):(this.setState({has_error:!0}),!1))},set_color:function(i){var a;return this.input_ref.current.value=i,this.setState({last_value:i,has_error:!1}),typeof(a=this.props).onChange=="function"?a.onChange(i):void 0},open:function(){if(!this.state.open)return this.setState({open:!0,on_left:this.popout_on_left(),popout_position:this.popout_position()}),this.click_outside_handler||(this.click_outside_handler=function(i){return function(a){var o,l,c;if(c=X.findDOMNode(i),!$(a.target).closest(c).length&&!((l=i.popout_ref.current)&&(o=X.findDOMNode(l),$(a.target).closest(o).length)))return i.close()}}(this)),$(document.body).on("mousedown",this.click_outside_handler)},componentWillUnmount:function(){if(this.click_outside_handler)return $(document.body).off("mousedown",this.click_outside_handler)},close:function(){if(this.state.open)return this.setState({open:!1}),$("document.body").off("mousedown",this.click_outside_handler)},popout_position:function(){var i,a;if(this.props.popout_portal_target)return i=X.findDOMNode(this),a=i.getBoundingClientRect(),{left:Math.trunc(a.right+window.scrollX),top:Math.trunc(a.top+window.scrollY)}},popout_on_left:function(){var i,a;return i=$(X.findDOMNode(this)),a=i.offset().left+i.width()+250,a>$(window).width()+$(window).scrollLeft()},render_color_popout:function(){var i,a;return this.popout_ref||(this.popout_ref=P.createRef()),a=n.ColorInputPopup({ref:this.popout_ref,palette:this.props.palette,color:this.state.last_value,allow_empty:this.props.allow_empty,set_color:this.set_color,position:this.state.popout_position}),(i=this.props.popout_portal_target)&&(a=n.PortalElement({container_el:i},a)),a},render:function(){var i;return i=this.state.last_value||"#ffffff",this.input_ref||(this.input_ref=P.createRef()),this.enclose({className:G(this.props.className,{picker_open:this.state.open,picker_left:this.state.on_left,color_error:this.state.has_error})},s({ref:this.input_ref,type:"text",className:"color_text_input",name:this.props.name,defaultValue:this.props.value||this.props.defaultValue,placeholder:this.props.defaultValue||"Color",onBlur:this.on_blur,onFocus:this.open,onKeyDown:function(a){return function(o){switch(o.keyCode){case 9:return a.close()}}}(this),onKeyUp:function(a){return function(o){return a.set_color_from_input()}}(this)}),t({className:"color_swatch",onClick:this.open,style:{backgroundColor:i}}),this.state.open?this.render_color_popout():void 0)}})}),I.libs.react.done(function(){var n,e,r,t,s,i,a,o,l,c,d,b,h,y,g,w;return e=F,l=e.input,i=e.div,a=e.form,c=e.label,r=e.a,h=e.span,t=e.button,g=e.textarea,s=e.code,b=e.select,y=e.strong,d=e.p,o=e.iframe,n=R.package("GameEdit"),w=PropTypes,n("EmbedUpload",{propTypes:{embed_url_template:w.string,noun:w.string,uploads:w.array},componentDidMount:function(){return this.pick_upload(this.state.selected_upload),$(document.body).on("keydown",function(u){return function(f){if(f.keyCode===27)return u.setState({show_preview:!1})}}(this))},getInitialState:function(){return{show_preview:!1,width:this.props.default_width,height:this.props.default_height,color:this.props.default_color,selected_upload:this.default_upload()}},default_upload:function(){var u,f,k,p,x;if(this.props.uploads){for(p=this.props.uploads,u=f=0,k=p.length;f<k;u=++f)if(x=p[u],x.default)return u;return 0}},pick_upload:function(u){var f,k,p;if(u=+u,k={selected_upload:u},p=(f=this.props.uploads)!=null?f[u]:void 0,!!p)return p.height&&(k.height=p.height),p.width&&(k.width=p.width),this.setState(k)},current_upload:function(){return this.props.uploads[this.state.selected_upload]},set_int:function(u,f){var k;if((""+f).match(/^\d*$/))return k={},k[u]=f,this.setState(k)},render:function(){return!this.props.uploads||this.props.uploads.length===0?this.render_empty():this.enclose({className:"embed_upload"},this.state.show_preview?this.render_preview():void 0,i({className:"form"},i({className:"upload_list"},c({},i({className:"label"},"Select a file"),R.Forms.SimpleSelect({value:this.state.selected_upload,onChange:function(u){return function(f){return u.pick_upload(f)}}(this),options:this.props.uploads.map(function(u){return function(f,k){return{value:k,name:f.name}}}(this))}))),i({className:"embed_options"},c({},h({className:"label"},"Width"),l({type:"text",value:this.state.width,onChange:function(u){return function(f){return u.set_int("width",f.target.value)}}(this)})),c({},h({className:"label"},"Height"),l({type:"text",value:this.state.height,onChange:function(u){return function(f){return u.set_int("height",f.target.value)}}(this)})),c({},h({className:"label"},"Color"),ue({value:this.state.color,onChange:function(u){return function(f){return u.setState({color:f})}}(this)})),i({className:"spacer"}),t({className:"button",onClick:function(u){return function(f){return f.preventDefault(),u.setState({show_preview:!0})}}(this)},"Preview")),g({readOnly:!0,className:"embed_code",ref:function(u){return function(f){u.code_el=f}}(this),onClick:function(u){return function(f){return f.target.select()}}(this)}),n.RenderMarkup({children:this.render_embed(),on_html:function(u){return function(f){if(u.code_el)return u.code_el.value=f}}(this)}),i({className:"embed_directions"},y({},"Directions")," Copy and paste this HTML into your website where you want the "+this.props.noun+" to appear."),i({className:"ludum_dare_directions"},d({},y({},"Direct link?")," Use this link to go directly to your game:",l({type:"text",readOnly:!0,value:this.embed_url(),onClick:function(u){return function(f){return f.target.select()}}(this)})))))},render_empty:function(){return i({className:"empty_message"},d({},"You currently don't have any uploads available to be embedded."))},render_preview:function(){return i({className:"preview_container",onClick:function(u){return function(f){if($(f.target).is(".preview_container"))return u.setState({show_preview:!1})}}(this)},this.render_embed())},embed_url:function(){var u,f,k,p;return k=this.current_upload(),f={},(u=this.state.color.match(/#([a-fA-F\d]{6})/))&&(f.color=u[1]),f=$.param(f),p=_.template(this.props.embed_url_template)({id:k.id}),f!==""&&(p+="?"+f),p},render_embed:function(){var u;if(u=this.current_upload(),!!u)return o({frameBorder:"0",src:this.embed_url(),allowFullScreen:!0,width:this.state.width,height:this.state.height},r({href:this.props.game_url},this.props.game_link_title))}})}),I.libs.react.done(function(){var n,e,r,t,s,i,a,o,l,c,d,b,h;return e=F,i=e.form,c=e.select,a=e.input,h=e.ul,l=e.li,o=e.label,d=e.span,s=e.div,t=e.button,r=e.a,n=R.package("GameEdit"),b=PropTypes,n("PatreonAccess",{propTypes:{campaigns:b.array.isRequired},getInitialState:function(){return{currency:this.props.min_pledge_currency}},render:function(){var y;return this.enclose({component:"form",className:"form",method:"post"},R.CSRF({}),R.Forms.InputRow({title:"Select Patreon campaign"},R.Forms.SimpleSelect({name:"campaign_id",defaultValue:this.props.selected_campaign_id,options:[{value:"",name:"Disable Patreon access"}].concat(this.props.campaigns.map(function(g){return function(w){return{value:w.id,name:w.name}}}(this)))})),R.Forms.InputRow({title:"Campaign currency",sub:"Please select the currency to restrict minimum pledge by"},R.Forms.SimpleSelect({name:"minimum_pledge_currency",options:["USD","EUR","GBP","CAD"].map(function(g){return function(w){return{value:w,name:w}}}(this)),value:this.state.currency,onChange:function(g){return function(w){return g.setState({currency:w})}}(this)})),R.Forms.TextInputRow({className:"pledge_input",name:"minimum_pledge_amount",title:"Minimum pledge",sub:"Patron must pledge at least this much to get access to your project",defaultValue:this.props.min_pledge_amount,money_input:!0,key:"pledge_amount_"+this.state.currency,currency:this.state.currency,placeholder:I.format_money(0,this.state.currency)}),R.Forms.InputRow({title:"Key options"},h({className:"check_list"},l({},o({},a({type:"checkbox",name:"key_options[must_be_claimed]",defaultChecked:this.props.must_be_claimed}),"Require itch.io account to download",d({className:"sub"}," \u2014 ","This can help prevent people from sharing access links"))))),s({className:"buttons"},t({className:"button",name:"action",value:"select_campaign"},"Save")," ",t({name:"action",value:"refresh_campaigns",className:"button outline"},"Refresh campaigns"),(y=this.props.patreon_key_group)?r({href:y.url},"View claimed keys"):void 0))}})});var mr=[].slice;I.libs.react.done(function(){var n,e,r,t,s,i,a,o,l,c,d,b,h,y,g;return e=F,s=e.div,t=e.button,a=e.h3,o=e.input,c=e.label,h=e.span,r=e.a,y=e.strong,i=e.form,g=e.textarea,b=e.select,d=e.option,n=R.package("GameEdit"),l=0,n("EditRewards",{propTypes:{currency:j.string.isRequired,has_multi_rewards:j.bool,has_tickets:j.bool,game:j.object.isRequired,rewards:j.array},getInitialState:function(){return{rewards:_.toArray(this.props.rewards)}},componentDidMount:function(){return $(ReactDOM.findDOMNode(this)).has_tooltips(),this.dispatch("reward",{update:function(w){return function(u,f,k,p,x){if(w.state.rewards[f][k]=p,x)return w.forceUpdate()}}(this),remove:function(w){return function(u,f){return w.state.rewards.splice(f,1),w.forceUpdate()}}(this),add_field:function(w){return function(u,f){var k;return k=w.state.rewards[f],k.fields||(k.fields=[]),k.fields.push({}),w.forceUpdate()}}(this),remove_field:function(w){return function(u,f,k){var p;return p=w.state.rewards[f],p.fields.splice(k,1),w.forceUpdate()}}(this),update_field:function(w){return function(u,f,k,p,x){var v;return v=w.state.rewards[f],v.fields[k][p]=x,w.forceUpdate()}}(this)})},new_reward:function(){return this.state.rewards.push({key:"new-reward-"+(l+=1),title:"",price:""}),this.forceUpdate()},render:function(){return this.enclose({className:"game_edit_rewards"},this.render_reward_settings(),this.render_rewards(),s({className:"button_row"},t({className:"button new_reward_btn",type:"button",onClick:function(w){return function(u){return u.preventDefault(),w.new_reward()}}(this)},"New reward"),t({className:"button save_btn"},"Save")))},render_rewards:function(){if(this.state.rewards.length)return s({},a({},"Rewards"),s.apply(null,[{className:"reward_list"}].concat(mr.call(this.state.rewards.map(this.render_reward)))))},render_reward:function(w,u){return n.RewardEditor({key:w.id||w.key,idx:u,has_multi_rewards:this.props.has_multi_rewards,has_tickets:this.props.has_tickets,reward:w,game:this.props.game})},render_reward_settings:function(){if(this.state.rewards.length)return s({className:"reward_settings"},a({},"Reward settings"),s({className:"input_row reward_noun"},c({},s({className:"label"},"Custom noun",h({className:"sub"}," \u2014 Give a custom name to your reward program, optional")),o({type:"text",name:"reward_noun",placeholder:"Rewards",defaultValue:this.props.reward_noun}))),s({className:"input_row require_rewards_toggle"},c({},o({type:"checkbox",name:"reward_required",defaultChecked:this.props.reward_required}),h({className:"label"},"New purchases & downloads require a reward",h({className:"sub"}," \u2014 Your project can only be purchased/downloaded by those who claim a reward. Existing purchases and keys are not affected. ",r({className:"forward_link",target:"_blank",href:"/docs/creators/exclusive-content#running-a-limited-release-with-rewards"},"Learn more"))))))}}),n("RewardEditor",{propTypes:{reward:j.object.isRequired,has_multi_rewards:j.bool,has_tickets:j.bool,game:j.object.isRequired,idx:j.number.isRequired},getInitialState:function(){return{collapsed:this.props.reward.archived,allow_multiple:this.props.reward.max_purchase_quantity>1}},input_name:function(){var w;return w=1<=arguments.length?mr.call(arguments,0):[],"rewards["+this.props.idx+"]["+w.join("][")+"]"},update_field:function(w,u){return u==null&&(u=!0),function(f){return function(k){return f.trigger("reward:update",f.props.idx,w,k.target.value,u)}}(this)},componentDidMount:function(){return I.money_input($(this.refs.price)),ie($(this.refs.description),{minHeight:80})},render:function(){var w;return w=this.props.reward,s({className:classNames("reward_row",{collapsed:this.state.collapsed})},this.state.collapsed?s({className:"collapsed_notification"},s({className:"collapsed_message"},"Archived reward  \u2014 ",y({className:"reward_title"},w.title),h({className:"claimed_count"}," \u2014 Claimed: "+I.number_format(w.claimed_count))),t({type:"button",className:"button outline",onClick:function(u){return function(){return u.setState({collapsed:!1})}}(this)},"Open")):void 0,this.render_form())},render_form:function(){var w,u,f,k;return k=this.props.reward,w=k.price&&this.props.game.min_price>k.price,u=k.amount!=null&&k.amount<(k.claimed_count||0),s({className:"reward_editor_form"},k.id?o({type:"hidden",name:this.input_name("id"),value:k.id}):void 0,r({href:"#",className:"remove_button",onClick:function(p){return function(x){return x.preventDefault(),p.props.reward.claimed_count>0?(p.trigger("reward:update",p.props.idx,"archived",!0),p.setState({collapsed:!0})):p.trigger("reward:remove",p.props.idx)}}(this)},this.props.reward.claimed_count>0?"Hide":"Remove"),s({className:"reward_primary_column"},c({className:"input_row title_row"},s({className:"label"},"Title"),o({type:"text",name:this.input_name("title"),className:"reward_title_input",required:!0,value:k.title,onChange:this.update_field("title")})),c({className:"input_row description_row"},s({className:"label"},"Description"),g({ref:"description",placeholder:"Description",name:this.input_name("description"),className:"reward_description_input",defaultValue:k.description}))),s({className:"reward_secondary_column"},c({className:"input_row"},s({className:"label"},"Minimum price"),o({type:"text",name:this.input_name("price"),"data-currency":this.props.currency,ref:"price",className:classNames("reward_price_input",{has_error:w}),defaultValue:k.price,placeholder:I.format_money(0,this.props.currency),onKeyUp:function(p){return function(x){return p.trigger("reward:update",p.props.idx,"price",I.parse_money($(x.target).val()),!0)}}(this)}),w?s({className:"input_error"},"Must be greater than "+I.format_money(this.props.game.min_price,this.props.currency)):void 0),c({className:"input_row"},s({className:"label"},"Total quantity"),o({type:"text",className:classNames("amount_input_row",{has_error:u}),name:this.input_name("amount"),pattern:"\\d+",required:!0,value:(f=k.amount)!=null?f:"",onChange:this.update_field("amount")}),u?s({className:"input_error"},"Quantity must be greater or equal to amount already claimed"):void 0),k.id!=null?c({className:"input_row",title:"No new purchases can claim this reward, hide the reward from the page"},o({type:"checkbox",name:this.input_name("archived"),checked:!!k.archived,onChange:function(p){return function(x){return p.trigger("reward:update",p.props.idx,"archived",x.target.checked,!0)}}(this)}),h({className:"label"},"Archived")):void 0,this.props.has_tickets&&c({className:"input_row"},s({className:"label"},"Reward type"),b({name:this.input_name("type"),value:k.type,disabled:k.claimed_count>0,onChange:function(p){return function(x){return p.trigger("reward:update",p.props.idx,"type",x.target.value,!0)}}(this)},d({value:"default"},"Default"),d({value:"ticket"},"Ticket"))),this.props.has_multi_rewards&&c({className:"input_row"},o({type:"checkbox",checked:this.state.allow_multiple,onChange:function(p){return function(x){return p.setState({allow_multiple:x.target.checked})}}(this)}),h({className:"label"},"Allow buying more than one")),this.props.has_multi_rewards&&this.state.allow_multiple&&c({className:"input_row"},s({className:"label"},"Max quantity per purchase"),o({type:"number",name:this.input_name("max_purchase_quantity"),min:1,max:10,value:k.max_purchase_quantity,onChange:function(p){return function(x){var v,m,N;return N=parseInt(x.target.value,10),m=parseInt(x.target.min,10),v=parseInt(x.target.max,10),N<m&&(N=m),N>v&&(N=v),p.trigger("reward:update",p.props.idx,"max_purchase_quantity",N,!0)}}(this)})),this.render_fields_editor(),k.claimed_count!=null?s({className:"input_row"},s({className:"label"},"Amount claimed"),s({className:"claimed_count"},""+I.number_format(k.claimed_count))):void 0))},render_field:function(w,u){var f,k;return f=this.input_name("fields",""+(u+1)),k=function(p){return function(x){return function(v){var m;return m=v.target.value,p.trigger("reward:update_field",p.props.idx,u,x,m)}}}(this),s({className:"reward_field",key:f},w.id!=null?o({type:"hidden",name:f+"[id]",value:w.id}):void 0,s({className:"field_header"},b({name:f+"[type]",className:"field_type_input",value:w.type||"text",onChange:k("type")},d({value:"text"},"Single-line text"),d({value:"text_multi"},"Multi-line text"),d({value:"single_choice"},"Single choice"),d({value:"address"},"Address")),t({className:"remove_field_button",type:"button",title:"Remove reward","data-tooltip":"Remove field",onClick:function(p){return function(x){if(!(w.filled_count&&!confirm("Because people have already filled out this field it will be archived instead of deleted")))return $(x.target).trigger("i:hide_tooltip"),x.preventDefault(),p.trigger("reward:remove_field",p.props.idx,u)}}(this)},"\xD7")),R.Forms.TextInputRow({title:"Field name",required:!0,name:f+"[name]",required:!0,placeholder:"required",value:w.name||"",onChange:k("name")}),function(){switch(w.type){case"single_choice":return R.Forms.TextInputRow({title:"Choices",sub:"separate by commas",name:f+"[choices]",required:!0,placeholder:"required",value:w.choices||"",onChange:k("choices")});case"ticket":return c({className:"input_row"},o({type:"checkbox"}),h({className:"label"},"Ask for usual name"))}}())},render_fields_editor:function(){var w,u;return s({className:"fields_editor"},(w=this.props.reward.fields)!=null&&w.length?s({className:"fields_list",children:(u=this.props.reward.fields)!=null?u.map(this.render_field):void 0}):void 0,s({},t({type:"button",className:"button small new_field_btn",onClick:function(f){return function(){return f.trigger("reward:add_field",f.props.idx)}}(this)},"New field")))}})}),I.libs.react.done(function(){var n,e,r,t,s,i,a,o,l;return e=F,o=e.section,t=e.div,i=e.label,a=e.p,s=e.fragment,r=e.button,s=React.createElement.bind(null,React.Fragment),s.type=React.fragment,n=R.package("GameEdit"),l=PropTypes,n("Screenshots",{pure:!0,propTypes:{},getInitialState:function(){return{}},pick_screenshots:function(){return console.log("pick screenshots")},render:function(){return this.enclose({component:"section",className:"screenshot_editor"},t({className:"label"},this.tt("dashboard.edit_project.screenshots_header")),a({className:"sub"},this.props.is_default?s({},"Screenshots will appear on your project's page."," "):void 0,"Optional but highly recommended. Upload 3 to 5 for best results"),t({className:"screenshot_list"}),t({className:"screenshot_queue"}),t({},r({type:"button",className:"button add_screenshot_btn",onClick:this.pick_screenshots},this.tt("dashboard.edit_project.add_screenshots"))))}})});var ve=null;E.libs.react.done(function(){var n,e;return n=F,e=n.div,ve=M.component("SlideDown",{getInitialState:function(){return{}},getDefaultProps:function(){return{duration:200,delay:1}},componentDidMount:function(){return this.timer=window.setTimeout(function(r){return function(){var t;return t=r.wrapper_ref.current,r.setState({height:t.scrollHeight||!1}),r.timer=window.setTimeout(function(){return r.setState({animated:!0})},r.props.duration+50),t.scrollTop=0}}(this),this.props.delay)},componentWillUnmount:function(){if(this.timer)return window.clearTimeout(this.timer),delete this.timer},render:function(){var r;return r=this.state.height===!1?null:this.state.height?this.state.animated?null:{height:this.state.height+"px",overflow:"hidden",transition:"height "+this.props.duration/1e3+"s ease"}:{height:0,overflow:"scroll",transition:"height 0.2s ease"},e({style:r,className:this.props.className,ref:this.wrapper_ref||(this.wrapper_ref=P.createRef())},this.props.children)}})}),I.libs.react.done(function(){var n,e,r,t,s,i,a,o,l,c,d,b,h,y,g,w,u,f,k;return e=F,c=e.input,d=e.label,s=e.div,k=e.ul,b=e.li,u=e.span,r=e.a,t=e.button,g=e.section,l=e.h3,h=e.p,a=e.fragment,w=e.select,i=e.form,o=e.h2,f=e.strong,y=e.pre,a=React.createElement.bind(null,React.Fragment),a.type=React.fragment,n=R.package("GameEdit"),n("SubProduct",{pure:!0,focus:function(){return this.focus_el_ref.current.focus()},render:function(){var p,x;return x=this.props.product,p=this.enclose({className:"product_row",style:this.props.style},R.Forms.TextInputRow({title:"Name",placeholder:this.t("misc.forms.required"),ref:this.focus_el_ref||(this.focus_el_ref=React.createRef()),required:!0,value:x.name||"",onChange:this.set_name||(this.set_name=function(v){return function(m){return v.props.update({name:m.target.value})}}(this))}),Ke({label:"Product cover image",show_replace:!0,upload:x.cover_image,thumb_size:this.props.cover_thumb_size,upload_url:this.props.image_upload_url,on_upload:this.set_cover||(this.set_cover=function(v){return function(m){return v.props.update({cover_image_id:m!=null?m.id:void 0})}}(this))}),s({className:"input_row"},d({},s({className:"label"},"Description"),ut({defaultValue:x.description||"",on_change:function(v){return function(m){return v.props.update({description:m})}}(this)}))),R.Forms.TextInputRow({title:"Price",money_input:!0,currency:this.props.currency,required:!0,defaultValue:x.price||"",onKeyUp:this.set_price||(this.set_price=function(v){return function(m){return v.props.update({price:m.target.value})}}(this)),placeholder:I.format_money(0,this.props.currency)}),R.Forms.TextInputRow({title:"External ID",sub:"Included in redeem payload & API so your project can identify what is bought",placeholder:"optional",value:x.external_id||"",onChange:this.set_external_id||(this.set_external_id=function(v){return function(m){return v.props.update({external_id:m.target.value})}}(this))}),s({className:"input_row"},s({className:"label"},"Options"),k({className:"check_list"},b({},d({},c({type:"checkbox",checked:x.require_ownership||!1,onChange:function(v){return function(m){return v.props.update({require_ownership:m.target.checked})}}(this)}),"Require ownership of parent project")),b({},d({},c({type:"checkbox",checked:x.fixed_price||!1,onChange:function(v){return function(m){return v.props.update({fixed_price:m.target.checked})}}(this)}),"Fixed price",u({className:"sub"}," \u2014 Don't let buyers leave a tip above min price with 'Pay What You Want'"))),b({},d({},c({type:"checkbox",checked:x.disable_gifting||!1,onChange:function(v){return function(m){return v.props.update({disable_gifting:m.target.checked})}}(this)}),"Disable Gifting",u({className:"sub"}," \u2014 Prevent purchases being gifted to a different email address"))),b({},d({},c({type:"checkbox",checked:x.published||!1,onChange:function(v){return function(m){return v.props.update({published:m.target.checked})}}(this)}),"Published")))),s({className:"buttons"},x.url?r({href:x.url,target:"_blank",className:"button small"},"Buy Link"," ",jt({})):void 0," ",this.props.first&&this.props.last?void 0:ge({move_up:this.move_up||(this.move_up=function(v){return function(){return v.props.move_up()}}(this)),move_down:this.move_down||(this.move_down=function(v){return function(){return v.props.move_down()}}(this)),first:this.props.first,last:this.props.last})," ",t({type:"button",className:"button small outline delete_btn",onClick:function(v){return function(){if(confirm("Are you sure you want to remove this product"))return v.props.remove()}}(this)},_e({width:14})," ","Delete Product"))),x.just_added?ve({duration:500},p):p}}),n("RedeemSettings",{getInitialState:function(){return{}},display_secret:function(){var p;return p=this.state.secret||this.props.secret,this.state.display_secret?p:p.substr(0,5)+"... Click to reveal"},click_reset_secret:function(){if(confirm("Are you sure you want to regenerate your secret? Any applications using it will have to be updated"))return $.post(this.props.regenerate_secret_url,I.with_csrf()).done(function(p){return function(x){if(x.success)return I.flash("Regenerated secret"),p.setState({secret:x.secret},function(){var v,m;return(v=p.secret_input_ref)!=null&&(m=v.current)!=null&&typeof m.focus=="function"?m.focus():void 0})}}(this))},render:function(){return g({},l({},"Redeem settings"),h({},"Configure a redeem URL to send buyers back to your project to claim access to what they bought. ",r({href:this.props.docs_url,className:"forward_link",target:"_blank"},"Learn more")),R.Forms.TextInputRow({title:"URL",name:"redeem_settings[redeem_url]",placeholder:"Required to redeem products by URL",defaultValue:this.props.redeem_url}),this.props.secret?R.Forms.TextInputRow({title:"Secret",ref:this.secret_input_ref||(this.secret_input_ref=React.createRef()),sub:a({},"Secret key used to sign JWT payload"," ",this.props.regenerate_secret_url?t({type:"button",className:"button small outline",onClick:this.click_reset_secret},"Regenerate..."):void 0),className:"redeem_secret_input",readonly:!0,value:this.display_secret(),onFocus:function(p){return function(x){var v;return v=x.target,p.setState({display_secret:!0},function(){return v.select()})}}(this),onBlur:function(p){return function(){return p.setState({display_secret:!1})}}(this)}):void 0)}}),n("EditSubProducts",{getInitialState:function(){return{products:_.toArray(this.props.products)}},add_new_product:function(){return this.list_ref.current.add({just_added:!0},function(p){return function(x){return x.focus()}}(this))},render_products:function(){return s({className:"products"},Re({animate:!0,ref:this.list_ref||(this.list_ref=React.createRef()),on_list_update:function(p){return function(x){return p.setState({products:x})}}(this),item_name:"product",initial_items:this.state.products,item_component:n.SubProduct,item_props:function(p){return function(){return{image_upload_url:p.props.image_upload_url,cover_thumb_size:p.props.cover_thumb_size,currency:p.props.currency}}}(this),empty_content:s({className:"empty_message"},"You don't have any products")}))},render:function(){return this.enclose({},i({method:"POST",className:"form",onSubmit:function(p){return function(x){return x.preventDefault(),p.setState({loading:!0,errors:null}),I.remote_submit($(x.target)).then(function(v){if(v.errors){p.setState({errors:v.errors});return}if(v.redirect_to)return window.location=v.redirect_to})}}(this)},R.CSRF({}),c({type:"hidden",name:"sub_products",value:JSON.stringify(this.state.products)}),o({},"Sub-products & DLC"),h({},u({className:"icon-warning"})," ",f({},"Warning: "),"This is a pre-release feature, use at your own risk!"," ",r({href:this.props.docs_url},"Learn more")),g({},s({className:"buttons"},t({type:"button",onClick:this.add_new_product,className:"button"},u({className:"icon-plus"})," Add new product")),this.state.errors?R.Forms.FormErrors({errors:this.state.errors,scroll_into_view:!0}):void 0,this.render_products()),this.props.redeem_settings||this.state.products.length?n.RedeemSettings(Object.assign({docs_url:this.props.docs_url},this.props.redeem_settings)):void 0,s({className:"buttons"},t({className:"button"},"Save"))))}})}),I.libs.react.done(function(){var n,e,r,t,s,i,a,o,l,c,d,b;return e=F,o=e.input,t=e.button,i=e.form,d=e.p,c=e.option,r=e.a,s=e.div,a=e.h3,l=e.label,n=R.package("GameEdit"),b=PropTypes,n("EditTools",{propTypes:{tool_tags_url:b.string.isRequired,tools:b.oneOfType([b.array,b.object]),tool_tags:b.oneOfType([b.array,b.object]),selected_tools:b.oneOfType([b.array,b.object]),feedback_url:b.string},getInitialState:function(){var h,y,g,w;if(y={selected_tools:_.toArray(this.props.selected_tools),loading_tools:{},loading_count:0,loaded_tools:{}},this.props.preloaded_tool_tags){g=this.props.preloaded_tool_tags;for(h in g)w=g[h],y.loading_tools[h]=$.when(w),y.loaded_tools[h]=w}return y},componentDidUpdate:function(){return this.load_selected_tools()},load_selected_tools:function(){var h,y,g,w,u;for(w=this.state.selected_tools,u=[],h=0,g=w.length;h<g;h++)y=w[h],u.push(this.get_tool_tags(y));return u},find_tool:function(h){var y,g,w,u;for(w=this.props.tools,y=0,g=w.length;y<g;y++)if(u=w[y],u.id===h)return u},get_tool_tags:function(h){var y;return y=this.state.loading_tools,y[h]?y[h]:(this.setState({loading_count:this.state.loading_count+1}),y[h]=$.ajax({url:this.props.tool_tags_url.replace(/:tool_id\b/,h),dataType:"json"}).done(function(g){return function(w){return g.state.loaded_tools[w.id]=w,g.setState({loading_count:g.state.loading_count-1})}}(this)),this.setState({loading_tools:y}))},componentDidMount:function(){var h;return this.load_selected_tools(),h=$(this.tool_selector_input_ref.current.get_input_el()),h.selectize({delimiter:",",plugins:["remove_button"],closeAfterSelect:!0,valueField:"id",labelField:"name",searchField:["name"],options:this.props.tools,onChange:function(y){return function(){var g;return y.setState({selected_tools:function(){var w,u,f,k;for(f=h[0].selectize.items,k=[],w=0,u=f.length;w<u;w++)g=f[w],k.push(+g);return k}()})}}(this)})},render:function(){var h;return h=this.state.loading_count>0,this.enclose({className:"tool_picker"},i({className:"form",method:"post"},R.CSRF({}),R.Forms.TextInputRow({ref:this.tool_selector_input_ref||(this.tool_selector_input_ref=React.createRef()),title:"Engines & tools",sub:this.props.explanation,name:"tools",placeholder:"Click to view options, type to filter",defaultValue:this.state.selected_tools.join(",")}),d({},"Are we missing an option? Please help our database: ",r({target:"_blank",href:this.props.tool_suggestion_url},"suggest new tool, engine, or device")),this.render_tool_options(),s({className:"button_row"},t({className:classNames("button",{disabled:h}),disabled:h},"Save"),h?s({className:"loader"}):void 0)))},render_tool_options:function(){if(this.state.selected_tools.length)return s({className:"tool_option_list"},this.state.selected_tools.map(function(h){return function(y){var g,w,u;if(w=_.toArray(h.props.tool_tags).filter(function(f){return f.tool_id===y}),u=h.state.loaded_tools[y],!!(u!=null&&(g=u.groups)!=null&&g.length))return R.GameEdit.EditToolOptions({tool:u,key:y,feedback_url:h.props.feedback_url,selected_tags:w})}}(this)))}}),n("EditToolOptions",{propTypes:{tool:b.object.isRequired,selected_tags:b.array},componentDidMount:function(){var h,y,g,w,u,f,k,p,x,v,m,N,S;for(f={},m=this.props.tool.groups,k=0,x=m.length;k<x;k++)g=m[k],f[g.id]=g;for(h=$(ReactDOM.findDOMNode(this)),N=h.find(".multi_input"),S=[],p=0,v=N.length;p<v;p++)y=N[p],y=$(y),u=+y.data("group_id"),w=f[u],w&&S.push(function(C,D){return C.selectize({delimiter:",",plugins:["remove_button"],closeAfterSelect:!0,valueField:"id",labelField:"name",searchField:["name"],options:D.tags})}(y,w));return S},render:function(){return this.enclose({className:"tool"},a({},this.props.tool.name),s({className:"tool_tag_groups",children:this.props.tool.groups.map(function(h){return function(y,g){var w;return w=h.props.selected_tags.filter(function(u){return u.tool_tag_group_id===y.id}),s({className:"tool_tag_group input_row",key:"group-"+g},l({},s({className:"group_title label"},y.name),function(){switch(y.type){case"multi":return this.render_multi(y,w);case"single":return this.render_single(y,w)}}.call(h)))}}(this))}),this.props.feedback_url?s({className:"missing_something"},"Don't see something that should be here? ",r({href:"#",onClick:function(h){return function(y){var g;return y.preventDefault(),g=h.props.feedback_url+"?"+$.param({url:window.location.href,type:"tool",tool_id:h.props.tool.id}),I.Lightbox.open_remote(g,I.FeedbackLightbox)}}(this)},"Tell us")):void 0)},input_name:function(h){return"tool_group_taggings["+h.id+"]"},render_single:function(h,y){var g,w;return g=h.tags.map(function(u){return function(f){return[f.id,f.name]}}(this)),g.unshift(["",""]),R.Forms.Select({name:this.input_name(h),defaultValue:(w=y[0])!=null?w.tool_tag_id:void 0,selectize:{placeholder:"Select one, backspace to clear"},options:g})},render_multi:function(h,y){var g,w;return w=function(){var u,f,k;for(k=[],u=0,f=y.length;u<f;u++)g=y[u],k.push(g.tool_tag_id);return k}().join(","),o({type:"text",className:"multi_input","data-group_id":h.id,name:this.input_name(h),defaultValue:w,placeholder:"Select all that apply"})}})});var gr=null;E.libs.react.done(function(){var n,e,r,t,s,i;return e=F,s=e.input,i=e.p,t=e.div,r=e.button,n=M.package("Forms"),gr=n("Slider",{pure:!0,propTypes:{min:j.number,max:j.number,value:j.number,onChange:j.func,disabled:j.bool},getInitialState:function(){return{}},on_change:function(a){return a=Math.round(a),this.props.onChange?this.props.value===a?void 0:this.props.onChange(a):this.state.value===a?void 0:this.setState({value:a})},start_drag:function(a,o){var l,c,d,b;if(!this.props.disabled)return b=this.track_ref.current.clientWidth,c=this.current_value(),this.setState({dragging:!0}),l=function(h){return function(y){var g,w,u,f;if(y.preventDefault(),y.buttons===0){d();return}if(u=y.pageX,f=y.pageX,g=u-a,w=g/b*(h.props.max-h.props.min)+c,w=Math.min(h.props.max,Math.max(h.props.min,w)),w!==h.current_value())return h.on_change(w)}}(this),d=function(h){return function(y){return y!=null&&y.preventDefault(),h.setState({dragging:!1}),document.body.removeEventListener("mousemove",l),document.body.removeEventListener("mouseup",d),delete h.up_listener}}(this),document.body.addEventListener("mousemove",l),document.body.addEventListener("mouseup",d),this.up_listener=d},current_value:function(){return"value"in this.state?this.state.value||this.props.min:this.props.value||this.props.min},percent:function(){return(this.current_value()-this.props.min)/(this.props.max-this.props.min)},componentWillUnmount:function(){if(this.up_listener)return this.up_listener()},render:function(){var a;return a={left:this.percent()*100+"%"},this.enclose({className:G("slider_input",{disabled:this.props.disabled}),onClick:function(o){return function(l){var c,d;if(!o.props.disabled&&l.target!==o.slider_nub_ref.current&&(d=o.track_ref.current.getBoundingClientRect(),i=Math.min(d.width,Math.max(0,l.pageX-d.left))/d.width,c=o.props.min+i*(o.props.max-o.props.min),c=Math.min(o.props.max,Math.max(o.props.min,c)),c!==o.current_value()))return o.on_change(c)}}(this)},this.props.name?s({type:"hidden",name:this.props.name,value:this.current_value()}):void 0,t({ref:this.track_ref||(this.track_ref=P.createRef()),className:"slider_track"},t({className:"slider_fill",style:{width:this.percent()*100+"%"}}),this.state.focused&&this.props.show_tooltip?t({style:a,className:"value_tooltip"},this.current_value()):void 0,r({type:"button",ref:this.slider_nub_ref||(this.slider_nub_ref=P.createRef()),className:G("slider_nub",{disabled:this.props.disabled}),onFocus:function(o){return function(){return o.setState({focused:!0})}}(this),onBlur:function(o){return function(){return o.setState({focused:!1})}}(this),onMouseDown:function(o){return function(l){return o.start_drag(l.pageX,l.pageY)}}(this),onKeyDown:function(o){return function(l){switch(l.keyCode){case 37:o.on_change(Math.max(o.props.min,o.current_value()-1));break;case 39:o.on_change(Math.min(o.props.max,o.current_value()+1));break;default:return}return l.preventDefault()}}(this),style:a})))}})}),I.libs.react.done(function(){var n,e,r,t,s,i,a,o,l,c,d,b,h,y,g,w,u,f,k,p,x,v;return t=F,b=t.input,o=t.div,w=t.p,a=t.code,s=t.a,c=t.h3,l=t.form,h=t.label,g=t.option,p=t.textarea,u=t.select,k=t.strong,v=t.ul,y=t.li,f=t.span,d=t.iframe,i=t.button,e=R.package("GameEdit"),x=PropTypes,r={rectangle:{width:552,height:167},square:{width:208,height:167}},n=[["Background color","bg_color"],["Text color","fg_color"],["Button color","link_color"],["Border color","border_color"]],e("RenderMarkup",{getInitialState:function(){return{}},componentDidUpdate:function(){return this.updateHTML()},componentDidMount:function(){return this.updateHTML()},updateHTML:function(){var m;return m=document.createElement("div"),ReactDOM.render(o({ref:function(N){return function(S){var C,D;if(D=S.innerHTML,N.state.html!==D)return N.setState({html:D}),typeof(C=N.props).on_html=="function"?C.on_html(D):void 0}}(this)},this.props.children),m)},render:function(){return React.createElement("script",{type:"text/render"})}}),e("Widget",{propTypes:{widget_url:x.string,default_style:x.object,dark_style:x.object},getInitialState:function(){return{border_width:1}},render:function(){return this.enclose({className:"edit_widget"},w({},"Customize the widget below, then paste the code into a website where you'd like to embed it."),c({},"Preview"),o({className:"preview"},this.render_widget(!0,!1)),l({className:"form"},this.render_check_options([{label:"Square",name:"square"},this.state.square?void 0:{label:"Include link to itch.io page",name:"linkback"}]),o({className:"style_group"},this.render_presets(),this.render_color_options(),this.render_border_option()),o({className:"widget_code"},h({},o({className:"label"},"Code"),p({readOnly:!0,ref:function(m){return function(N){m.code_el=N}}(this),onClick:function(m){return function(N){return N.target.select()}}(this)}),e.RenderMarkup({children:this.render_widget(!1),on_html:function(m){return function(N){if(m.code_el)return m.code_el.value=N}}(this)})))),o({className:"embed_directions"},k({},"Directions:")," Copy and paste this HTML into your website where you want the widget to appear."))},render_check_options:function(m){return o({className:"input_row widget_options"},o({className:"label"},"Options"),v({className:"check_list"},m.map(function(N){return function(S,C){if(S)return y({key:S.name},h({},b({type:"checkbox",checked:!!N.state[S.name],onChange:function(D){var L;return L={},L[S.name]=D.target.checked,N.setState(L)}}),S.label,S.sub?f({className:"sub"}," \u2014 "+S.sub):void 0))}}(this))))},is_dark_style:function(){var m,N,S,C,D;if(this.props.dark_style){for(N=0,S=n.length;N<S;N++)if(D=n[N],m=D[0],C=D[1],this.state[C]!==this.props.dark_style[C])return!1;return!0}},render_widget:function(m,N){var S,C,D,L,O,A,H,J,K;if(m==null&&(m=!0),N==null&&(N=!0),J=this.props.widget_url,K={},this.state.linkback&&(K.linkback="true"),N)if(this.state.border_width!==1&&(K.border_width=this.state.border_width),this.is_dark_style())K.dark="true";else for(L=0,O=n.length;L<O;L++)A=n[L],S=A[0],D=A[1],C=this.state[D],C&&(K[D]=C.replace(/^#/,""));return $.isEmptyObject(K)||(J=J+="?"+$.param(K)),H=this.state.square?r.square:r.rectangle,d({ref:m?"iframe":void 0,frameBorder:"0",src:J,width:H.width+(this.state.border_width-1)*2,height:H.height+(this.state.border_width-1)*2,onLoad:m?function(oe){return function(){return oe.refresh_style()}}(this):void 0},s({href:this.props.game_url},this.props.game_link_title))},refresh_style:function(){var m,N,S;if(S=this.refs.iframe.contentWindow,!!S)return(m=S.I)!=null&&(N=m.embed)!=null&&typeof N.set_style=="function"?N.set_style(this.state):void 0},render_color_options:function(){return o({className:"color_options",children:n.map(function(m){return function(N){var S,C,D;return C=N[0],S=N[1],D=m.state[S]||m.props.default_style[S],o({key:S,className:"color_column"},h({},o({className:"label"},C),ue({name:S,value:D,onChange:function(L){return L===m.props.default_style[S]?delete m.state[S]:m.state[S]=L,m.forceUpdate(m.refresh_style)}})))}}(this))})},render_border_option:function(){return o({className:"input_row border_option"},h({},o({className:"label"},"Border size"),gr({min:0,max:5,value:this.state.border_width,onChange:function(m){return function(N){return m.setState({border_width:N},m.refresh_style)}}(this)}),f({className:"border_value"},this.state.border_width+"px")))},set_preset:function(m){var N,S,C,D,L,O,A,H,J;if(m){for(J={},S=0,D=n.length;S<D;S++)A=n[S],N=A[0],O=A[1],J[O]=m[O];return this.setState(J)}else{for(C=0,L=n.length;C<L;C++)H=n[C],N=H[0],O=H[1],delete this.state[O];return this.forceUpdate()}},render_presets:function(){return o({className:"style_presets"},o({className:"label"},"Preset: "),i({type:"button",className:"button outline small",onClick:function(m){return function(){return m.set_preset(null)}}(this)},"Default"),i({type:"button",className:"button outline small",onClick:function(m){return function(){return m.set_preset(m.props.dark_style)}}(this)},"Dark"),this.props.game_style?i({type:"button",className:"button outline small",onClick:function(m){return function(){return m.set_preset(m.props.game_style)}}(this)},"Your page style"):void 0)}})}),I.libs.react.done(function(){var n,e,r,t,s,i,a,o,l,c;return e=F,t=e.div,c=e.ul,r=e.button,s=e.h2,a=e.label,i=e.input,o=e.select,n=R.package("GameEdit"),l=PropTypes,n("ReferrerAnalytics",{getInitialState:function(){return{current_tab:this.props.by_url?"by_url":"by_domain",by_url:this.props.by_url,by_domain:this.props.by_domain}},set_tab:function(d){var b,h;if(this.setState({current_tab:d,errors:null,loading:!this.state[d]}),!this.state[d])return b=this[h="loading_"+d]||(this[h]=he($.getJSON("",{data:"referrers_"+d}))),b.fail(function(y){return function(g){return y.setState({errors:g.errors})}}(this)),b.done(function(y){return function(g){if(y.setState(g),y.state.current_tab===d)return y.setState({loading:!1,errors:null})}}(this))},render:function(){return this.enclose({},t({className:"split_tools"},c({className:"page_tabs"},r({type:"button",className:classNames("tab",{active:this.state.current_tab==="by_url"}),onClick:function(d){return function(b){return d.set_tab("by_url")}}(this)},"By URL"),r({type:"button",className:classNames("tab",{active:this.state.current_tab==="by_domain"}),onClick:function(d){return function(b){return d.set_tab("by_domain")}}(this)},"By website/domain")),r({type:"button",className:"button outline",onClick:function(d){return function(b){return b.preventDefault(),Y(R.GameEdit.ReferrerGraphLightbox({}))}}(this)},"Graph by day...")),this.state.errors?R.Forms.FormErrors({errors:this.state.errors,animated:!0,scroll_into_view:!0}):void 0,this.state.loading?t({className:"loader_spinner"}):Ze({mode:this.state.current_tab,by_url:this.state.by_url,by_domain:this.state.by_domain}))}}),n("ReferrerGraphLightbox",{getInitialState:function(){return{loading:!0}},componentDidMount:function(){return this.setState({loading:!0}),$.getJSON("",{graph:"referrers"}).done(function(d){return function(b){return b.errors?d.setState({loading:!1,errors:b.errors}):d.setState({loading:!1,graph:b})}}(this))},render:function(){return re({className:this.enclosing_class_name()},s({},"Referrers by day"),this.state.loading?t({className:"loader_spinner"}):this.state.errors?R.Forms.FormErrors({errors:this.state.errors}):this.state.graph?ve({},ne({label:"Views",min_y:3,height:220,range_left:this.state.graph.range_left,range_right:this.state.graph.range_right,data:this.state.graph.referrers,type:"stacked",class:"graph_container",secondary_field:"domain",y_axis_padding:1.1})):void 0)}}),n("Analytics",{getInitialState:function(){return{range_left:this.props.range_left,range_right:this.props.range_right,group_by:this.props.interval,views:this.props.views,downloads:this.props.downloads,purchases:this.props.purchases,plays:this.props.plays,max_date:this.props.today}},refresh_graphs:function(){var d,b,h,y,g,w,u;if(!this.state.loading){for(this.setState({loading:!0}),y={},g=this.container().find("input, select").serializeArray(),d=0,b=g.length;d<b;d++)w=g[d],h=w.name,u=w.value,y[h]=u;return $.getJSON("",y).then(function(f){return function(k){if(k.range_left)return f.setState($.extend(k,{loading:!1}))}}(this))}},on_update_range:function(d){return this.setState(d,function(b){return function(){return b.refresh_graphs()}}(this))},render:function(){return this.enclose({className:{loading:this.state.loading}},Me({loading:this.state.loading,range_left:this.state.range_left,range_right:this.state.range_right,group_by:this.state.group_by,preset_ranges:this.props.preset_ranges,max_date:this.props.max_date,on_update_range:this.on_update_range}),t({className:"graphs"},ne({class:"graph_container",label:"Views",data:this.state.views,interval:this.state.group_by,range_left:this.state.range_left,range_right:this.state.range_right}),this.state.downloads?ne({class:"graph_container",label:"Downloads",min_y:3,data:this.state.downloads,interval:this.state.group_by,range_left:this.state.range_left,range_right:this.state.range_right}):void 0,this.state.plays&&this.state.plays.length?ne({class:"graph_container",label:"Browser Plays",min_y:3,data:this.state.plays,interval:this.state.group_by,range_left:this.state.range_left,range_right:this.state.range_right}):void 0,this.state.purchases?ne({class:"graph_container",label:"Payments",interval:this.state.group_by,min_y:3,data:this.state.purchases,range_left:this.state.range_left,range_right:this.state.range_right}):void 0))}})});var Rn=null;I.libs.react.done(function(){var n,e,r,t,s,i,a,o,l,c,d,b,h,y,g,w;return t=F,s=t.a,o=t.form,d=t.input,y=t.p,a=t.div,c=t.h3,g=t.span,i=t.button,b=t.label,w=t.strong,l=t.h2,r=M.package("GameEdit"),h=1,e=function(){function u(){}return u.is_valid=function(f){return!!(f&&f["Pledge Amount"]&&f.Email&&f["Pledged Status"])},u.get_currency=function(f){var k,p;return k="USD",f&&(p=f!=null?f["Pledge Amount"].match(/[ ](\w+)$/):void 0,p&&(k=p[1])),k},u.normalize_row=function(f){if(f["Pledged Status"]==="collected"&&f.Email)return{original:f,amount:I.parse_money(f["Pledge Amount"]),name:f["Backer Name"],email:f.Email}},u}(),n=function(){function u(){}return u.is_valid=function(f){return!!(f&&f.Amount&&f.Email)},u.get_currency=function(f){return"USD"},u.normalize_row=function(f){var k;if(f.Email)return k=f.Amount,k.match(/\.\d\d$/)||(k=k+".00"),{original:f,email:f.Email,amount:I.parse_money(k),name:f.Name}},u}(),Rn=r("KickstarterImport",{propTypes:{currency:j.string.isRequired,money_placeholder:j.string.isRequired,download_key_groups:j.array},getInitialState:function(){return{groups:[],uploads:_.toArray(this.props.uploads)}},assign_backers_to_groups:function(){var u,f,k,p,x,v,m,N,S,C,D,L;if(this.state.backers){for(this.state.groups.sort(function(O,A){return(O.cutoff_price||0)-(A.cutoff_price||0)}),S=this.state.groups,p=0,m=S.length;p<m;p++)k=S[p],k.backers=[];for(L=[],C=this.state.backers,x=0,N=C.length;x<N;x++){for(u=C[x],f=!1,D=this.state.groups,v=D.length-1;v>=0;v+=-1)if(k=D[v],(k.cutoff_price||0)<=u.amount){k.backers.push(u),f=!0;break}f||L.push(u)}return this.setState({ungrouped_backers:L})}},do_submit:function(u){var f,k;if(u.preventDefault(),!this.state.loading)return this.setState({loading:!0}),f=new FormData(this.refs.form),k=new XMLHttpRequest,k.open("POST",""),k.send(f),k.onload=function(p){return function(x){var v;return v=JSON.parse(k.responseText),v.errors?p.setState({loading:!1,error_message:v.errors.join(",")}):window.location.reload()}}(this)},componentDidMount:function(){return this.dispatch("ks",{set_group_price:function(u){return function(f,k,p){return u.state.groups[k].cutoff_price=p,u.assign_backers_to_groups()}}(this),add_group:function(u){return function(){return u.state.groups.push({id:h++}),u.assign_backers_to_groups()}}(this),remove_group:function(u){return function(f,k){return u.state.groups.splice(k,1),u.assign_backers_to_groups()}}(this),pick_csv:function(u){return function(){return I.pick_files({accept:".csv",input:u.refs.csv_file}).done(function(f){var k,p;if(u.setState({loading:!0,file_contents:null,file_name:null,parsed_file:null,backers:null}),k=f[0],!!k)return p=new FileReader,p.readAsText(k),p.onerror=function(){return u.setState({loading:!1,error_message:"There was an issue reading that file: "+p.error})},p.onload=function(){return u.load_file(k.name,p.result)}})}}(this)})},render:function(){return this.enclose({className:"kickstarer_uploader"},o({encType:"multipart/form-data",method:"POST",ref:"form",className:"form group_form",onSubmit:this.do_submit},d({type:"file",ref:"csv_file",name:"csv_file",className:"csv_file"}),d({type:"hidden",name:"file_format_type",value:this.state.file_format_type||""}),this.state.file_contents?this.render_current_file():this.render_action_buttons(),this.state.error_message?y({className:"error_message"},this.state.error_message):void 0))},render_current_file:function(){var u,f;return a({className:"current_file"},c({className:"filename_row"},"File: ",g({className:"filename"},this.state.file_name)),a({className:"backer_summary"},this.render_summary_stat("Backers",this.state.total_backers),this.render_summary_stat("Min pledge",I.format_money(this.state.min_pledge,this.state.import_currency)),this.render_summary_stat("Max pledge",I.format_money(this.state.max_pledge,this.state.import_currency)),this.render_summary_stat("Currency",this.state.import_currency)),M.Forms.TextInputRow({name:"import_name",title:"Import name",sub:"So you can identify the import later",required:!0,placeholder:"required"}),a({},i({className:"button small",type:"button",ref:"split_backers",onClick:function(k){return function(p){return p.preventDefault(),k.trigger("ks:add_group")}}(this)},"Split backers by pledge amount...")),a({className:"backer_groups"},this.render_groups()),this.state.groups.length&&((u=this.state.ungrouped_backers)!=null&&u.length)?a({className:"ungrouped_backers"},((f=this.state.ungrouped_backers)!=null?f.length:void 0)+" backers not assigned. ",s({href:"#",onClick:function(k){return function(p){return p.preventDefault(),Y(M.GameEdit.KickstarterBackersLightbox({unassigned:!0,backers:k.state.ungrouped_backers}))}}(this)},"View list")):void 0,a({className:"account_require"},b({},d({defaultChecked:!0,type:"checkbox",name:"require_account"}),g({},"Require backers to claim their key with an itch.io account to access it"),M.GameEdit.HelpTooltip({tooltip:"A key that is claimed can not be shared by copying the URL"}))),this.render_action_buttons())},render_groups:function(){return this.state.groups.length?this.state.groups.map(function(u){return function(f,k){return M.GameEdit.KickstarterBackerGroup({idx:k,default:!1,import_currency:u.state.import_currency,key:f.id,backers:_.toArray(f.backers),currency:u.props.currency,money_placeholder:u.props.money_placeholder,uploads:u.state.uploads,group:f,download_key_groups:_.toArray(u.props.download_key_groups),update_pledge_cutoff:function(p){return f.pledge_cutoff=p,u.forceUpdate()}})}}(this)):M.GameEdit.KickstarterBackerGroup({key:"default",currency:this.props.currency,import_currency:this.state.import_currency,money_placeholder:this.props.money_placeholder,backers:_.toArray(this.state.ungrouped_backers),default:!0,uploads:this.state.uploads,download_key_groups:_.toArray(this.props.download_key_groups)})},render_summary_stat:function(u,f){return a({className:"summary_stat"},a({className:"summary_value"},f),a({className:"summary_label"},u))},validate_csv:function(u){var f;return u&&u.data?(f=u.data[0],e.is_valid(f)?"kickstarter":n.is_valid(f)?"indiegogo":!1):!1},summarize_file:function(u,f){var k,p,x,v,m,N,S;if(u==null&&(u=this.state.parsed_file),!!u){if(N=void 0,m=void 0,v=f.get_currency(u.data[0]),x=function(){var C,D,L,O;for(L=u.data,O=[],C=0,D=L.length;C<D;C++)p=L[C],S=f.normalize_row(p),S&&(k=S.amount,(N==null||k<N)&&(N=k),(m==null||k>m)&&(m=k),O.push(S));return O}(),!x.length){this.setState({error_message:"No backers could be retrieved from the file",file_contents:null,file_name:null,parsed_file:null});return}return this.setState({total_backers:x.length,import_currency:v,max_pledge:m,min_pledge:N,backers:x})}},load_file:function(u,f){var k,p,x;if(k=window.Papa.parse(f,{header:!0}),x=this.validate_csv(k),!x){this.setState({loading:!1,error_message:"Failed to parse backers, is the file the correct format?"});return}return p=function(){switch(x){case"kickstarter":return e;case"indiegogo":return n;default:throw new Error("No parser for row type: "+x)}}(),this.summarize_file(k,p),this.setState({error_message:null,file_format_type:x,row_parser:p,loading:!1,file_contents:f,file_name:u,parsed_file:k},function(v){return function(){return v.assign_backers_to_groups()}}(this))},render_action_buttons:function(){return a({className:"bottom_buttons"},this.state.file_name?g({},i({className:classNames("button",{disabled:this.state.loading}),disabled:this.state.loading},"Create keys for backers")," or ",s({href:"#",onClick:function(u){return function(f){return f.preventDefault(),u.trigger("ks:pick_csv")}}(this)},"Select a different CSV")):g({},i({className:"button",disabled:!!this.state.loading,onClick:function(u){return function(f){return f.preventDefault(),u.trigger("ks:pick_csv")}}(this)},"Select a CSV to import...")))}}),r("KickstarterBackerGroup",{propTypes:{idx:j.number,default:j.bool.isRequired,currency:j.string.isRequired,money_placeholder:j.string.isRequired,backers:j.array.isRequired,uploads:j.array.isRequired,download_key_groups:j.array},getInitialState:function(){return{unlock_all_files:!1,download_key_group_id:""}},componentDidMount:function(){if(this.refs.cutoff_price)return $(this.refs.cutoff_price.refs.input).focus()},input_name:function(u){var f;return f=this.props.idx!=null?this.props.idx+1:"default","group["+f+"]["+u+"]"},render:function(){return a({className:classNames("backer_group",{default_group:this.props.default})},this.render_group_header(),this.render_header(),a({className:"group_columns"},this.render_uploads(),this.render_key_destination()))},render_group_header:function(){if(!this.props.default)return a({className:"group_header"},a({className:"group_summary"},"Backers that pledge",M.GameEdit.MoneyInput({"data-currency":this.props.import_currency,ref:"cutoff_price",className:"cutoff_price",name:this.input_name("cutoff_price"),placeholder:I.format_money(0,this.props.import_currency),onKeyUp:function(u){return function(f){var k;return k=I.parse_money(f.target.value),u.trigger("ks:set_group_price",u.props.idx,k)}}(this)}),"and above"),s({href:"#",className:"sub",onClick:function(u){return function(f){return f.preventDefault(),u.trigger("ks:remove_group",u.props.idx)}}(this)},"Delete group"))},render_header:function(){return a({className:classNames("group_counts",{has_error:!this.props.backers.length})},"Matching ",w({},this.props.backers.length+" backers"),this.props.backers.length>0?g({}," (",s({href:"#",onClick:function(u){return function(f){return f.preventDefault(),Y(M.GameEdit.KickstarterBackersLightbox({group:u.props.group,import_currency:u.props.import_currency,backers:u.props.backers}))}}(this)},"View list"),")"):void 0)},render_key_destination:function(){return a({className:"key_destination"},a({className:"column_header"},"Put keys in ",M.Forms.SimpleSelect({value:this.state.download_key_group_id,name:this.input_name("download_key_group_id"),onChange:function(u){return function(f){return u.setState({download_key_group_id:f})}}(this),options:[{value:"",name:"New download key group"}].concat(this.props.download_key_groups.map(function(u){return function(f){return{value:""+f.id,name:f.name}}}(this)))})),this.state.download_key_group_id===""?a({className:"new_download_key_group"},this.render_file_unlock(),this.render_external_key_unlock()):y({},w({},"Note: "),"Email addresses already imported will be skipped"))},render_file_unlock:function(){return a({className:"file_unlock"},M.Forms.TextInputRow({money_input:!0,name:this.input_name("unlock_price"),title:"Unlock price",currency:this.props.currency,placeholder:this.props.money_placeholder,disabled:this.state.unlock_all_files,onKeyUp:function(u){return function(f){return u.setState({unlock_price:I.parse_money(f.target.value)})}}(this)}),a({className:"unlock_alt"},g({className:"or"}," or "),b({},d({type:"checkbox",name:this.input_name("unlock_all_files"),value:this.state.unlock_all_files,onChange:function(u){return function(f){return u.setState({unlock_all_files:f.target.checked})}}(this)}),"Unlock all files")))},render_external_key_unlock:function(){return a({className:"key_unlock"},b({},d({name:this.input_name("unlock_keys"),type:"checkbox"}),"Unlock external keys (Steam, etc.)"))},render_uploads:function(){var u,f,k;return f=this.state.download_key_group_id===""?this.state.unlock_price:(u=_.toArray(this.props.download_key_groups).find(function(p){return function(x){return""+x.id==""+p.state.download_key_group_id}}(this)))!=null?u.unlock_price:void 0,k=this.props.uploads.map(function(p){return function(x){var v;return v=!1,x.min_price||(v=!0),x.min_price&&f&&(v=f===-1?!0:f>=x.min_price),p.state.unlock_all_files&&(v=!0),a({className:classNames("upload",{available:v}),key:x.id},g({className:"icon-download icon"}),g({className:"filename"},x.filename),x.min_price?g({className:"price"},"at "+I.format_money(x.min_price,p.props.currency)):void 0,g({className:"size"},I.format_bytes(x.size)))}}(this)),k.length||(k=a({className:"empty_message"},"You don't have any files available")),a({className:"uploads"},a({className:"column_header"},"Files to be given"),a({className:"available_uploads",children:k}))}}),r("KickstarterBackersLightbox",{propTypes:{import_currency:j.string,group:j.object,backers:j.array.isRequired},render:function(){return M.Lightbox({className:this.enclosing_class_name()},this.props.group?l({},"Backers that pledged more than "+I.format_money(this.props.group.cutoff_price,this.props.import_currency)):this.props.unassigned?l({},"Unassigned backers"):l({},"Selected backers"),a({className:"backer_list_table"},a({className:"backer_list_header"},a({},"Name"),a({},"Email"),a({},"Pledge")),a({className:"backer_list"},this.props.backers.map(function(u){return function(f,k){return a({className:"backer_row",key:f.name+"-"+f.email},a({title:f.name},f.name||g({className:"sub"},"n/a")),a({title:f.email},f.email),a({},I.format_money(f.amount,u.props.import_currency)))}}(this)))))}}),r("KickstarterApiLightbox",{render:function(){return M.Lightbox({className:this.enclosing_class_name()},l({},"Import using Kickstarter API"),y({},"You can import your backer list through Kickstarter's API by adding itch.io's account as a collaborator to your project. Add the following email address as a collaborator to begin:"),y({className:"account_email"},"support@itch.io"),y({},"CSV backer import is self-service, so before using the API you might want to try a CSV import."),y({},s({className:"forward_link",href:"#"},"Read more about connecting your Kickstarter account")))}}),r("HelpTooltip",{propTypes:{tooltip:j.string.isRequired},componentDidMount:function(){return $(ReactDOM.findDOMNode(this)).has_tooltips()},render:function(){return a({className:"help_hover","data-tooltip":this.props.tooltip})}})}),I.libs.react.done(function(){var n,e,r,t,s,i,a,o,l,c,d,b,h,y;return e=F,i=e.form,a=e.fragment,o=e.h2,d=e.p,r=e.a,t=e.button,b=e.span,s=e.div,l=e.input,c=e.label,h=e.textarea,a=React.createElement.bind(null,React.Fragment),a.type=React.fragment,n=R.package("Dashboard"),y=PropTypes,n("GameRatingsReportLightbox",{pure:!0,getInitialState:function(){return{submitted:!1,reason:null}},show_description:function(){return this.state.reason&&this.state.reason!=="dont_agree"},description_required:function(){switch(this.state.reason){case"other":case"offensive":return!0;default:return!1}},render:function(){return R.Lightbox({className:classNames(this.enclosing_class_name(),"compact")},this.state.submitted?this.render_submitted():this.render_report_form())},render_submitted:function(){return this.state.reason==="dont_agree"?a({},o({},"Report rating"),d({},"The nature of rating systems is that there will always be a wide range of opinions, and we recognize that a project's average rating is only accurate with a larger number of ratings."),d({},"In order to offset a bad rating we recommend that you encourage those who support your work to leave their own rating & review. The more ratings your project has the more accurate your average rating will be, and the more it can contribute to how your project is discovered across itch.io."),d({},"We do not penalize individual ratings because the creator of the project does not agree with them. Administrative action is only taken if an account is violating our terms or is involved in fraudulent activity to misrepresent a project."),d({},t({className:"button outline",onClick:function(g){return function(){return I.Lightbox.close()}}(this)},"Got it"))):a({},o({},"Report submitted"),d({},"Thank you for submitting a report. Our team will review it as soon as we can and take administrative action if necessary."),d({},t({className:"button outline",onClick:function(g){return function(){return I.Lightbox.close()}}(this)},"Close")))},render_report_form:function(){return a({},o({},"Report rating"),i({className:"form",method:"post",action:this.props.submit_url,onSubmit:function(g){return function(w){if(w.preventDefault(),g.state.reason==="dont_agree"){g.setState({submitted:!0});return}return g.setState({errors:null,loading:!0}),I.remote_submit($(w.target)).done(function(u){if(u.errors){g.setState({loading:!1,errors:u.errors});return}return g.setState({submitted:!0})})}}(this)},this.state.errors?R.Forms.FormErrors({errors:this.state.errors}):void 0,this.props.existing_report?d({},"You already reported this rating ",React.createElement("abbr",{title:this.props.existing_report.created_at},b({className:"icon icon-stopwatch","aria-hidden":"true"})," ",Ne(this.props.existing_report.created_at)),"."):void 0,R.CSRF({}),s({className:"input_row"},s({className:"label"},"Report reason"),R.Forms.RadioButtons({value:this.state.reason||"",required:!0,name:"reason",onChange:function(g){return function(w){return g.setState({reason:w.target.value})}}(this),options:this.reason_options||(this.reason_options=[["dont_agree","I don't agree with this rating/review"],["offensive","Abusive or offensive","Violates itch.io community guidelines"],["fraud","Fraudulent or bot activity","Fake account involved with mass rating"],["offtopic","Off-topic","Contents of rating/review unrelated to your project or outside your control (example: An itch.io bug prevented access to project)"],["spam","Spam","Posting unrelated marketing links"],["other","Other"]])})),this.show_description()?c({className:"input_row"},s({className:"label"},"Description"),h({maxLength:"2048",name:"description",required:this.description_required(),placeholder:this.description_required()?this.t("misc.forms.required"):this.t("misc.forms.optional")})):void 0,s({className:"buttons"},t({className:classNames("button",{disabled:!this.state.reason||this.state.loading}),disabled:!this.state.reason||this.state.loading},"Submit report"))))}})});var Cn=[].slice;I.libs.react.done(function(){var n,e,r,t,s,i,a,o,l,c,d,b;return e=F,r=e.a,o=e.input,c=e.p,s=e.div,t=e.button,l=e.label,d=e.strong,i=e.fragment,i=React.createElement.bind(null,React.Fragment),i.type=React.fragment,n=R.package("JamEdit"),b=PropTypes,a=0,n("EditCriteria",{propTypes:{criteria:b.array,can_edit:b.bool},getInitialState:function(){return{criteria:Cn.call(this.props.criteria)}},componentDidMount:function(){if(this.props.ref_name)return n.EditCriteria[this.props.ref_name]=this},set_criteria:function(h){return this.list_ref.current.replace_items(h)},render:function(){return this.enclose({},this.props.can_edit?o({type:"hidden",name:"jam[update_criteria]",value:"1"}):void 0,this.render_criteria(),this.props.can_edit&&!this.state.criteria.length?c({className:"warning"},"Because this jam is Ranked, you must add at least one criteria for voting to take place."):void 0,this.props.can_edit?s({className:"button_row"},t({type:"button",className:"button add_criteria_btn",onClick:function(h){return function(y){return h.list_ref.current.add({just_added:!0},function(g){return g.focus()})}}(this)},"Add new criteria")):c({className:"criteria_blocked"},"The submission end date has elapsed and you can no longer edit criteria."))},render_criteria:function(){return s({className:"criteria_list"},Re({animate:!0,item_name:"criteria",ref:this.list_ref||(this.list_ref=React.createRef()),on_list_update:this.on_list_update||(this.on_list_update=function(h){return function(y){return h.setState({criteria:y})}}(this)),initial_items:this.props.criteria,item_component:n.JamCriteriaRow,item_props:function(h){return function(y){return{show_primary_toggle:h.state.criteria.length>1,can_edit:h.props.can_edit}}}(this)}))}}),n("JamCriteriaRow",{pure:!0,focus:function(){var h;return(h=this.default_input_ref.current)!=null?h.focus():void 0},render:function(){var h,y,g;return h=this.props.criteria,g=function(w){return function(u){return"jam[criteria]["+(w.props.position+1)+"]["+u+"]"}}(this),y=this.props.can_edit?s({className:"sub_criteria_settings"},this.props.show_primary_toggle?l({className:"primary_toggle"},o({type:"checkbox",name:g("primary"),checked:h.primary||!1,onChange:function(w){return function(u){var f;return f=u.target.checked,w.props.update_all(function(k){return{primary:k===h?f:!1}})}}(this)}),"Primary"):void 0,h.edit_url?r({href:h.edit_url,target:"_blank"},"Edit results..."):void 0,s({className:"link_settings"},this.props.first&&this.props.last?void 0:ge({move_up:this.move_up||(this.move_up=function(w){return function(){return w.props.move_up()}}(this)),move_down:this.move_down||(this.move_down=function(w){return function(){return w.props.move_down()}}(this)),first:this.props.first,last:this.props.last})," ",r({href:"#",className:"remove_crit_btn",onClick:function(w){return function(u){return u.preventDefault(),w.props.remove()}}(this)},"Remove"))):h.primary||h.edit_url?s({className:"sub_criteria_settings"},h.primary?d({},"Primary"):void 0," ",h.edit_url?r({href:h.edit_url,target:"_blank"},"Edit results..."):void 0):void 0,s({className:"criteria_row",style:this.props.style},(h.just_added?ve:i)({},o({disabled:!this.props.can_edit,type:"hidden",name:g("id"),value:h.id||""}),s({className:"primary_criteria_settings"},o({disabled:!this.props.can_edit,ref:this.default_input_ref||(this.default_input_ref=React.createRef()),placeholder:"How should the entry be judged?",required:!0,type:"text",name:g("name"),value:h.name||"",className:"criteria_input",onChange:function(w){return function(u){return w.props.update({name:u.target.value})}}(this)}),R.Forms.SimpleSelect({disabled:!this.props.can_edit,name:g("type"),value:h.type||"default",onChange:function(w){return function(u){return w.props.update({type:u})}}(this),options:[{name:"Voted on",value:"default"},{name:"Manually ranked",value:"manual_order"}]})),y))}})}),I.libs.react.done(function(){var n,e,r,t,s,i,a,o,l,c,d,b;return e=F,a=e.input,l=e.p,t=e.div,r=e.button,s=e.fragment,c=e.span,o=e.label,d=e.textarea,s=React.createElement.bind(null,React.Fragment),s.type=React.fragment,n=R.package("JamEdit"),b=PropTypes,i=0,n("EditFields",{propTypes:{fields:b.array,field_types:b.array,disabled:b.bool},set_fields:function(h){return this.list_ref.current.replace_items(h)},componentDidMount:function(){if(this.props.ref_name)return n.EditFields[this.props.ref_name]=this},render:function(){return this.enclose({className:"field_picker"},this.props.disabled?void 0:a({type:"hidden",name:"jam[update_fields]",value:"1"}),this.render_fields(),this.props.disabled?l({className:"fields_blocked"},"The submission end date has elapsed and you can no longer edit fields."):t({className:"button_row"},r({type:"button",className:"button",onClick:function(h){return function(){return h.list_ref.current.add({type:h.props.field_types[0].type,just_added:!0},function(y){return y.focus()})}}(this)},"Add new field")))},render_fields:function(){return t({className:"field_list"},Re({animate:!0,item_name:"field",ref:this.list_ref||(this.list_ref=React.createRef()),initial_items:this.props.fields||[],item_component:n.JamFieldRow,item_props:function(h){return function(y){return{field_types:h.props.field_types,disabled:h.props.disabled}}}(this)}))}}),n("JamFieldRow",{focus:function(){var h;return(h=this.default_input_ref.current)!=null?h.focus():void 0},input_name:function(h){return"jam[fields]["+(this.props.position+1)+"]["+h+"]"},has_data:function(){var h,y,g,w;for(g=this.props.field_types,h=0,y=g.length;h<y;h++)if(w=g[h],w.type===this.props.field.type)return w.has_data},render:function(){var h;return h=this.props.field,this.enclose({className:classNames("field_row",{has_data:this.has_data(),disabled:this.props.disabled}),style:this.props.style},(h.just_added?ve:s)({},this.props.field.id?a({type:"hidden",name:this.input_name("id"),value:this.props.field.id,disabled:this.props.disabled}):void 0,t({className:"field_title"},a({type:"text",required:!0,placeholder:"Name",name:this.input_name("name"),defaultValue:this.props.field.name,className:"field_name_input",disabled:this.props.disabled,ref:this.default_input_ref||(this.default_input_ref=React.createRef())})),t({className:"field_options"},c({className:"field_type"},c({className:"label"},"Type")," ",R.Forms.SimpleSelect({value:this.props.field.type,name:this.input_name("type"),disabled:this.props.disabled,onChange:function(y){return function(g){return y.props.update({type:g})}}(this),options:this.props.field_types.map(function(y){return function(g){return{name:g.name,value:g.type}}}(this))})),t({className:"toggles"},t({},o({},a({type:"checkbox",name:this.input_name("required"),defaultChecked:this.props.field.required,disabled:this.props.disabled})," ","Required")),t({},o({title:"Only jam hosts can see responses"},a({type:"checkbox",name:this.input_name("private"),defaultChecked:this.props.field.private,disabled:this.props.disabled})," ","Private"))),this.props.disabled?void 0:s({},this.props.first&&this.props.last?void 0:ge({move_up:this.move_up||(this.move_up=function(y){return function(){return y.props.move_up()}}(this)),move_down:this.move_down||(this.move_down=function(y){return function(){return y.props.move_down()}}(this)),first:this.props.first,last:this.props.last}),r({title:"Remove",className:"remove_btn textlike",onClick:function(y){return function(){return y.props.remove()}}(this)},"Remove"))),t({className:"field_description"},d({name:this.input_name("description"),placeholder:"Description",defaultValue:this.props.field.description,disabled:this.props.disabled})),this.has_data()?t({className:"data_row"},d({name:this.input_name("data"),placeholder:"Configure field settings",defaultValue:this.props.field.data,disabled:this.props.disabled})):void 0))}})});var Be=null;E.libs.react.done(function(){var n,e;return n=F,e=n.img,Be=function(r){return P.createElement("svg",{className:"svgicon icon_down_tick2",strokeLinecap:"round",stroke:"currentColor",role:"img",version:"1.1",viewBox:"0 0 24 24",strokeWidth:"2",width:"22",height:"22",strokeLinejoin:"round","aria-hidden":!0,fill:"none"},P.createElement("polyline",{points:"6 9 12 15 18 9"}))},Be=P.createElement.bind(null,P.memo(Be))});var Dn=[].slice,br=null;I.libs.react.done(function(){var n,e,r,t,s,i,a,o,l,c,d,b,h,y,g,w;return e=F,i=e.input,t=e.div,a=e.label,y=e.span,d=e.p,c=e.option,l=e.optgroup,h=e.select,w=e.ul,o=e.li,b=e.section,s=e.form,g=e.strong,r=function(u){return function(){return M.component.apply(M,arguments)}}(this),r("CSRF",{pure:!0,render:function(){return i({type:"hidden",name:"csrf_token",value:$("meta[name=csrf_token]").attr("value")})}}),n=M.package("Forms"),n("InputRow",{pure:!0,propTypes:{title:j.string,sub:j.any},render:function(){var u;return u=P.createElement(P.Fragment,{},t({className:"label",key:"label"},this.props.title,this.props.sub?y({className:"sub"}," \u2014 ",this.props.sub):void 0),this.props.children),this.props.multi||(u=a({children:u})),t({className:G("input_row",this.props.className),id:this.props.id},u)}}),n("TextInputRow",{pure:!0,propTypes:{title:j.string,sub:j.any,name:j.string.isRequired,value:j.any},focus:function(){return this.input_ref.current.focus()},get_input_el:function(){return this.input_ref.current},get_value:function(){return this.input_ref.current.value},componentDidMount:function(){var u;if(this.props.money_input){if(!this.props.currency)throw new Error("missing currency");I.money_input(this.input_ref.current,{currency:this.props.currency})}if(this.props.slug_input&&I.slug_input($(this.input_ref.current)),this.props.integer_input)return u=/[0-9]/g,$(this.input_ref.current).on("keypress",function(f){return function(k){var p;if(k.keyCode>=32&&(p=String.fromCharCode(k.keyCode),!p.match(u)))return!1}}(this))},render:function(){var u;return u=[t({className:"label",key:"label"},this.props.title,this.props.sub?y({className:"sub"}," \u2014 ",this.props.sub):void 0),i({type:"text",key:"input",name:this.props.name,ref:this.input_ref||(this.input_ref=P.createRef()),value:this.props.value,defaultValue:this.props.defaultValue,onChange:this.props.onChange,onKeyUp:this.props.onKeyUp,onFocus:this.props.onFocus,onBlur:this.props.onBlur,onClick:this.props.onClick,readOnly:this.props.readonly,className:G({has_error:this.props.has_error}),required:this.props.required,placeholder:this.props.placeholder,disabled:this.props.disabled,pattern:this.props.pattern}),this.props.error_message?d({key:"error",className:"input_error"},this.props.error_message):void 0],this.props.multi||(u=a({children:u})),t({className:G("input_row",this.props.className)},u)}}),n("SimpleSelect",{pure:!0,propTypes:{options:j.array.isRequired,name:j.string},getInitialState:function(){return{value:this.props.defaultValue?this.props.defaultValue:void 0}},render:function(){var u,f,k,p,x;return f=this.current_option(),x=this.props.render_current_option,x||(x=function(v){return function(m){return m.short_name||m.name}}(this)),u=[],k=null,p=function(){if(k)return u.push(l.apply(null,[{label:k.label,key:"group-"+u.length}].concat(Dn.call(k.children)))),k=null},this.props.options.map(function(v){return function(m,N){var S;return S=c({key:""+N,value:m.value},m.name),m.group?((k!=null?k.label:void 0)!==m.group&&p(),k||(k={label:m.group,children:[]}),k.children.push(S)):(p(),u.push(S))}}(this)),p(),this.enclose({className:G({focused:this.state.focused,disabled:this.props.disabled,has_value:f!==this.props.options[0]})},t({className:"selected_option"},y({className:"selected_option_name"},x(f)),Be({})),h({ref:this.select_ref||(this.select_ref=P.createRef()),disabled:this.props.disabled,value:f.value,name:this.props.name,onFocus:function(v){return function(m){return v.setState({focused:!0})}}(this),onBlur:function(v){return function(m){return v.setState({focused:!1})}}(this),onChange:this.on_change,children:u}))},on_change:function(u){var f;return f=u.target.value,this.props.onChange?f===this.props.value?void 0:this.props.onChange(f):f===this.state.value?void 0:this.setState({value:f})},find_option:function(u){var f,k,p,x;for(x=this.props.options,f=0,k=x.length;f<k;f++)if(p=x[f],p.value===u)return p},current_option:function(){var u,f;return f=this.props.value||this.state.value,u=f!=null?this.find_option(f):void 0,u||this.props.options[0]}}),n("Select",{propTypes:{name:j.string.isRequired,value:j.any,options:j.array.isRequired},componentDidMount:function(){var u,f;if(this.props.selectize&&(f=this.props.selectize===!0?{}:this.props.selectize,u=$(this.input_ref.current),u.selectize(f),this.props.onChange))return u.on("change",function(k){return function(p){return k.props.onChange(p)}}(this))},render:function(){return h({ref:this.input_ref||(this.input_ref=P.createRef()),name:this.props.name,onChange:this.props.onChange,value:this.props.value,defaultValue:this.props.defaultValue,children:this.props.options.map(function(u){return function(f){var k,p;return p=f[0],k=f[1],c({key:p,value:p},k||p)}}(this))})}}),n("RadioButtons",{propTypes:{name:j.string.isRequired,value:j.any,options:j.array.isRequired},getValue:function(){var u,f,k,p,x,v;for(p=this.container().find("input").serializeArray(),u=0,f=p.length;u<f;u++)return x=p[u],k=x.name,v=x.value,v},render:function(){return w({className:"radio_list",children:this.props.options.map(function(u){return function(f,k){var p,x,v,m;return m=f[0],p=f[1],v=f[2],x=f[3],o({key:m!=null?m:k,className:G({disabled:x!=null?x.disabled:void 0})},a({},i($.extend({type:"radio",name:u.props.name,value:m,defaultChecked:u.props.defaultValue?m===u.props.defaultValue:void 0,checked:u.props.value!=null?m===u.props.value:void 0,onChange:u.props.onChange},x)),y({className:"radio_label"},p),v?y({className:"sub"}," \u2014 ",v):void 0))}}(this))})}}),br=n("FormErrors",{pure:!0,getDefaultProps:function(){return{animated:!1,scroll_into_view:!1}},propTypes:{title:j.string,errors:j.array.isRequired},render:function(){var u;return u=this.props.animated?ve:b,u({className:G(this.enclosing_class_name(),"form_errors"),role:"alert"},t({ref:this.props.scroll_into_view?function(f){if(f)return typeof f.scrollIntoView=="function"?f.scrollIntoView():void 0}:void 0},this.props.title!==!1?d({},g({},this.props.title||this.tt("misc.forms.form_errors"))):void 0,w({},this.props.errors.map(function(f){return function(k){var p;return p=k==="recaptcha"?"Please complete the CAPTCHA to continue":k,o({key:k},p)}}(this))),this.props.children))}}),n("RecaptchaInput",{propTypes:{sitekey:j.string.isRequired},componentDidMount:function(){return I.with_recaptcha(function(u){return function(){var f;return I.event("recaptcha","show",I.page_name()),f=X.findDOMNode(u),grecaptcha.render(f,{sitekey:u.props.sitekey})}}(this))},render:function(){return t({className:"g-recaptcha"})}})}),I.libs.react.done(function(){var n,e,r,t,s,i,a,o,l,c,d;return e=F,a=e.h2,i=e.fragment,l=e.p,d=e.span,t=e.div,s=e.form,o=e.input,c=e.select,r=e.button,i=P.createElement.bind(null,P.Fragment),i.type=P.fragment,n=M.package("JamEdit"),n("LateSubmitLightbox",{render:function(){return re({ref:this.lightbox_ref||(this.lightbox_ref=P.createRef()),className:this.enclosing_class_name()},a({},"Late submit URL"),this.props.errors?br({errors:this.props.errors}):i({},l({},"Give this URL to ",d({className:"recipient"},this.props.recipient)," in order to let them submit late. They must visit this URL from their account to complete the submission."),t({className:"form"},o({type:"text",className:"text_input submit_url_input",readOnly:!0,onClick:function(b){return function(h){return h.target.select()}}(this),value:this.props.submit_url}))),t({className:"button_row"},r({type:"button",className:"button",onClick:function(b){return function(){return b.lightbox_ref.current.close()}}(this)},"Close")))}})}),I.libs.react.done(function(){var n,e,r;return e=F,r=e.span,n=M.package("Dashboard"),n("ProjectTotals",{render:function(){return ot(Object.assign({className:"summary_table",field_sorters:{publish_status:function(t,s){var i;switch(i=t[s.field],i){case"published":return 0;case"restricted":return 1;case"draft":return 2;default:return 3}}},field_renderers:{publish_status:function(t,s){var i;switch(i=t[s.field],i){case"published":return r({className:"tag_bubble green"},"Published");case"restricted":return r({className:"tag_bubble purple"},"Restricted");case"draft":return r({className:"tag_bubble red"},"Draft")}}}},this.props))}})}),I.libs.react.done(function(){var n,e,r,t,s,i,a;return e=F,i=e.p,r=e.a,n=R.package("Dashboard"),a=F.svg,s=F.line,t=F.g,n("SparkGraph",{render:function(){var o,l,c,d,b,h,y,g,w,u,f,k;for(c=this.props.counts,u=Math.min.apply(Math,c),w=Math.max.apply(Math,c),o=0,d=0,y=c.length;d<y;d++)l=c[d],o+=l;for(o/=c.length,u===w&&(w+=1),u=0,w=Math.max(w,o*2),f=[],b=h=0,g=c.length;h<g;b=++h)l=c[b],b!==c.length-1&&f.push([c[b],c[b+1]]);return k=function(p,x){return x==null&&(x=.8),(p-50)*x+50},a({version:"1.1",className:"spark_graph",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg",width:this.props.width,height:this.props.height},f.map(function(p){return function(x,v){var m,N,S,C;return m=x[0],N=x[1],S=v/f.length,C=(v+1)/f.length,s({key:v,x1:S*100+"%",y1:k(100-(m-u)/(w-u)*100)+"%",x2:C*100+"%",y2:k(100-(N-u)/(w-u)*100)+"%",stroke:p.props.stroke||"currentColor",strokeWidth:"2"})}}(this)))}})}),I.libs.react.done(function(){var n,e,r,t,s,i,a,o;return e=F,i=e.h2,t=e.div,s=e.form,a=e.input,r=e.button,n=R.package("Dashboard"),o=PropTypes,n("ToolGameTagsLightbox",{propTypes:{game:o.object.isRequired,tool:o.object.isRequired,selected_tags:o.array.isRequired,url:o.string.isRequired},render:function(){return R.Lightbox({className:"tool_game_tags_lightbox"},this.enclose({},i({},"Edit tags for "+this.props.game.title),t({className:"content"},s({className:"form",action:this.props.url,method:"post",ref:"form",onSubmit:function(l){return function(c){return c.preventDefault(),I.remote_submit($(l.refs.form),[{name:"json",value:"1"}]).then(l.props.on_save)}}(this)},a({type:"hidden",name:"action",value:"update_tags"}),R.CSRF({}),R.GameEdit.EditToolOptions({tool:this.props.tool,selected_tags:this.props.selected_tags}),t({className:"buttons"},r({className:"button"},"Save tags"))))))}})})})();
